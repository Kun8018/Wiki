<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React（八）</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.0503e0f3.css" as="style"><link rel="preload" href="/assets/js/app.3979e060.js" as="script"><link rel="preload" href="/assets/js/2.0f8cbb55.js" as="script"><link rel="preload" href="/assets/js/1.ff82b27c.js" as="script"><link rel="preload" href="/assets/js/72.46bd34f2.js" as="script"><link rel="prefetch" href="/assets/js/10.d9850768.js"><link rel="prefetch" href="/assets/js/100.a33654f4.js"><link rel="prefetch" href="/assets/js/101.d3bc1c79.js"><link rel="prefetch" href="/assets/js/102.02bbfd1e.js"><link rel="prefetch" href="/assets/js/103.c9de5560.js"><link rel="prefetch" href="/assets/js/104.7c2b76db.js"><link rel="prefetch" href="/assets/js/105.ea3ac79c.js"><link rel="prefetch" href="/assets/js/106.d54e3045.js"><link rel="prefetch" href="/assets/js/107.c142f695.js"><link rel="prefetch" href="/assets/js/108.fe2c9c19.js"><link rel="prefetch" href="/assets/js/109.59b55101.js"><link rel="prefetch" href="/assets/js/11.62caceeb.js"><link rel="prefetch" href="/assets/js/110.c657b6f8.js"><link rel="prefetch" href="/assets/js/111.4eadf9c5.js"><link rel="prefetch" href="/assets/js/112.fce38ecf.js"><link rel="prefetch" href="/assets/js/113.ee6322e2.js"><link rel="prefetch" href="/assets/js/114.1ed20fd8.js"><link rel="prefetch" href="/assets/js/115.aa405ee0.js"><link rel="prefetch" href="/assets/js/116.d1b4c413.js"><link rel="prefetch" href="/assets/js/117.965d1926.js"><link rel="prefetch" href="/assets/js/118.b1d5b9ca.js"><link rel="prefetch" href="/assets/js/119.e4e766bc.js"><link rel="prefetch" href="/assets/js/12.abd8d9de.js"><link rel="prefetch" href="/assets/js/120.f569b061.js"><link rel="prefetch" href="/assets/js/121.e3915f79.js"><link rel="prefetch" href="/assets/js/122.3a2b3d34.js"><link rel="prefetch" href="/assets/js/123.cbf985ea.js"><link rel="prefetch" href="/assets/js/124.c3d8b6fc.js"><link rel="prefetch" href="/assets/js/125.dfe970a3.js"><link rel="prefetch" href="/assets/js/126.f5165054.js"><link rel="prefetch" href="/assets/js/127.ffb31d35.js"><link rel="prefetch" href="/assets/js/128.bf7eb0b3.js"><link rel="prefetch" href="/assets/js/129.76b0ac54.js"><link rel="prefetch" href="/assets/js/13.763c094c.js"><link rel="prefetch" href="/assets/js/130.cb661ef6.js"><link rel="prefetch" href="/assets/js/131.b215b4cc.js"><link rel="prefetch" href="/assets/js/132.bdf6b89f.js"><link rel="prefetch" href="/assets/js/133.a13e43ca.js"><link rel="prefetch" href="/assets/js/134.f858c56e.js"><link rel="prefetch" href="/assets/js/135.0e05a297.js"><link rel="prefetch" href="/assets/js/136.ff47beeb.js"><link rel="prefetch" href="/assets/js/137.7dcf182f.js"><link rel="prefetch" href="/assets/js/138.dd2c3c8c.js"><link rel="prefetch" href="/assets/js/139.db36e4eb.js"><link rel="prefetch" href="/assets/js/14.784100b6.js"><link rel="prefetch" href="/assets/js/140.05811a56.js"><link rel="prefetch" href="/assets/js/141.32b8052b.js"><link rel="prefetch" href="/assets/js/142.2c061186.js"><link rel="prefetch" href="/assets/js/143.113df61a.js"><link rel="prefetch" href="/assets/js/144.2c01c336.js"><link rel="prefetch" href="/assets/js/145.a8fe7a8a.js"><link rel="prefetch" href="/assets/js/146.bb5b7e16.js"><link rel="prefetch" href="/assets/js/147.213b17a7.js"><link rel="prefetch" href="/assets/js/148.dd7a3258.js"><link rel="prefetch" href="/assets/js/149.b3f9adc5.js"><link rel="prefetch" href="/assets/js/15.3aa73286.js"><link rel="prefetch" href="/assets/js/150.4ab9a505.js"><link rel="prefetch" href="/assets/js/151.d04eb475.js"><link rel="prefetch" href="/assets/js/152.c547ae2c.js"><link rel="prefetch" href="/assets/js/153.3fa58002.js"><link rel="prefetch" href="/assets/js/154.cd2cc012.js"><link rel="prefetch" href="/assets/js/155.0160c441.js"><link rel="prefetch" href="/assets/js/16.7886627b.js"><link rel="prefetch" href="/assets/js/17.a4c76a6c.js"><link rel="prefetch" href="/assets/js/18.995eb54b.js"><link rel="prefetch" href="/assets/js/19.edc682a7.js"><link rel="prefetch" href="/assets/js/20.87ca556d.js"><link rel="prefetch" href="/assets/js/21.4b328dcc.js"><link rel="prefetch" href="/assets/js/22.91d15e78.js"><link rel="prefetch" href="/assets/js/23.17bfc3dd.js"><link rel="prefetch" href="/assets/js/24.c0d84a10.js"><link rel="prefetch" href="/assets/js/25.2717e191.js"><link rel="prefetch" href="/assets/js/26.3764ddb4.js"><link rel="prefetch" href="/assets/js/27.e98913ec.js"><link rel="prefetch" href="/assets/js/28.a4481108.js"><link rel="prefetch" href="/assets/js/29.3d82d38d.js"><link rel="prefetch" href="/assets/js/3.e2aae122.js"><link rel="prefetch" href="/assets/js/30.7e9979a2.js"><link rel="prefetch" href="/assets/js/31.fa479c29.js"><link rel="prefetch" href="/assets/js/32.901576de.js"><link rel="prefetch" href="/assets/js/33.8dafc45c.js"><link rel="prefetch" href="/assets/js/34.6bbddd9b.js"><link rel="prefetch" href="/assets/js/35.394c80b9.js"><link rel="prefetch" href="/assets/js/36.5246333d.js"><link rel="prefetch" href="/assets/js/37.49802bfd.js"><link rel="prefetch" href="/assets/js/38.36ae0914.js"><link rel="prefetch" href="/assets/js/39.791184a0.js"><link rel="prefetch" href="/assets/js/4.30c2ba05.js"><link rel="prefetch" href="/assets/js/40.eb1a9cc1.js"><link rel="prefetch" href="/assets/js/41.31179942.js"><link rel="prefetch" href="/assets/js/42.22c31ea4.js"><link rel="prefetch" href="/assets/js/43.e82e343d.js"><link rel="prefetch" href="/assets/js/44.95e68751.js"><link rel="prefetch" href="/assets/js/45.b99232d2.js"><link rel="prefetch" href="/assets/js/46.21e9dae9.js"><link rel="prefetch" href="/assets/js/47.e30bba7c.js"><link rel="prefetch" href="/assets/js/48.6c0d14cd.js"><link rel="prefetch" href="/assets/js/49.ed1b480b.js"><link rel="prefetch" href="/assets/js/5.c5fba3ad.js"><link rel="prefetch" href="/assets/js/50.f500b9ed.js"><link rel="prefetch" href="/assets/js/51.3671246f.js"><link rel="prefetch" href="/assets/js/52.7915148f.js"><link rel="prefetch" href="/assets/js/53.39ece5d9.js"><link rel="prefetch" href="/assets/js/54.358ca4aa.js"><link rel="prefetch" href="/assets/js/55.244837be.js"><link rel="prefetch" href="/assets/js/56.e7164f10.js"><link rel="prefetch" href="/assets/js/57.3c6f5aa2.js"><link rel="prefetch" href="/assets/js/58.84c83603.js"><link rel="prefetch" href="/assets/js/59.ec4edc7d.js"><link rel="prefetch" href="/assets/js/6.9184d4d1.js"><link rel="prefetch" href="/assets/js/60.c2346e02.js"><link rel="prefetch" href="/assets/js/61.8d99ca4c.js"><link rel="prefetch" href="/assets/js/62.f6bea4bf.js"><link rel="prefetch" href="/assets/js/63.410bfe1e.js"><link rel="prefetch" href="/assets/js/64.960d5951.js"><link rel="prefetch" href="/assets/js/65.e6a8895b.js"><link rel="prefetch" href="/assets/js/66.41092e16.js"><link rel="prefetch" href="/assets/js/67.062b95dc.js"><link rel="prefetch" href="/assets/js/68.58c65f95.js"><link rel="prefetch" href="/assets/js/69.d1e1b68b.js"><link rel="prefetch" href="/assets/js/7.85fc951e.js"><link rel="prefetch" href="/assets/js/70.8294a611.js"><link rel="prefetch" href="/assets/js/71.66e44dac.js"><link rel="prefetch" href="/assets/js/73.7eb2e800.js"><link rel="prefetch" href="/assets/js/74.8e05f264.js"><link rel="prefetch" href="/assets/js/75.21e0b9b1.js"><link rel="prefetch" href="/assets/js/76.c2c92cec.js"><link rel="prefetch" href="/assets/js/77.799df679.js"><link rel="prefetch" href="/assets/js/78.1605b33c.js"><link rel="prefetch" href="/assets/js/79.659e7e78.js"><link rel="prefetch" href="/assets/js/80.6f99ca65.js"><link rel="prefetch" href="/assets/js/81.7a0caba9.js"><link rel="prefetch" href="/assets/js/82.19629840.js"><link rel="prefetch" href="/assets/js/83.29093f51.js"><link rel="prefetch" href="/assets/js/84.64568258.js"><link rel="prefetch" href="/assets/js/85.3d88e3b2.js"><link rel="prefetch" href="/assets/js/86.0a93f933.js"><link rel="prefetch" href="/assets/js/87.07c51a25.js"><link rel="prefetch" href="/assets/js/88.aa6be8e5.js"><link rel="prefetch" href="/assets/js/89.6ad93f1f.js"><link rel="prefetch" href="/assets/js/90.87c8c6e5.js"><link rel="prefetch" href="/assets/js/91.57c509b5.js"><link rel="prefetch" href="/assets/js/92.c8b02e25.js"><link rel="prefetch" href="/assets/js/93.fee86c6c.js"><link rel="prefetch" href="/assets/js/94.ab3bad19.js"><link rel="prefetch" href="/assets/js/95.cfaa79dc.js"><link rel="prefetch" href="/assets/js/96.c63afef5.js"><link rel="prefetch" href="/assets/js/97.123374a6.js"><link rel="prefetch" href="/assets/js/98.53cfb154.js"><link rel="prefetch" href="/assets/js/99.8fe1f067.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0503e0f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>​      基于React的衍生框架</p> <h2 id="create-react-app"><a href="#create-react-app" class="header-anchor">#</a> create-react-app</h2> <h3 id="react-app-rewired"><a href="#react-app-rewired" class="header-anchor">#</a> react-app-rewired</h3> <p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> react-app-rewired --save-dev
</code></pre></div><p>在根目录下创建一个config-overrides.js文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* config-overrides.js */</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">override</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//do stuff with the webpack config...</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改package.json脚本</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token comment">/* package.json */</span>

<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
-   <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts start&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired start&quot;</span><span class="token punctuation">,</span>
-   <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts build&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired build&quot;</span><span class="token punctuation">,</span>
-   <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts test&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired test&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts eject&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// The Webpack config to use when compiling your react app for development or production.</span>
  <span class="token function-variable function">webpack</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...add your webpack config</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// The Jest config to use when running your jest tests - note that the normal rewires do not</span>
  <span class="token comment">// work here.</span>
  <span class="token function-variable function">jest</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...add your jest config customisation...</span>
    <span class="token comment">// Example: enable/disable some tests based on environment variables in the .env file.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config<span class="token punctuation">.</span>testPathIgnorePatterns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>testPathIgnorePatterns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">RUN_COMPONENT_TESTS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>testPathIgnorePatterns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;rootDir&gt;/src/components/**/*.test.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">RUN_REDUCER_TESTS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>testPathIgnorePatterns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;rootDir&gt;/src/reducers/**/*.test.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// The function to use to create a webpack dev server configuration when running the development</span>
  <span class="token comment">// server with 'npm run start' or 'yarn start'.</span>
  <span class="token comment">// Example: set the dev server to use a specific certificate in https.</span>
  <span class="token function-variable function">devServer</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">configFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Return the replacement function for create-react-app to use to generate the Webpack</span>
    <span class="token comment">// Development Server config. &quot;configFunction&quot; is the function that would normally have</span>
    <span class="token comment">// been used to generate the Webpack Development server config - you can use it to create</span>
    <span class="token comment">// a starting configuration to then modify instead of having to create a config from scratch.</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">proxy<span class="token punctuation">,</span> allowedHost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Create the default config by calling configFunction with the proxy/allowedHost parameters</span>
      <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">configFunction</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> allowedHost<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Change the https certificate options to match your certificate, using the .env file to</span>
      <span class="token comment">// set the file paths &amp; passphrase.</span>
      <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      config<span class="token punctuation">.</span>https <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">key</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_HTTPS_KEY</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cert</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_HTTPS_CERT</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">ca</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_HTTPS_CA</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">passphrase</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_HTTPS_PASS</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// Return your customised Webpack Development Server config.</span>
      <span class="token keyword">return</span> config<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// The paths config to use when compiling your react app for development or production.</span>
  <span class="token function-variable function">paths</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">paths<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...add your paths config</span>
    <span class="token keyword">return</span> paths<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="craco"><a href="#craco" class="header-anchor">#</a> CRACO</h3> <p><strong>C</strong>reate <strong>R</strong>eact <strong>A</strong>pp <strong>C</strong>onfiguration <strong>O</strong>verride修改cra配置的一个包</p> <p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i @craco/craco
</code></pre></div><p>在根目录下创建一个craco.config.js并且修改package.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
-   <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts start&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;craco start&quot;</span><span class="token punctuation">,</span>
-   <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts build&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;craco build&quot;</span>
-   <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts test&quot;</span><span class="token punctuation">,</span>
+   <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;craco test&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置文件可以是<code>craco.config.ts</code>, <code>craco.config.js</code>, <code>.cracorc.ts</code>, <code>.cracorc.js</code> 或者 <code>.cracorc</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> when<span class="token punctuation">,</span> whenDev <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@craco/craco&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">eslint</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token constant">ESLINT_MODES</span><span class="token punctuation">.</span>file<span class="token punctuation">,</span>
        <span class="token literal-property property">configure</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">formatter</span><span class="token operator">:</span> <span class="token function">when</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;CI&quot;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;eslint-formatter-vso&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">webpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">ConfigWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token operator">...</span><span class="token function">whenDev</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CircularDependencyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>配置jest</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* jest.config.js */</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> createJestConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@craco/craco&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cracoConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./craco.config.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jestConfig <span class="token operator">=</span> <span class="token function">createJestConfig</span><span class="token punctuation">(</span>cracoConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> jestConfig<span class="token punctuation">;</span>
</code></pre></div><h2 id="remix-js"><a href="#remix-js" class="header-anchor">#</a> Remix.js</h2> <p>Remix由 React Router 原班团队打造，基于 TypeScript 与 React，内建 React Router V6 特性的全栈 Web 框架 Remix 正式开源。</p> <p>Remix 开源之后可以说是在 React 全栈框架领域激起千层浪，绝对可以算是 Next.js 的强劲对手。Remix 的特性如下：</p> <ul><li>追求速度，然后是用户体验(UX)，支持任何 SSR/SSG 等</li> <li>基于 Web 基础技术，如 HTML/CSS 与 HTTP 以及 Web Fecth API，在绝大部分情况可以不依赖于 JavaScript 运行，所以可以运行在任何环境下，如 Web Browser、Cloudflare Workers、Serverless 或者 Node.js 等</li> <li>客户端与服务端一致的开发体验，客户端代码与服务端代码写在一个文件里，无缝进行数据交互，同时基于 TypeScript，类型定义可以跨客户端与服务端共用</li> <li>内建文件即路由、动态路由、嵌套路由、资源路由等</li> <li>干掉 Loading、骨架屏等任何加载状态，页面中所有资源都可以预加载(Prefetch)，页面几乎可以立即加载</li> <li>告别以往瀑布式(Waterfall)的数据获取方式，数据获取在服务端并行(Parallel)获取，生成完整 HTML 文档，类似 React 的并发特性</li> <li>提供开发网页需要所有状态，开箱即用；提供所有需要使用的组件，包括 <Links> 、<Link>、 <Meta> 、<Form> 、<Script></Script> ，用于处理元信息、脚本、CSS、路由和表单相关的内容</Form></Meta></Link></Links></li> <li>内建错误处理，针对非预期错误处理的 <ErrorBoundary> 和开发者抛出错误处理的 <CatchBoundary></CatchBoundary></ErrorBoundary></li></ul> <h3 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h3> <p>Remix 提供基于文件的路由，将读取数据、操作数据和渲染数据的逻辑都写在同一个路由文件里，方便一致性处理，这样可以跨客户端和服务端逻辑共享同一套类型定义。</p> <h2 id="nextjs"><a href="#nextjs" class="header-anchor">#</a> Nextjs</h2> <p>Https://juejin.cn/post/6844904017487724557</p> <p><code>Next.js</code>是一个基于<code>React</code>的一个服务端渲染简约框架。它使用<code>React</code>语法，可以很好的实现代码的模块化，有利于代码的开发和维护</p> <p>Next的优点：</p> <ul><li>默认服务端渲染模式，以文件系统为基础的客户端路由</li> <li>代码自动分隔使页面加载更快</li> <li>以页面为基础的简洁的客户端路由</li> <li>以<code>webpack</code>的热替换为基础的开发环境</li> <li>使用<code>React</code>的<code>JSX</code>和<code>ES6</code>的<code>module</code>，模块化和维护更方便</li> <li>可以运行在<code>Express</code>和其他<code>Node.js</code>的<code>HTTP</code> 服务器上</li> <li>可以定制化专属的<code>babel</code>和<code>webpack</code>配置</li></ul> <p>创建next项目</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> react react-dom next
</code></pre></div><p><code>Next.js</code>是从服务器生成页面，再返回给前端展示。<code>Next.js</code>默认从 <code>pages</code> 目录下取页面进行渲染返回给前端展示，并默认取 <code>pages/index.js</code> 作为系统的首页进行展示。注意，<code>pages</code> 是默认存放页面的目录，路由的根路径也是<code>pages</code>目录</p> <p>在pages目录下创建indexjs</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// next-Link用于引入文件</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span>

<span class="token keyword">const</span> <span class="token function-variable function">Index</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">&quot;/about&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>About Page<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Hello Next<span class="token punctuation">.</span>js<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Index
</code></pre></div><h3 id="页面-pages"><a href="#页面-pages" class="header-anchor">#</a> 页面（pages）</h3> <p>在 Next.js 中，一个 <strong>page（页面）</strong> 就是一个从 <code>.js</code>、<code>jsx</code>、<code>.ts</code> 或 <code>.tsx</code> 文件导出（export）</p> <p>这些文件存放在 <code>pages</code> 目录下。每个 page（页面）都使用其文件名作为路由（route）</p> <p>Next.js 支持具有动态路由的 pages（页面）。例如，如果你创建了一个命名为 <code>pages/posts/[id].js</code> 的文件，那么就可以通过 <code>posts/1</code>、<code>posts/2</code> 等类似的路径进行访问</p> <p>预渲染</p> <p>默认情况下，Next.js 将 <strong>预渲染</strong> 每个 page（页面）。这意味着 Next.js 会预先为每个页面生成 HTML 文件，而不是由客户端 JavaScript 来完成。预渲染可以带来更好的性能和 SEO 效果</p> <p>每个生成的 HTML 文件都与该页面所需的最少 JavaScript 代码相关联。当浏览器加载一个 page（页面）时，其 JavaScript 代码将运行并使页面完全具有交互性。（此过程称为 <em>水合（hydration）</em>。）</p> <p>Next.js 具有两种形式的预渲染： <strong>静态生成（Static Generation）</strong> 和 <strong>服务器端渲染（Server-side Rendering）</strong>。这两种方式的不同之处在于为 page（页面）生成 HTML 页面的 <strong>时机</strong> 。</p> <ul><li><a href="https://www.nextjs.cn/docs/basic-features/pages#static-generation-recommended" target="_blank" rel="noopener noreferrer"><strong>静态生成 （推荐）</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：HTML 在 <strong>构建时</strong> 生成，并在每次页面请求（request）时重用。</li> <li><a href="https://www.nextjs.cn/docs/basic-features/pages#server-side-rendering" target="_blank" rel="noopener noreferrer"><strong>服务器端渲染</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：在 <strong>每次页面请求（request）时</strong> 重新生成 HTML。</li></ul> <p>重要的是，Next.js 允许你为每个页面 <strong>选择</strong> 预渲染的方式。你可以创建一个 “混合渲染” 的 Next.js 应用程序：对大多数页面使用“静态生成”，同时对其它页面使用“服务器端渲染”。</p> <p>出于性能考虑，相对服务器端渲染，我们更 <strong>推荐</strong> 使用 <strong>静态生成</strong> 。 CDN 可以在没有额外配置的情况下缓存静态生成的页面以提高性能。但是，在某些情况下，服务器端渲染可能是唯一的选择。</p> <p>你还可以将 <strong>客户端渲染</strong> 与静态生成或服务器端渲染一起使用。这意味着页面的某些部分可以完全由客户端 JavaScript 呈现。</p> <p>如果一个页面使用了 <strong>静态生成</strong>，在 <strong>构建时（build time）</strong> 将生成此页面对应的 HTML 文件 。这意味着在生产环境中，运行 <code>next build</code> 时将生成该页面对应的 HTML 文件。然后，此 HTML 文件将在每个页面请求时被重用，还可以被 CDN 缓存。</p> <p>在 Next.js 中，你可以静态生成 <strong>带有或不带有数据</strong> 的页面。</p> <p>不需要获取数据的静态页面</p> <p>默认情况下，Next.js 使用 “静态生成” 来预渲染页面但不涉及获取数据。</p> <p>此页面在预渲染时不需要获取任何外部数据。在这种情况下，Next.js 只需在构建时为每个页面生成一个 HTML 文件即可。</p> <p>需要获取数据的静态生成</p> <p>某些页面需要获取外部数据以进行预渲染。有两种情况，一种或两种都可能适用。在每种情况下，你都可以使用 Next.js 所提供的以下函数：</p> <ol><li>您的页面 <strong>内容</strong> 取决于外部数据：使用 <code>getStaticProps</code>。</li> <li>你的页面 <strong>paths（路径）</strong> 取决于外部数据：使用 <code>getStaticPaths</code> （通常还要同时使用 <code>getStaticProps</code>）。</li></ol> <h3 id="多页面"><a href="#多页面" class="header-anchor">#</a> 多页面</h3> <h3 id="使用redux"><a href="#使用redux" class="header-anchor">#</a> 使用redux</h3> <h3 id="路由遮盖"><a href="#路由遮盖" class="header-anchor">#</a> 路由遮盖</h3> <p><code>Next.js</code>上提供了一个独特的特性：路由遮盖（Route Masking）。它可以使得在浏览器上显示的是路由<code>A</code>，而<code>App</code>内部真正的路由是<code>B</code>。这个特性可以让我们来设置一些比较简洁的路由显示在页面，而系统背后是使用一个带参数的路由。比如上面的例子中，地址栏中显示的是 <code>http://localhost:3000/post?title=Hello%20Next.js</code> ，这个地址含有一个<code>title</code>参数，看着很不整洁。下面我们就用<code>Next.js</code>来改造路由，使用路由遮盖来创建一个更加简洁的路由地址。比如我们将该地址改造成 `http://localhost:3000/p/hello-nextjs</p> <h3 id="自定义根组件"><a href="#自定义根组件" class="header-anchor">#</a> 自定义根组件</h3> <p>在page下面创建_app.js，能覆盖默认的appjs</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Navbar <span class="token keyword">from</span> <span class="token string">'./navbar'</span>
<span class="token keyword">import</span> Footer <span class="token keyword">from</span> <span class="token string">'./footer'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Layout</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Navbar <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>main<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Footer <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// pages/_app.js</span>

<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'../components/layout'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> Component<span class="token punctuation">,</span> pageProps <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Layout<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>pageProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="next-seo"><a href="#next-seo" class="header-anchor">#</a> next-seo</h3> <p>在next项目中添加seo</p> <p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> next-seo
</code></pre></div><p>添加seo</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NextSeo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next-seo'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Page</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>NextSeo
      title<span class="token operator">=</span><span class="token string">&quot;Using More of Config&quot;</span>
      description<span class="token operator">=</span><span class="token string">&quot;This example uses more of the available config options.&quot;</span>
      canonical<span class="token operator">=</span><span class="token string">&quot;https://www.canonical.ie/&quot;</span>
      openGraph<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.url.ie/a'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Open Graph Title'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'Open Graph Description'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">images</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.example.ie/og-image-01.jpg'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
            <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>
            <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">'Og Image Alt'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.example.ie/og-image-02.jpg'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">900</span><span class="token punctuation">,</span>
            <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
            <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">'Og Image Alt Second'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.example.ie/og-image-03.jpg'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.example.ie/og-image-04.jpg'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">site_name</span><span class="token operator">:</span> <span class="token string">'SiteName'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      twitter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">handle</span><span class="token operator">:</span> <span class="token string">'@handle'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">site</span><span class="token operator">:</span> <span class="token string">'@site'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cardType</span><span class="token operator">:</span> <span class="token string">'summary_large_image'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token constant">SEO</span> Added to Page<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Page<span class="token punctuation">;</span>
</code></pre></div><p>可以在app.js中添加默认的seo属性，没有设置seo的page使用默认的seo</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> App<span class="token punctuation">,</span> <span class="token punctuation">{</span> Container <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/app'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> DefaultSeo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next-seo'</span><span class="token punctuation">;</span>

<span class="token comment">// import your default seo configuration</span>
<span class="token keyword">import</span> <span class="token constant">SEO</span> <span class="token keyword">from</span> <span class="token string">'../next-seo.config'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> pageProps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>DefaultSeo
          openGraph<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'website'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">locale</span><span class="token operator">:</span> <span class="token string">'en_IE'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.url.ie/'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">site_name</span><span class="token operator">:</span> <span class="token string">'SiteName'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
          twitter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token literal-property property">handle</span><span class="token operator">:</span> <span class="token string">'@handle'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">site</span><span class="token operator">:</span> <span class="token string">'@site'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">cardType</span><span class="token operator">:</span> <span class="token string">'summary_large_image'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>pageProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Container<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="自定义babel"><a href="#自定义babel" class="header-anchor">#</a> 自定义babel</h3> <p>在应用顶层创建一个.babelrc或者babel.config.js文件，</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;next/babel&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;preset-env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;transform-runtime&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;styled-jsx&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;class-properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ssr"><a href="#ssr" class="header-anchor">#</a> SSR</h3> <p><strong>getInitialProps</strong>是在渲染页面之前就会运行的API。 如果该路径下包含该请求，则执行该请求，并将所需的数据作为<strong>props</strong>传递给页面。 (实际上有时会有发送日志等不影响HTML的副作用。 ）</p> <p><strong>getInitialProps</strong>只能在<strong>pages</strong>文件夹内的文件中使用。直接访问后，getInitialProps将在服务器端运行。 另一方面，使用next/link进行客户端路由时，在客户端执行。 因此，建议使用isomorphic-unfetch等fetch库</p> <p><strong>getStaticProps</strong>是用于在构建时预先执行<strong>getInitialProps</strong>进行的处理并预先生成静态文件的API。 不会在客户端上运行。 始终在服务器端运行。</p> <p>getStaticPaths用于在使用动态路由时生成静态文件。</p> <div class="language-react extra-class"><pre class="language-text"><code>import fetch from 'node-fetch'

function Zeit({ name, stars }) {
  return &lt;div&gt;{name} stars: {stars}&lt;/div&gt;
}

// 首先执行。 返回路径以使用数组进行预构建。
export async function getStaticPaths() {
  // zeit获取30个由API管理的存储库
  const res = await fetch('https://api.github.com/orgs/zeit/repos')
  const repos = await res.json()
  // 存储库名称的路径
  const paths = repos.map(repo =&gt; `/zeit/${repo.name}`)
  return { paths, fallback: false }
}

// 接收带有路由信息的参数
export async function getStaticProps({ params }) {
  // 对应于文件名zeit/[name].js
  const name = params.name
  const res = await fetch(`https://api.github.com/repos/zeit/${name}`)
  const json = await res.json()
  const stars = json.stargazers_count

  return { props: { name, stars } }
}

export default Zeit
</code></pre></div><h3 id="vercel-og"><a href="#vercel-og" class="header-anchor">#</a> @vercel/og</h3> <p>将html、css转换为图片</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// /pages/api/og.tsx</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> ImageResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vercel/og'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">runtime</span><span class="token operator">:</span> <span class="token string">'experimental-edge'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ImageResponse</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div
        style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
          <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token number">128</span><span class="token punctuation">,</span>
          <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">display</span><span class="token operator">:</span> <span class="token string">'flex'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">alignItems</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">justifyContent</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        Hello world<span class="token operator">!</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1200</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>node使用satori生成图片</p> <div class="language-react extra-class"><pre class="language-text"><code>// api.jsx
import satori from 'satori'

const svg = await satori(
  &lt;div style={{ color: 'black' }}&gt;hello, world&lt;/div&gt;,
  {
    width: 600,
    height: 400,
    fonts: [
      {
        name: 'Roboto',
        data: robotoArrayBuffer,
        weight: 400,
        style: 'normal',
      },
    ],
  },
)
</code></pre></div><h3 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h3> <p><code>Next.js</code> 项目的部署，需要一个 <code>Node.js</code>的服务器，可以选择 <code>Express</code>, <code>Koa</code>或其他 <code>Nodejs</code> 的Web服务器。本文中以 <code>Express</code> 为例来部署 <code>Next</code> 项目。</p> <h2 id="relay"><a href="#relay" class="header-anchor">#</a> Relay</h2> <p>基于react和Graphql的react客户端框架</p> <p>首先创建一个基于create-react-app的文件夹</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># NPM</span>
npx create-react-app your-app-name
<span class="token comment"># Yarn</span>
<span class="token function">yarn</span> create react-app your-app-name
</code></pre></div><p>然后安装relay包，就可以使用基于graphQL的获取数据方式了</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># NPM Users</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> relay-runtime react-relay
<span class="token function">npm</span> <span class="token function">install</span> --save-dev relay-compiler babel-plugin-relay
</code></pre></div><p>修改package.json</p> <div class="language-shell extra-class"><pre class="language-shell"><code>// your-app-name/package.json
<span class="token punctuation">{</span>
  <span class="token punctuation">..</span>.
  <span class="token string">&quot;scripts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">..</span>.
    <span class="token string">&quot;start&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;yarn run relay &amp;&amp; react-scripts start&quot;</span>,
    <span class="token string">&quot;build&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;yarn run relay &amp;&amp; react-scripts build&quot;</span>,
    <span class="token string">&quot;relay&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;yarn run relay-compiler&quot;</span>
    <span class="token punctuation">..</span>.
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;relay&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;./src/&quot;</span>,
    <span class="token string">&quot;schema&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;./schema.graphql&quot;</span>,
    <span class="token string">&quot;language&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;javascript&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>
</code></pre></div><p>创建一个环境配置文件</p> <div class="language-react extra-class"><pre class="language-text"><code>// your-app-name/src/RelayEnvironment.js
import {Environment, Network, RecordSource, Store} from 'relay-runtime';
import fetchGraphQL from './fetchGraphQL';

// Relay passes a &quot;params&quot; object with the query name and text. So we define a helper function
// to call our fetchGraphQL utility with params.text.
async function fetchRelay(params, variables) {
  console.log(`fetching query ${params.name} with ${JSON.stringify(variables)}`);
  return fetchGraphQL(params.text, variables);
}

// Export a singleton instance of Relay Environment configured with our network function:
export default new Environment({
  network: Network.create(fetchRelay),
  store: new Store(new RecordSource()),
});
</code></pre></div><p>在组件中使用</p> <div class="language-react extra-class"><pre class="language-text"><code>import React from 'react';
import './App.css';
import graphql from 'babel-plugin-relay/macro';
import {
  RelayEnvironmentProvider,
  loadQuery,
  usePreloadedQuery,
} from 'react-relay/hooks';
import RelayEnvironment from './RelayEnvironment';

const { Suspense } = React;

// Define a query
const RepositoryNameQuery = graphql`
  query AppRepositoryNameQuery {
    repository(owner: &quot;facebook&quot;, name: &quot;relay&quot;) {
      name
    }
  }
`;

const preloadedQuery = loadQuery(RelayEnvironment, RepositoryNameQuery, {
  /* query variables */
});

function App(props) {
  const data = usePreloadedQuery(RepositoryNameQuery, props.preloadedQuery);

  return (
    &lt;div className=&quot;App&quot;&gt;
      &lt;header className=&quot;App-header&quot;&gt;
        &lt;p&gt;{data.repository.name}&lt;/p&gt;
      &lt;/header&gt;
    &lt;/div&gt;
  );
}
</code></pre></div><h2 id="dvajs"><a href="#dvajs" class="header-anchor">#</a> Dvajs</h2> <p>dva 首先是一个基于 redux 和 redux-saga的数据流方案，然后为了简化开发体验，dva 还额外内置了 react-router和 fetch，所以也可以理解为一个轻量级的应用框架。</p> <p>dva把redux的action、reducer、createActions、actionType等不同目录的文件组织在一个modle文件中。</p> <p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> dva-cli@next <span class="token parameter variable">-g</span>
</code></pre></div><p>创建项目</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dva new myapp
</code></pre></div><p>进入目录，运行</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> start
</code></pre></div><h2 id="blitz-js"><a href="#blitz-js" class="header-anchor">#</a> blitz.js</h2> <p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> blitz
</code></pre></div><p>创建项目</p> <div class="language-shell extra-class"><pre class="language-shell"><code>blitz new AppName
<span class="token builtin class-name">cd</span> 
</code></pre></div><h2 id="umijs"><a href="#umijs" class="header-anchor">#</a> Umijs</h2> <p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> umi
</code></pre></div><p>Umi 中约定 <code>src/global.css</code> 为全局样式，如果存在此文件，会被自动引入到入口文件最前面</p> <p>比如用于覆盖样式，</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token selector">.ant-select-selection</span> <span class="token punctuation">{</span>
  <span class="token property">max-height</span><span class="token punctuation">:</span> 51px<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Umi 会自动识别 CSS Modules 的使用，你把他当做 CSS Modules 用时才是 CSS Modules</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// CSS Modules</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./foo.css'</span><span class="token punctuation">;</span>

<span class="token comment">// 非 CSS Modules</span>
<span class="token keyword">import</span> <span class="token string">'./foo.css'</span><span class="token punctuation">;</span>
</code></pre></div><p>Umi 内置支持 less，不支持 sass 和 stylus，但如果有需求，可以通过 chainWebpack 配置或者 umi 插件的形式支持</p> <p>MFSU</p> <p>mfsu 是一种基于 webpack5 新特性 Module Federation 的打包提速方案。核心原理是将应用的依赖构建为一个 Module Federation 的 remote 应用，以免去应用热更新时对依赖的编译。</p> <p>因此，开启 mfsu 可以大幅减少热更新所需的时间。在生产模式，也可以通过提前编译依赖，大幅提升部署效率。</p> <h3 id="开发阶段"><a href="#开发阶段" class="header-anchor">#</a> 开发阶段</h3> <ol><li>初始化一个 umi 应用。</li> <li>在 config.ts 中添加 <code>mfsu:{}</code>。</li> <li><code>umi dev</code> 启动项目。在构建依赖时，会出现 MFSU 的进度条，此时应用可能会被挂起或显示依赖不存在，请稍等。</li> <li>多人合作时，可以配置 <code>mfsu.development.output</code> 配置预编译依赖输出目录并添加到 git 中，在其他开发者启动时，就可以免去再次编译依赖的过程。</li></ol> <h4 id="特性"><a href="#特性" class="header-anchor">#</a> 特性</h4> <ul><li>预编译：默认情况下，预编译将会将依赖构建到 <code>~/.umi/.cache/.mfsu</code> 下。并且使用了 webpack 缓存，减少再次编译依赖的时间。</li> <li>diff：预编译时，会将本次的依赖信息构建到 <code>~/.mfsu/MFSU_CACHE.json</code> 中，用于依赖的 diff。</li> <li>持久化缓存：对于预编译依赖的请求，开启了<code>cache-control: max-age=31536000,immutable</code>，减少浏览器刷新拉取依赖的时间。</li></ul> <h3 id="构建阶段"><a href="#构建阶段" class="header-anchor">#</a> 构建阶段</h3> <blockquote><p>warning: 由于预编译依赖实现了部分的 tree-shaking，不建议在打包大小敏感的项目中启用生产模式。</p></blockquote> <ol><li>配置 config.ts：<code>mfsu.production = {}</code>以开启生产模式。</li> <li>执行命令：<code>umi build</code>，默认情况下将会将生产依赖预编译到 <code>~/.mfsu-production</code> 中。</li> <li>umi 会将依赖外的产物构建到 <code>~/dist</code> 中，mfsu 再将生产预编译依赖移动到输出目录中。</li> <li>使用 mfsu 生产模式，可以将 <code>~/.mfsu-production</code> 添加到 git 中。在部署时，仅编译应用文件，速度快到飞起。</li></ol> <p>和creat-react-app的不同</p> <p>create-react-app 是基于 webpack 的打包层方案，包含 build、dev、lint 等，他在打包层把体验做到了极致，但是不包含路由，不是框架，也不支持配置。所以，如果大家想基于他修改部分配置，或者希望在打包层之外也做技术收敛时，就会遇到困难。</p> <p>和nextjs的不同</p> <p>next.js 是个很好的选择，Umi 很多功能是参考 next.js 做的。要说有哪些地方不如 Umi，我觉得可能是不够贴近业务，不够接地气。比如 antd、dva 的深度整合，比如国际化、权限、数据流、配置式路由、补丁方案、自动化 external 方面等等一线开发者才会遇到的问题。</p> <h3 id="约定式路由"><a href="#约定式路由" class="header-anchor">#</a> 约定式路由</h3> <p>除配置式路由外，Umi 也支持约定式路由。约定式路由也叫文件路由，就是不需要手写配置，文件系统即路由，通过目录和文件及其命名分析出路由配置。</p> <p><strong>如果没有 routes 配置，Umi 会进入约定式路由模式</strong>，然后分析 <code>src/pages</code> 目录拿到路由配置。</p> <p>动态路由</p> <p>约定 <code>[]</code> 包裹的文件或文件夹为动态路由。</p> <p>嵌套路由</p> <p>Umi 里约定目录下有 <code>_layout.tsx</code> 时会生成嵌套路由，以 <code>_layout.tsx</code> 为该目录的 layout。layout 文件需要返回一个 React 组件，并通过 <code>props.children</code> 渲染子组件。</p> <p>404路由</p> <p>约定 <code>src/pages/404.tsx</code> 为 404 页面，需返回 React 组件。</p> <p>权限路由</p> <p>通过指定高阶组件 <code>wrappers</code> 达成效果。</p> <h3 id="页面跳转"><a href="#页面跳转" class="header-anchor">#</a> 页面跳转</h3> <p>在 umi 里，页面之间跳转有两种方式：声明式和命令式。</p> <p>声明式</p> <p>通过Link使用，通常作为react 组件使用</p> <div class="language-react extra-class"><pre class="language-text"><code>import { Link } from 'umi';

export default () =&gt; (
  &lt;Link to=&quot;/list&quot;&gt;Go to list page&lt;/Link&gt;
);
</code></pre></div><p>命令式</p> <p>通过history使用，在事件处理中调用</p> <div class="language-react extra-class"><pre class="language-text"><code>import { history } from 'umi';

function goToListPage() {
  history.push('/list');
}
</code></pre></div><h3 id="config"><a href="#config" class="header-anchor">#</a> config</h3> <p>proxy</p> <p>配置http-proxy-middleware的proxy</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'target'</span><span class="token operator">:</span> <span class="token string">'http://jsonplaceholder.typicode.com/'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'changeOrigin'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">'pathRewrite'</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'^/api'</span> <span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>publicPath</p> <p>配置 webpack 的 publicPath。当打包的时候，webpack 会在静态文件路径前面添加 <code>publicPath</code> 的值，当你需要修改静态文件地址时，比如使用 CDN 部署，把 <code>publicPath</code> 的值设为 CDN 的值就可以。如果使用一些特殊的文件系统，比如混合开发或者 cordova 等技术，可以尝试将 <code>publicPath</code> 设置成 <code>./</code> 相对路径</p> <p>相对路径 <code>./</code> 有一些限制，例如不支持多层路由 <code>/foo/bar</code>，只支持单层路径 <code>/foo</code></p> <p>如果你的应用部署在域名的子路径上，例如 <code>https://www.your-app.com/foo/</code>，你需要设置 <code>publicPath</code> 为 <code>/foo/</code>，如果同时要兼顾开发环境正常调试，你可以这样配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">publicPath</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'/foo/'</span> <span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="api"><a href="#api" class="header-anchor">#</a> API</h3> <p>useIntl</p> <p>umi的useIntl是基于react-intl的。使用formatMessage api</p> <p>useRequest</p> <p>Prompt</p> <p>提供一个用户离开页面时的提示选择</p> <div class="language-react extra-class"><pre class="language-text"><code>import { Prompt } from 'umi';

export default () =&gt; {
  return (
    &lt;div&gt;
      {/* 用户离开页面时提示一个选择 */}
      &lt;Prompt message=&quot;你确定要离开么？&quot; /&gt;

      {/* 用户要跳转到首页时，提示一个选择 */}
      &lt;Prompt
        message={(location) =&gt; {
          return location.pathname !== '/' ? true : `您确定要跳转到首页么？`;
        }}
      /&gt;

      {/* 根据一个状态来确定用户离开页面时是否给一个提示选择 */}
      &lt;Prompt when={formIsHalfFilledOut} message=&quot;您确定半途而废么？&quot; /&gt;
    &lt;/div&gt;
  );
};
</code></pre></div><p>有时候这个提示会连续出现两次，跳转方法一次push一次replace，可以利用return为true取消第二次提示</p> <h3 id="msfu原理"><a href="#msfu原理" class="header-anchor">#</a> msfu原理</h3> <p>mfsu，是 Module Federation Speed Up 的缩写，含义为：基于 webpack5 的 module federation 特性的提速方案。它有以下的特点：</p> <ul><li>快！项目启动只需要3s，热更新提速 50%，生产模式部署提升 50 倍 1 ！</li> <li>全！基于 webpack 的研发体系，生态更加完善！未来也会加入 esbuild，让快更快！</li> <li>稳！蚂蚁内部近千个前端项目，都将开启 mfsu！</li> <li>狠！云谦老师主持开发，解决 bug 就是快刀斩乱麻！</li></ul> <p>module federation 是 webpack5 提出的新特性，含义为模块联邦。主要是使用于微前端场景。联邦的含义是：我可以通过一个个分散的联邦，组合成一个强大的帝国。所以在 webpack 的模块联邦里，每一个应用可以对外暴露自己的一些组件，供其他应用使用</p> <p>既然模块联邦可以让一个应用从另一个应用拉取模块，我们可以不可以构建一个包含了所有依赖的应用呢</p> <p>在每一次启动项目和热更新的时候，webpack 都需要对依赖和项目文件进行编译，尤其我们项目中的大部分质量都存在于 node_modules。那么如果我们减少了对依赖的重新编译，是不是可以减少项目启动和热更新的时间呢？</p> <p>基于这样的思考，mfsu 的方案已经呼之欲出：我们可以利用 webpack5 的 module federation 特性，构建一个虚拟的 federation 应用，随后，我们的项目直接仅使用编译好的依赖，这样就可以直接减去热更新和启动时对依赖的重新编译</p> <p>因此，mfsu 快的原因很简单，就是直接砍掉了对依赖的编译过程！</p> <p>提前编译了依赖，带来了很多的好处：</p> <ol><li>即使项目规模继续增大，依赖的数量继续增多，启动和热更新都可以保持性能！</li> <li>可以将预编译产物在团队中进行同步，其他同学可以直接享受到预编译带来的快乐！</li> <li>生产模式下，可以持续使用预编译好的依赖，以加快部署速度！</li></ol> <h2 id="react18"><a href="#react18" class="header-anchor">#</a> React18</h2> <h3 id="并发模式"><a href="#并发模式" class="header-anchor">#</a> 并发模式</h3> <p>useTransition是React中用于挂起的hook</p> <div class="language-react extra-class"><pre class="language-text"><code>const [startTransition, isPending] = useTransition({ timeoutMs: 3000 });

&lt;button disabled={isPending}
  startTransition(()=&gt;{
   	&lt;fetch Calls 
  })&gt;
&lt;/button&gt;
{isPending? &quot;Loading&quot;: null}
</code></pre></div><h3 id="为获取数据的suspense"><a href="#为获取数据的suspense" class="header-anchor">#</a> 为获取数据的Suspense</h3> <p>Suspense使组件能够在渲染之前等待一段预定的时间</p> <h2 id="react-xss"><a href="#react-xss" class="header-anchor">#</a> React XSS</h2> <p>前端一般会面临 XSS 这样的安全风险，但随着 React 等现代前端框架的流行，使我们在平时开发时不用太关注安全问题。以 React 为例，React 从设计层面上就具备了很好的防御 XSS 的能力。</p> <p>XSS无论使用哪种攻击方式，其本质就是将恶意代码注入到应用中，浏览器去默认执行。React 官方中提到了 React DOM 在渲染所有输入内容之前，默认会进行转义。它可以确保在你的应用中，永远不会注入那些并非自己明确编写的内容。所有的内容在渲染之前都被转换成了字符串，因此恶意代码无法成功注入，从而有效地防止了 XSS 攻击。</p> <p>自动转义</p> <p>React 在渲染 HTML 内容和渲染 DOM 属性时都会将 <code>&quot;'&amp;&lt;&gt;</code> 这几个字符进行转义，转义部分源码如下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> match<span class="token punctuation">.</span>index<span class="token punctuation">;</span> index <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">34</span><span class="token operator">:</span> <span class="token comment">// &quot;</span>
        escape <span class="token operator">=</span> <span class="token string">'&amp;quot;'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">38</span><span class="token operator">:</span> <span class="token comment">// &amp;</span>
        escape <span class="token operator">=</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">39</span><span class="token operator">:</span> <span class="token comment">// '</span>
        escape <span class="token operator">=</span> <span class="token string">'&amp;#x27;'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">60</span><span class="token operator">:</span> <span class="token comment">// &lt;</span>
        escape <span class="token operator">=</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">62</span><span class="token operator">:</span> <span class="token comment">// &gt;</span>
        escape <span class="token operator">=</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>这段代码是 React 在渲染到浏览器前进行的转义，可以看到对浏览器有特殊含义的字符都被转义了，恶意代码在渲染到 HTML 前都被转成了字符串，如下</p> <div class="language-html extra-class"><pre class="language-html"><code>// 一段恶意代码
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>empty.png<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'xss'</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span> 
// 转义后输出到 html 中
<span class="token entity named-entity" title="&lt;">&amp;lt;</span>img src=<span class="token entity named-entity" title="&quot;">&amp;quot;</span>empty.png<span class="token entity named-entity" title="&quot;">&amp;quot;</span> onerror =<span class="token entity named-entity" title="&quot;">&amp;quot;</span>alert(<span class="token entity" title="&amp;#x27;">&amp;#x27;</span>xss<span class="token entity" title="&amp;#x27;">&amp;#x27;</span>)<span class="token entity named-entity" title="&quot;">&amp;quot;</span><span class="token entity named-entity" title="&gt;">&amp;gt;</span> 
</code></pre></div><h3 id="可能引起漏洞的写法"><a href="#可能引起漏洞的写法" class="header-anchor">#</a> 可能引起漏洞的写法</h3> <p>使用dangerouslySetInnerHTML</p> <p><code>dangerouslySetInnerHTML</code> 是 React 为浏览器 DOM 提供 <code>innerHTML</code> 的替换方案。通常来讲，使用代码直接设置 HTML 存在风险，因为很容易使用户暴露在 XSS 攻击下，因为当使用 <code>dangerouslySetInnerHTML</code> 时，React 将不会对输入进行任何处理并直接渲染到 HTML 中，如果攻击者在 dangerouslySetInnerHTML 传入了恶意代码，那么浏览器将会运行恶意代码。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getNonChildrenInnerMarkup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> innerHTML <span class="token operator">=</span> props<span class="token punctuation">.</span>dangerouslySetInnerHTML<span class="token punctuation">;</span> <span class="token comment">// 有dangerouslySetInnerHTML属性，会不经转义就渲染__html的内容</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>innerHTML <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>innerHTML<span class="token punctuation">.</span>__html <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> innerHTML<span class="token punctuation">.</span>__html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> content <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> content <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">escapeTextForBrowser</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以平时开发时最好避免使用 <code>dangerouslySetInnerHTML</code>，如果不得不使用的话，前端或服务端必须对输入进行相关验证，例如对特殊输入进行过滤、转义等处理。前端这边处理的话，推荐使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fjsxss.com%2Fzh%2Findex.html" target="_blank" rel="noopener noreferrer">白名单过滤<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，通过白名单控制允许的 HTML 标签及各标签的属性</p> <p>通过用户提供的对象来创建react组件</p> <div class="language-react extra-class"><pre class="language-text"><code>// 用户的输入
const userProvidePropsString = `{&quot;dangerouslySetInnerHTML&quot;:{&quot;__html&quot;:&quot;&lt;img onerror='alert(\&quot;xss\&quot;);' src='empty.png' /&gt;&quot;}}&quot;`;
// 经过 JSON 转换
const userProvideProps = JSON.parse(userProvidePropsString);
// userProvideProps = {
//   dangerouslySetInnerHTML: {
//     &quot;__html&quot;: `&lt;img onerror='alert(&quot;xss&quot;);' src='empty.png' /&gt;`
//      }
// };
render() {
     // 出于某种原因解析用户提供的 JSON 并将对象作为 props 传递
    return &lt;div {...userProvideProps} /&gt; 
}
</code></pre></div><p>这段代码将用户提供的数据进行 JSON 转换后直接当做 <code>div</code> 的属性，当用户构造了类似例子中的特殊字符串时，页面就会被注入恶意代码，所以要注意平时在开发中不要直接使用用户的输入作为属性。</p> <p>使用用户输入的值来渲染 a 标签的 href 属性，或类似 img 标签的 src 属性等</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> userWebsite <span class="token operator">=</span> <span class="token string">&quot;javascript:alert('xss');&quot;</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span>userWebsite<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
</code></pre></div><p>如果没有对该 URL 进行过滤以防止通过 <code>javascript:</code> 或 <code>data:</code> 来执行 JavaScript，则攻击者可以构造 XSS 攻击，此处会有潜在的安全问题。 用户提供的 URL 需要在前端或者服务端在入库之前进行验证并过滤。</p> <p>服务端如何防止XSS攻击</p> <p>服务端作为最后一道防线，也需要做一些措施以防止 XSS 攻击，一般涉及以下几方面：</p> <ul><li>在接收到用户输入时，需要对输入进行尽可能严格的过滤，过滤或移除特殊的 HTML 标签、JS 事件的关键字等。</li> <li>在输出时对数据进行转义，根据输出语境 (html/javascript/css/url)，进行对应的转义</li> <li>对关键 Cookie 设置 http-only 属性，JS 脚本就不能访问到 http-only 的 Cookie 了</li> <li>利用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FCSP" target="_blank" rel="noopener noreferrer">CSP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来抵御或者削弱 XSS 攻击，一个 CSP 兼容的浏览器将会仅执行从白名单域获取到的脚本文件，忽略所有的其他脚本 (包括内联脚本和 HTML 的事件处理属性)</li></ul> <p>出现 XSS 漏洞本质上是输入输出验证不充分，React 在设计上已经很安全了，但是一些反模式的写法还是会引起安全漏洞。Vue 也是类似，Vue 做的安全措施主要也是转义，HTML 的内容和动态绑定的属性都会进行转义。无论使用 React 或 Vue 等前端框架，都不能百分百的防止 XSS 攻击，所以服务端必须对前端参数做一些验证，包括但不限于特殊字符转义、标签、属性白名单过滤等。一旦出现安全问题一般都是挺严重的，不管是敏感数据被窃取或者用户资金被盗，损失往往无法挽回。我们平时开发中需要保持安全意识，保持代码的可靠性和安全性。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3979e060.js" defer></script><script src="/assets/js/2.0f8cbb55.js" defer></script><script src="/assets/js/1.ff82b27c.js" defer></script><script src="/assets/js/72.46bd34f2.js" defer></script>
  </body>
</html>
