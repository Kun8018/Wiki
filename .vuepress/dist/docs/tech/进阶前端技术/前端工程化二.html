<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端进阶（一）-前端工程化</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.88b3a504.css" as="style"><link rel="preload" href="/assets/js/app.f8154061.js" as="script"><link rel="preload" href="/assets/js/2.4cccd600.js" as="script"><link rel="preload" href="/assets/js/62.e9ca8158.js" as="script"><link rel="prefetch" href="/assets/js/10.54f00d7a.js"><link rel="prefetch" href="/assets/js/11.3da5b74a.js"><link rel="prefetch" href="/assets/js/12.7fee73d6.js"><link rel="prefetch" href="/assets/js/13.76868392.js"><link rel="prefetch" href="/assets/js/14.73742d11.js"><link rel="prefetch" href="/assets/js/15.5f9a7bea.js"><link rel="prefetch" href="/assets/js/16.bc63dc43.js"><link rel="prefetch" href="/assets/js/17.cf9ef8d3.js"><link rel="prefetch" href="/assets/js/18.813f3d8e.js"><link rel="prefetch" href="/assets/js/19.381f5e21.js"><link rel="prefetch" href="/assets/js/20.e6f846bb.js"><link rel="prefetch" href="/assets/js/21.699eb7d8.js"><link rel="prefetch" href="/assets/js/22.9b419f3a.js"><link rel="prefetch" href="/assets/js/23.9e2fcc0f.js"><link rel="prefetch" href="/assets/js/24.c0934c78.js"><link rel="prefetch" href="/assets/js/25.4d32001d.js"><link rel="prefetch" href="/assets/js/26.6a089853.js"><link rel="prefetch" href="/assets/js/27.b32725bd.js"><link rel="prefetch" href="/assets/js/28.a7d1db61.js"><link rel="prefetch" href="/assets/js/29.ee4f84ac.js"><link rel="prefetch" href="/assets/js/3.6608d946.js"><link rel="prefetch" href="/assets/js/30.c1000c38.js"><link rel="prefetch" href="/assets/js/31.694fd1d6.js"><link rel="prefetch" href="/assets/js/32.ac026d3a.js"><link rel="prefetch" href="/assets/js/33.c8ee999f.js"><link rel="prefetch" href="/assets/js/34.6663a77a.js"><link rel="prefetch" href="/assets/js/35.da0b5d07.js"><link rel="prefetch" href="/assets/js/36.75f20762.js"><link rel="prefetch" href="/assets/js/37.df31ffd6.js"><link rel="prefetch" href="/assets/js/38.848c2684.js"><link rel="prefetch" href="/assets/js/39.9a7a0d1a.js"><link rel="prefetch" href="/assets/js/4.9660033f.js"><link rel="prefetch" href="/assets/js/40.ca8e34ae.js"><link rel="prefetch" href="/assets/js/41.ab3f4971.js"><link rel="prefetch" href="/assets/js/42.3f849176.js"><link rel="prefetch" href="/assets/js/43.9b90ce3e.js"><link rel="prefetch" href="/assets/js/44.196181d0.js"><link rel="prefetch" href="/assets/js/45.4ebcccbd.js"><link rel="prefetch" href="/assets/js/46.a68cdba9.js"><link rel="prefetch" href="/assets/js/47.d26979d7.js"><link rel="prefetch" href="/assets/js/48.f6c3543c.js"><link rel="prefetch" href="/assets/js/49.87b9dc0d.js"><link rel="prefetch" href="/assets/js/5.bbf68f26.js"><link rel="prefetch" href="/assets/js/50.0d956d0a.js"><link rel="prefetch" href="/assets/js/51.6d654f81.js"><link rel="prefetch" href="/assets/js/52.180028c6.js"><link rel="prefetch" href="/assets/js/53.688b8ed0.js"><link rel="prefetch" href="/assets/js/54.4760398b.js"><link rel="prefetch" href="/assets/js/55.79d61c82.js"><link rel="prefetch" href="/assets/js/56.22ba5d85.js"><link rel="prefetch" href="/assets/js/57.085d3e52.js"><link rel="prefetch" href="/assets/js/58.a778b7b9.js"><link rel="prefetch" href="/assets/js/59.2ea1a17d.js"><link rel="prefetch" href="/assets/js/6.690811ac.js"><link rel="prefetch" href="/assets/js/60.82c5f4a5.js"><link rel="prefetch" href="/assets/js/61.9851b4bf.js"><link rel="prefetch" href="/assets/js/63.44d8baf4.js"><link rel="prefetch" href="/assets/js/64.df339ab2.js"><link rel="prefetch" href="/assets/js/65.ac505688.js"><link rel="prefetch" href="/assets/js/66.3af3b829.js"><link rel="prefetch" href="/assets/js/67.41c1aab0.js"><link rel="prefetch" href="/assets/js/68.5d9e177d.js"><link rel="prefetch" href="/assets/js/69.d3e85f6e.js"><link rel="prefetch" href="/assets/js/7.491a7910.js"><link rel="prefetch" href="/assets/js/70.4494003e.js"><link rel="prefetch" href="/assets/js/71.6e2116c7.js"><link rel="prefetch" href="/assets/js/72.49cda61b.js"><link rel="prefetch" href="/assets/js/73.e7e66ead.js"><link rel="prefetch" href="/assets/js/74.5e98329f.js"><link rel="prefetch" href="/assets/js/75.3dd401e4.js"><link rel="prefetch" href="/assets/js/76.aabec56b.js"><link rel="prefetch" href="/assets/js/77.95564de2.js"><link rel="prefetch" href="/assets/js/78.69634719.js"><link rel="prefetch" href="/assets/js/79.6fcc3d23.js"><link rel="prefetch" href="/assets/js/8.63bf7718.js"><link rel="prefetch" href="/assets/js/9.58039158.js">
    <link rel="stylesheet" href="/assets/css/0.styles.88b3a504.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>前端的基础是html、css和JavaScript，掌握这些能够实现基本的功能和整齐的样式。掌握vue或者react框架能够快速实现spa应用。</p> <p>​       对于进阶，掌握基本原理和一些动画方面的库能够更美观的进行展现，实现更炫酷的动画效果。</p> <h2 id="webpack原理"><a href="#webpack原理" class="header-anchor">#</a> webpack原理</h2> <h3 id="tree-shaking原理"><a href="#tree-shaking原理" class="header-anchor">#</a> tree shaking原理</h3> <p>Tree-shaking的本质是消除无用的js代码。无用代码消除在广泛存在于传统的编程语言编译器中，编译器可以判断出某些代码根本不影响输出，然后消除这些代码，这个称之为DCE（dead code elimination）</p> <p>Tree-shaking 是 DCE 的一种新的实现，Javascript同传统的编程语言不同的是，javascript绝大多数情况需要通过网络进行加载，然后执行，加载的文件大小越小，整体执行时间更短，所以去除无用代码以减少文件体积，对javascript来说更有意义。</p> <p>Tree-shaking 和传统的 DCE的方法又不太一样，传统的DCE 消灭不可能执行的代码，而Tree-shaking 更关注宇消除没有用到的代码。</p> <p>Dead Code 一般具有以下几个特征</p> <p>•代码不会被执行，不可到达</p> <p>•代码执行的结果不会被用到</p> <p>•代码只会影响死变量（只写不读）</p> <p>JavaScript代码的tree shaking不是rollup，webpack，cc做的，而是著名的代码压缩优化工具uglify，uglify完成了javascript的DCE。</p> <p>模块必须采用ES6Module语法，因为treeShaking依赖ES6的静态语法：import 和 export。如果项目中使用了babel的话， <code>@babel/preset-env</code>默认将模块转换成CommonJs语法，因此需要设置<code>module：false</code>，webpack2后已经支持ESModule。</p> <p>ES6模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析，这就是tree-shaking的基础。</p> <p>所谓静态分析就是不执行代码，从字面量上对代码进行分析，ES6之前的模块化，比如我们可以动态require一个模块，只有执行后才知道引用的什么模块，这个就不能通过静态分析去做优化。</p> <p>原理总结：</p> <ul><li>只能作为模块顶层的语句出现</li> <li>import的模块名只能是字符串常量</li> <li>import binding 是 immutable的，引入的模块不能再进行修改</li></ul> <p>代码删除：</p> <ul><li>uglify：判断程序流，判断变量是否被使用和引用，进而删除代码</li></ul> <p>tree shaking具体能做的事情：</p> <p>1.Webpack Tree shaking从ES6顶层模块开始分析，可以清除未使用的模块</p> <p>2.Webpack Tree shaking会对多层调用的模块进行重构，提取其中的代码，简化函数的调用结构</p> <p>3.Webpack Tree shaking不会清除IIFE(立即调用函数表达式)：因为IIFE比较特殊，它在被翻译时(JS并非编译型的语言)就会被执行，Webpack不做程序流分析，它不知道IIFE会做什么特别的事情，所以不会删除这部分代码</p> <p>4.Webpack Tree shaking对于IIFE的返回函数，如果未使用会被清除</p> <p>5.Webpack Tree shaking结合第三方包使用，引入第三方包时不同的方式会造成不同的优化</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//全部引入，webpack不能清理</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>last<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span>
<span class="token comment">//第三种打包体积减少</span>
<span class="token keyword">import</span> last <span class="token keyword">from</span> <span class="token string">'lodash/last'</span><span class="token punctuation">;</span> 
</code></pre></div><p>链接：https://juejin.cn/post/6844903544756109319<code>side effects</code>是指那些当<code>import</code>的时候会执行一些动作，但是不一定会有任何<code>export</code>。比如<code>ployfill</code>,<code>ployfills</code>不对外暴露方法给主程序使用。</p> <p><code>tree shaking</code> 不能自动的识别哪些代码属于<code>side effects</code>，因此手动指定这些代码显得非常重要，如果不指定可能会出现一些意想不到的问题。</p> <p>在<code>webapck中</code>，是通过<code>package.json</code>的<code>sideEffects</code>属性来实现的。</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;name&quot;: &quot;tree-shaking&quot;,
  &quot;sideEffects&quot;: false
}
</code></pre></div><p>如果所有代码都不包含副作用，我们就可以简单地将该属性标记为<code>false</code>，来告知 <code>webpack</code>，它可以安全地删除未用到的<code>export</code>导出。</p> <p>如果你的代码确实有一些副作用，那么可以改为提供一个数组：</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;name&quot;: &quot;tree-shaking&quot;,
  &quot;sideEffects&quot;: [
    &quot;./src/common/polyfill.js&quot;
  ]
}
</code></pre></div><h3 id="hmr原理"><a href="#hmr原理" class="header-anchor">#</a> HMR原理</h3> <p>Hot Module Replace是webpack一个重要的特性，当代码文件修改并保存之后，webapck通过watch监听到文件发生变化，会对代码文件重新打包生成两个模块补丁文件manifest（js）和一个（或多个）updated chunk（js），将结果存储在内存文件系统中，通过websocket通信机制将重新打包的模块发送到浏览器端，浏览器动态的获取新的模块补丁替换旧的模块，浏览器不需要刷新页面就可以实现应用的更新。</p> <p>HMR的工作原理</p> <p>1.webpack --watch启动监听模式之后，webpack第一次编译项目，并将结果存储在内存文件系统，相比较磁盘文件读写方式内存文件管理速度更快，内存webpack服务器通知浏览器加载资源，浏览器获取的静态资源除了JS code内容之外，还有一部分通过webpack-dev-server注入的的 HMR runtime代码，作为浏览器和webpack服务器通信的客户端（ webpack-hot-middleware提供类似的功能）。</p> <p>2.文件系统中一个文件（或者模块）发生变化，webpack监听到文件变化对文件重新编译打包，每次编译生成唯一的hash值，根据变化的内容生成两个补丁文件：说明变化内容的manifest（文件格式是hash.hot-update.json，包含了hash和chundId用来说明变化的内容）和chunk js（hash.hot-update.js）模块。</p> <p>3.hrm-server通过websocket将manifest推送给浏览器</p> <p>浏览器接受到最新的hotCurrentHash，触发 hotDownloadManifest 函数，获取manifest json 文件。</p> <p>4.浏览器端hmr runtime根据manifest的hash和chunkId使用ajax拉取最新的更新模块chunk</p> <p>5.触发render流程实现局部热重载</p> <p>HMR runtime 调用window[&quot;webpackHotUpdate&quot;] 方法，调用hotAddUpdateChunk</p> <p>HMR相关的中间件</p> <ol><li><strong>webpack-dev-middleware</strong></li></ol> <p>本质上是一个容器，将webpack处理后的文件传递个服务器。</p> <p>webpack-dev-middleware 是一个 express 中间件，核心实现两个功能：第一通过file-loader内部集成了node的 monery-fs/memfs 内部文件系统,，直接将资源存储在内存；第二是通过watch监听文件的变化，动态编译。</p> <p><strong>2.webpack-hot-middleware</strong></p> <p>核心是给webpack提高服务端和客户端之间的通信机制，内部使用windoe.EventSocurce实现。</p> <p>在webpack第一次打包的时候，除了代码本身之外，还包含一部分HMRruntime订阅服务代码，HMRruntime 订阅服务端的更新变化，触发HMR runtime API拉取最新的资源模块。</p> <p>webpack-hot-middleware实现页面的热重载。</p> <p><strong>3. webpack-dev-server</strong></p> <p>内置了webpack-dev-middleware和express服务器，利用webpack-dev-middleware提供文件的监听和编译，利用express提供http服务，底层利用websocket代替EventSource实现了webpack-hot-middleware提供的客户端和服务器之间的通信机制。</p> <h3 id="webpack生命周期-构建原理"><a href="#webpack生命周期-构建原理" class="header-anchor">#</a> webpack生命周期/构建原理</h3> <p>从启动构建到输出结果一系列过程：</p> <p>（1）初始化参数：解析webpack配置参数，合并shell传入和webpack.config.js文件配置的参数，形成最后的配置结果。</p> <p>（2）开始编译：上一步得到的参数初始化compiler对象，注册所有配置的插件，插件监听webpack构建生命周期的事件节点，做出相应的反应，执行对象的 run 方法开始执行编译。</p> <p>（3）确定入口：从配置的entry入口，开始解析文件构建AST语法树，找出依赖，递归下去。</p> <p>（4）编译模块：递归中根据文件类型和loader配置，调用所有配置的loader对文件进行转换，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理。</p> <p>（5）完成模块编译并输出：递归完事后，得到每个文件结果，包含每个模块以及他们之间的依赖关系，根据entry配置生成代码块chunk。</p> <p>（6）输出完成：输出所有的chunk到文件系统。</p> <p>注意：在构建生命周期中有一系列插件在做合适的时机做合适事情，比如UglifyPlugin会在loader转换递归完对结果使用UglifyJs压缩覆盖之前的结果。</p> <h3 id="webpack与gulp、grunt区别"><a href="#webpack与gulp、grunt区别" class="header-anchor">#</a> webpack与gulp、grunt区别</h3> <p>webpack 是 module bundle</p> <p>gulp 是 tast runner</p> <p>Rollup 是在 Webpack 流行后出现的替代品。Rollup 在用于打包 JavaScript 库时比 Webpack 更加有优势，因为其打包出来的代码更小更快。 但功能不够完善，很多场景都找不到现成的解决方案。</p> <h2 id="分离-合并配置"><a href="#分离-合并配置" class="header-anchor">#</a> 分离/合并配置</h2> <p>安装webpack-merge</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i webpack-merge -D
</code></pre></div><p>在webpackjs中引入别的webpack配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>merge<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token operator">:</span><span class="token string">'production'</span><span class="token punctuation">,</span>
    <span class="token comment">//可以找出报错代码的源代码路径</span>
    <span class="token comment">//cheap 只报告行号（不加会报告列）  module 会报告loader及第三方依赖的错误位置</span>
    <span class="token comment">//加了inline就不产生映射文件了</span>
    <span class="token comment">//生产环境不需要eval</span>
    devtool<span class="token operator">:</span><span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span>prodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="webpack-chain"><a href="#webpack-chain" class="header-anchor">#</a> webpack-chain</h2> <h2 id="webpack插件汇总"><a href="#webpack插件汇总" class="header-anchor">#</a> Webpack插件汇总</h2> <h3 id="功能类"><a href="#功能类" class="header-anchor">#</a> 功能类</h3> <p>html-webpack-plugin</p> <p>自动生成html，基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token comment">// 生成文件名</span>
  template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'./index.html'</span><span class="token punctuation">)</span> <span class="token comment">// 模班文件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>copy-webpack-plugin</p> <p>拷贝资源插件,copy-webpack-plugin不是为了复制构建过程中生成的文件，相反，它是复制源树中已经存在的文件，作为构建过程的一部分</p> <p>基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">from</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'./vendor/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    to<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'./dist/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ignore<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*.json'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>webpack-manifest-plugin &amp;&amp; assets-webpack-plugin</p> <p>俩个插件效果一致，都是生成编译结果的资源单，只是资源单的数据结构不一致而已。</p> <p>webpack-manifest-plugin 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ManifestPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>assets-webpack-plugin 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">AssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>clean-webpack-plugin</p> <p>在编译之前清理指定目录指定内容,基本用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 清理目录</span>
<span class="token keyword">const</span> pathsToClean <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'dist'</span><span class="token punctuation">,</span>
  <span class="token string">'build'</span>
<span class="token punctuation">]</span>
 
<span class="token comment">// 清理参数</span>
<span class="token keyword">const</span> cleanOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  exclude<span class="token operator">:</span>  <span class="token punctuation">[</span><span class="token string">'shared.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 跳过文件</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span>pathsToClean<span class="token punctuation">,</span> cleanOptions<span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>compression-webpack-plugin</p> <p>提供带 Content-Encoding 编码的压缩版的资源,基本用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>progress-bar-webpack-plugin</p> <p>编译进度条插件,基本用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ProgressBarPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>speed-measure-webpack-plugin</p> <p>进行构建速度分析，可以看到各个 loader、plugin 的构建时长，后续可针对耗时 loader、plugin 进行优化。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i -D speed-measure-webpack-plugin
</code></pre></div><p>使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> SpeedMeasurePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;speed-measure-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...webpack config...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="代码相关类"><a href="#代码相关类" class="header-anchor">#</a> 代码相关类</h3> <p>webpack.ProvidePlugin</p> <p>自动加载模块，如 出现，就会自动加载模块；出现，就会自动加载模块； 默认为'jquery'的exports，用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>webpack.DefinePlugin</p> <p>定义全局常量，用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'process.env'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>mini-css-extract-plugin &amp;&amp; extract-text-webpack-plugin</p> <p>提取css样式，对比：</p> <ul><li>mini-css-extract-plugin 为webpack4及以上提供的plugin，支持css chunk</li> <li>extract-text-webpack-plugin 只能在webpack3 及一下的版本使用，不支持css chunk</li></ul> <p>extract-text-webpack-plugin基本用法 ：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;extract-text-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          fallback<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">&quot;styles.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>mini-css-extract-plugin 基本用法:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              publicPath<span class="token operator">:</span> <span class="token string">'/'</span>  <span class="token comment">// chunk publicPath</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 主文件名</span>
      chunkFilename<span class="token operator">:</span> <span class="token string">&quot;[id].css&quot;</span>  <span class="token comment">// chunk文件名</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="编译结果优化类"><a href="#编译结果优化类" class="header-anchor">#</a> 编译结果优化类</h3> <p>wbepack.IgnorePlugin</p> <p>忽略regExp匹配的模块，用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/locale$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
</code></pre></div><p>uglifyjs-webpack-plugin</p> <p>代码丑化，用于js压缩,</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">// 开启缓存</span>
      parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启多线程编译</span>
      sourceMap<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 是否sourceMap</span>
      uglifyOptions<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 丑化参数</span>
        comments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        compress<span class="token operator">:</span> <span class="token punctuation">{</span>
          unused<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          dead_code<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          collapse_vars<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          reduce_vars<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">{</span>
          comments<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>optimize-css-assets-webpack-plugin</p> <p>css压缩，主要使用 <a href="https://github.com/cssnano/cssnano" target="_blank" rel="noopener noreferrer">cssnano<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 压缩器,用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      cssProcessor<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// css 压缩优化器</span>
      cssProcessorOptions<span class="token operator">:</span> <span class="token punctuation">{</span> discardComments<span class="token operator">:</span> <span class="token punctuation">{</span> removeAll<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token comment">// 去除所有注释</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack-md5-hash</p> <p>使你的chunk根据内容生成md5，用这个md5取代 webpack chunkhash,基本用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> WebpackMd5Hash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-md5-hash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">&quot;[chunkhash].[id].chunk.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">WebpackMd5Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>SplitChunksPlugin</p> <p>CommonChunkPlugin 的后世，用于chunk切割。</p> <p>webpack 把 chunk 分为两种类型，一种是初始加载initial chunk，另外一种是异步加载 async chunk，如果不配置SplitChunksPlugin，webpack会在production的模式下自动开启，默认情况下，webpack会将 node_modules 下的所有模块定义为异步加载模块，并分析你的 entry、动态加载（import()、require.ensure）模块，找出这些模块之间共用的node_modules下的模块，并将这些模块提取到单独的chunk中，在需要的时候异步加载到页面当中，其中默认配置如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 异步加载chunk</span>
      minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token comment">// 文件名中chunk分隔符</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">// </span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">// 最小的共享chunk数</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="编译优化类"><a href="#编译优化类" class="header-anchor">#</a> 编译优化类</h3> <p>DllPlugin &amp;&amp; DllReferencePlugin &amp;&amp; autodll-webpack-plugin</p> <p>dllPlugin 将模块预先编译，DllReferencePlugin 将预先编译好的模块关联到当前编译中，当 webpack 解析到这些模块时，会直接使用预先编译好的模块。</p> <p>autodll-webpack-plugin 相当于 dllPlugin 和 DllReferencePlugin 的简化版，其实本质也是使用 dllPlugin &amp;&amp; DllReferencePlugin，它会在第一次编译的时候将配置好的需要预先编译的模块编译在缓存中，第二次编译的时候，解析到这些模块就直接使用缓存，而不是去编译这些模块。</p> <p>dllPlugin 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token punctuation">{</span>
  filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
  library<span class="token operator">:</span> <span class="token string">'[name]_library'</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">'./vendor/'</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    vendor<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'react-dom'</span><span class="token punctuation">]</span>  <span class="token comment">// 我们需要事先编译的模块，用entry表示</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> output<span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">// 使用dllPlugin</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>output<span class="token punctuation">.</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> output<span class="token punctuation">.</span>library <span class="token comment">// 全局变量名， 也就是 window 下 的 [output.library]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>DllReferencePlugin 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> manifest <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span> <span class="token string">'vendor.js.json'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span>manifest<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 引进dllPlugin编译的json文件</span>
      name<span class="token operator">:</span> <span class="token string">'vendor_library'</span> <span class="token comment">// 全局变量名，与dllPlugin声明的一致</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>autodll-webpack-plugin 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">AutoDllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      inject<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 与 html-webpack-plugin 结合使用，注入html中</span>
      filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
      entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendor<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'react'</span><span class="token punctuation">,</span>
          <span class="token string">'react-dom'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>happypack &amp;&amp; thread-loader</p> <p>多线程编译，加快编译速度，thread-loader不可以和 mini-css-extract-plugin 结合使用。</p> <p>happypack 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> happyThreadPool <span class="token operator">=</span> HappyPack<span class="token punctuation">.</span><span class="token function">ThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span> size<span class="token operator">:</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> happyLoaderId <span class="token operator">=</span> <span class="token string">'happypack-for-react-babel-loader'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      loader<span class="token operator">:</span> <span class="token string">'happypack/loader'</span><span class="token punctuation">,</span>
      query<span class="token operator">:</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> happyLoaderId
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> happyLoaderId<span class="token punctuation">,</span>
    threadPool<span class="token operator">:</span> happyThreadPool<span class="token punctuation">,</span>
    loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>thread-loader 基本用法:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;thread-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token comment">// your expensive loader (e.g babel-loader)</span>
          <span class="token string">&quot;babel-loader&quot;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>hard-source-webpack-plugin &amp;&amp; cache-loader</p> <p>使用模块编译缓存，加快编译速度。</p> <p>hard-source-webpack-plugin ,基本用法:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>cache-loader 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.ext$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'cache-loader'</span><span class="token punctuation">,</span>
          <span class="token operator">...</span>loaders
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="编译分析类"><a href="#编译分析类" class="header-anchor">#</a> 编译分析类</h3> <p>webpack-bundle-analyzer</p> <p>编译模块分析插件，基本用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  analyzerMode<span class="token operator">:</span> <span class="token string">'server'</span><span class="token punctuation">,</span>
  analyzerHost<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
  analyzerPort<span class="token operator">:</span> <span class="token number">8889</span><span class="token punctuation">,</span>
  reportFilename<span class="token operator">:</span> <span class="token string">'report.html'</span><span class="token punctuation">,</span>
  defaultSizes<span class="token operator">:</span> <span class="token string">'parsed'</span><span class="token punctuation">,</span>
  generateStatsFile<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  statsFilename<span class="token operator">:</span> <span class="token string">'stats.json'</span><span class="token punctuation">,</span>
  statsOptions<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  logLevel<span class="token operator">:</span> <span class="token string">'info'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>stats-webpack-plugin &amp;&amp; PrefetchPlugin</p> <p>stats-webpack-plugin 将构建的统计信息写入文件，该文件可在 http://webpack.github.io/analyse中上传进行编译分析，并根据分析结果，可使用 PrefetchPlugin 对部分模块进行预解析编译</p> <p>stats-webpack-plugin 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">StatsPlugin</span><span class="token punctuation">(</span><span class="token string">'stats.json'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      chunkModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules[\\\/]react</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>PrefetchPlugin 基本用法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>PrefetchPlugin</span><span class="token punctuation">(</span><span class="token string">'/web/'</span><span class="token punctuation">,</span> <span class="token string">'app/modules/HeaderNav.jsx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>PrefetchPlugin</span><span class="token punctuation">(</span><span class="token string">'/web/'</span><span class="token punctuation">,</span> <span class="token string">'app/pages/FrontPage.jsx'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>speed-measure-webpack-plugin</p> <p>统计编译过程中，各loader和plugin使用的时间,基本用法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> SpeedMeasurePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;speed-measure-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MyOtherPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="react相关"><a href="#react相关" class="header-anchor">#</a> react相关</h3> <p>react-refresh-webpack-plugin</p> <p>热更新 react 组件。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> -D @pmmmwh/react-refresh-webpack-plugin react-refresh
</code></pre></div><p>使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> ReactRefreshWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@pmmmwh/react-refresh-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">ReactRefreshWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="上传oss"><a href="#上传oss" class="header-anchor">#</a> 上传oss</h3> <p>如果希望webpack可以自动上传静态资源（如js，css等）到阿里云oss上，可以使用webpack-aliyun-oss这款插件</p> <p>安装</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i webpack-aliyun-oss -D
</code></pre></div><p>配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> WebpackAliyunOss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-aliyun-oss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 省略其他</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">WebpackAliyunOss</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">from</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./build/**'</span><span class="token punctuation">,</span> <span class="token string">'!./build/**/*.html'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//排除html文件</span>
    dist<span class="token operator">:</span> <span class="token string">'path/in/alioss'</span><span class="token punctuation">,</span>
    region<span class="token operator">:</span> <span class="token string">'your region'</span><span class="token punctuation">,</span>
    accessKeyId<span class="token operator">:</span> <span class="token string">'your key'</span><span class="token punctuation">,</span>
    accessKeySecret<span class="token operator">:</span> <span class="token string">'your secret'</span><span class="token punctuation">,</span>
    bucket<span class="token operator">:</span> <span class="token string">'your bucket'</span><span class="token punctuation">,</span>
    
    <span class="token comment">// 如果希望重新组织上传路径，可以传这个函数</span>
    <span class="token comment">// 否则按构建目录的结构上传</span>
    <span class="token function">setOssPath</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// filePath为当前文件路径，函数应该返回路径+文件名，如/new/path/to/file.js，则最终上传路径为 path/in/alioss/new/path/to/file.js</span>
      
      <span class="token keyword">return</span> <span class="token string">'/new/path/to/file.js'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token comment">// 如果想定义header就传</span>
    <span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 定义当前文件header，可选</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">'Cache-Control'</span><span class="token operator">:</span> <span class="token string">'max-age=31536000'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><div class="language- extra-class"><pre class="language-text"><code>from
</code></pre></div><p>: 上传哪些文件，支持类似gulp.src的glob方法，如'./build/**', 可以为glob字符串或者数组。</p> <ul><li>作为插件使用时：可选，默认为output.path下所有的文件。</li> <li>独立使用时：必须，否则不知道从哪里取图片：）</li></ul></li> <li><p><code>dist</code>: 上传到oss哪个目录下，默认为oss根目录。可作为路径前缀使用。</p></li> <li><p><code>region</code>: 阿里云上传区域</p></li> <li><p><code>accessKeyId</code>: 阿里云的授权accessKeyId</p></li> <li><p><code>accessKeySecret</code>: 阿里云的授权accessKeySecret</p></li> <li><p><code>bucket</code>: 上传到哪个bucket</p></li> <li><p><code>timeout</code>: oss超时设置，默认为30秒(30000)</p></li> <li><p><code>verbose</code>: 是否显示上传日志，默认为true</p></li> <li><p><code>deletOrigin</code>: 上传完成是否删除原文件，默认false</p></li> <li><p><code>deleteEmptyDir</code>: 如果某个目录下的文件都上传到cdn了，是否删除此目录。deleteOrigin为true时候生效。默认false。</p></li> <li><p><code>setOssPath</code>: 自定义上传路径的函数。接收参数为当前文件路径。不传，或者所传函数返回false则按默认路径上传。(默认为output.path下文件路径)</p></li> <li><p><code>setHeaders</code>: 配置headers的函数。接收参数为当前文件路径。不传，或者所传函数返回false则不设置header。</p></li> <li><p><code>test</code>: 测试，仅显示要上传的文件，但是不执行上传操作。默认false</p></li></ul> <h2 id="利用source-map还原代码"><a href="#利用source-map还原代码" class="header-anchor">#</a> 利用source-map还原代码</h2> <p>webpack打包时如果有配置sourcemap，可能在生成js时生成对应的map文件，而利用这个文件甚至可以还原js和组件</p> <p>reverse-sourcemap</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> --global reverse-sourcemap
</code></pre></div><p>找到webpack生成的js对应的map文件，一般为js.map文件，进行还原</p> <div class="language-shell extra-class"><pre class="language-shell"><code>
</code></pre></div><h2 id="webpack学习资源"><a href="#webpack学习资源" class="header-anchor">#</a> webpack学习资源</h2> <p>wepack：https://www.kancloud.cn/sllyli/webpack/1242354</p> <p>深入浅出webpack：https://webpack.wuhaolin.cn/</p> <p>​</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f8154061.js" defer></script><script src="/assets/js/2.4cccd600.js" defer></script><script src="/assets/js/62.e9ca8158.js" defer></script>
  </body>
</html>
