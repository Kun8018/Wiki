<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React（三） | Kun&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="meta的描述内容">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.528f3631.js" as="script"><link rel="preload" href="/assets/js/2.619c82a8.js" as="script"><link rel="preload" href="/assets/js/21.cbe0d8e0.js" as="script"><link rel="prefetch" href="/assets/js/10.ac7a4de3.js"><link rel="prefetch" href="/assets/js/11.22193742.js"><link rel="prefetch" href="/assets/js/12.6b0d96a8.js"><link rel="prefetch" href="/assets/js/13.bb592c98.js"><link rel="prefetch" href="/assets/js/14.5aadcb22.js"><link rel="prefetch" href="/assets/js/15.78a91f28.js"><link rel="prefetch" href="/assets/js/16.0463299b.js"><link rel="prefetch" href="/assets/js/17.5ade6be6.js"><link rel="prefetch" href="/assets/js/18.ae21993d.js"><link rel="prefetch" href="/assets/js/19.381fa6fe.js"><link rel="prefetch" href="/assets/js/20.5ccce5c5.js"><link rel="prefetch" href="/assets/js/22.dec488e3.js"><link rel="prefetch" href="/assets/js/23.bd6e325e.js"><link rel="prefetch" href="/assets/js/24.7f63c0c1.js"><link rel="prefetch" href="/assets/js/25.e9d2ca3d.js"><link rel="prefetch" href="/assets/js/26.2ca2fcb2.js"><link rel="prefetch" href="/assets/js/27.9bbd6fb4.js"><link rel="prefetch" href="/assets/js/28.d07f52f0.js"><link rel="prefetch" href="/assets/js/29.69fc0484.js"><link rel="prefetch" href="/assets/js/3.983c5940.js"><link rel="prefetch" href="/assets/js/30.95ebca2d.js"><link rel="prefetch" href="/assets/js/31.0119a78d.js"><link rel="prefetch" href="/assets/js/32.1be9fafc.js"><link rel="prefetch" href="/assets/js/33.463bffa3.js"><link rel="prefetch" href="/assets/js/34.e343d136.js"><link rel="prefetch" href="/assets/js/35.7484c5cf.js"><link rel="prefetch" href="/assets/js/36.5aff1e2a.js"><link rel="prefetch" href="/assets/js/37.d06aba3d.js"><link rel="prefetch" href="/assets/js/38.bf208dc8.js"><link rel="prefetch" href="/assets/js/39.30052380.js"><link rel="prefetch" href="/assets/js/4.2fb93bc2.js"><link rel="prefetch" href="/assets/js/40.08ee34f0.js"><link rel="prefetch" href="/assets/js/41.dcd825b5.js"><link rel="prefetch" href="/assets/js/42.487f0aa8.js"><link rel="prefetch" href="/assets/js/43.67a7ad8b.js"><link rel="prefetch" href="/assets/js/44.357ba709.js"><link rel="prefetch" href="/assets/js/45.a590454b.js"><link rel="prefetch" href="/assets/js/46.e7870e58.js"><link rel="prefetch" href="/assets/js/47.abdb75cf.js"><link rel="prefetch" href="/assets/js/48.0a5ab934.js"><link rel="prefetch" href="/assets/js/49.663acd27.js"><link rel="prefetch" href="/assets/js/5.1474cf9c.js"><link rel="prefetch" href="/assets/js/50.96ef16fe.js"><link rel="prefetch" href="/assets/js/51.e0b76e5e.js"><link rel="prefetch" href="/assets/js/52.a909ae03.js"><link rel="prefetch" href="/assets/js/53.b3e7bb38.js"><link rel="prefetch" href="/assets/js/54.d2a5e7cf.js"><link rel="prefetch" href="/assets/js/55.41bdb3fe.js"><link rel="prefetch" href="/assets/js/56.58b21e41.js"><link rel="prefetch" href="/assets/js/57.c3d18e9a.js"><link rel="prefetch" href="/assets/js/58.dc3e0326.js"><link rel="prefetch" href="/assets/js/59.e2e30a9a.js"><link rel="prefetch" href="/assets/js/6.2958d7f8.js"><link rel="prefetch" href="/assets/js/60.8f5cef73.js"><link rel="prefetch" href="/assets/js/61.cf6b261c.js"><link rel="prefetch" href="/assets/js/62.54bae72d.js"><link rel="prefetch" href="/assets/js/63.8ef19855.js"><link rel="prefetch" href="/assets/js/64.4b33c41d.js"><link rel="prefetch" href="/assets/js/65.24a33653.js"><link rel="prefetch" href="/assets/js/7.4f3f4813.js"><link rel="prefetch" href="/assets/js/8.af6b4dfd.js"><link rel="prefetch" href="/assets/js/9.0ac2d280.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kun's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  科研
</a></div><div class="nav-item"><a href="/shoot/" class="nav-link">
  摄影
</a></div><div class="nav-item"><a href="https://www.github.com/kun8018" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  科研
</a></div><div class="nav-item"><a href="/shoot/" class="nav-link">
  摄影
</a></div><div class="nav-item"><a href="https://www.github.com/kun8018" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Tech</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/" aria-current="page" class="sidebar-link">Blogging Like a Hacker</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/react/react.html" class="sidebar-link">React</a></li><li><a href="/tech/react/react2.html" class="sidebar-link">React（二）</a></li><li><a href="/tech/react/react3.html" aria-current="page" class="active sidebar-link">React（三）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react原理" class="sidebar-link">React原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/react/react3.html#setstate原理" class="sidebar-link">setState原理</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#setstate的异步同步" class="sidebar-link">setState的异步同步</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-diff算法的机制" class="sidebar-link">react diff算法的机制</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react渲染机制-work-loop" class="sidebar-link">React渲染机制(work loop)</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#effect-hook机制" class="sidebar-link">Effect Hook机制</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#state、reducer-hook机制" class="sidebar-link">State、Reducer Hook机制</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#hook系统原理" class="sidebar-link">Hook系统原理</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#redux-reducer" class="sidebar-link">redux-reducer</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#redux中间件机制" class="sidebar-link">redux中间件机制</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#redux-compose实现" class="sidebar-link">Redux compose实现</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#利用context-api实现redux" class="sidebar-link">利用context api实现redux</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-router原理" class="sidebar-link">React-router原理</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#手写自定义hook-实现切换状态" class="sidebar-link">手写自定义hook，实现切换状态</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react优化" class="sidebar-link">React优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/react/react3.html#懒渲染react-visibility-observer" class="sidebar-link">懒渲染react-visibility-observer</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react库" class="sidebar-link">react库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-helmet" class="sidebar-link">react-helmet</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#使用antd" class="sidebar-link">使用antd</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#graphql" class="sidebar-link">GraphQL</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#eventbus" class="sidebar-link">eventbus</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-beautiful-dnd" class="sidebar-link">react-beautiful-dnd</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-dnd" class="sidebar-link">react-dnd</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-intl-universal" class="sidebar-link">react-intl-universal</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-hot-loader" class="sidebar-link">react-hot-loader</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#uuid" class="sidebar-link">uuid</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#js-cookie" class="sidebar-link">js-cookie</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-color" class="sidebar-link">react-color</a></li><li class="sidebar-sub-header"><a href="/tech/react/react3.html#react-lazyload" class="sidebar-link">react-lazyload</a></li></ul></li></ul></li><li><a href="/tech/react/react4.html" class="sidebar-link">React（四）</a></li><li><a href="/tech/react/reactnative.html" class="sidebar-link">React Native入门</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>周边开发技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据库相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>服务器技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>桌面端开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>移动端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>静态语言</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>业余研究</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关于</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>科学研究</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>​      前端框架，快速开发页面，函数式编程，与后端api快速搭建</p> <h2 id="react原理"><a href="#react原理" class="header-anchor">#</a> React原理</h2> <h3 id="setstate原理"><a href="#setstate原理" class="header-anchor">#</a> setState原理</h3> <p>setState的执行过程：</p> <p>1.将setState传入的<code>partialState</code>参数存储在当前组件实例的state暂存队列中。</p> <p>2.判断当前React是否处于批量更新状态，如果是，将当前组件加入待更新的组件队列中。</p> <p>3.如果未处于批量更新状态，将批量更新状态标识设置为true，用事务再次调用前一步方法，保证当前组件加入到了待更新组件队列中。</p> <p>4.调用事务的<code>waper</code>方法，遍历待更新组件队列依次执行更新。</p> <p>5.执行生命周期<code>componentWillReceiveProps</code>。</p> <p>6.将组件的state暂存队列中的<code>state</code>进行合并，获得最终要更新的state对象，并将队列置为空。</p> <p>7.执行生命周期<code>componentShouldUpdate</code>，根据返回值判断是否要继续更新。</p> <p>8.执行生命周期<code>componentWillUpdate</code>。</p> <p>9.执行真正的更新，<code>render</code>。</p> <p>10.执行生命周期<code>componentDidUpdate</code>。</p> <h3 id="setstate的异步同步"><a href="#setstate的异步同步" class="header-anchor">#</a> setState的异步同步</h3> <p>有时表现出异步,有时表现出同步</p> <p><code>setState</code>只在合成事件和钩子函数中是“异步”的，在原生事件和<code>setTimeout</code> 中都是同步的。</p> <p><code>setState</code> 的“异步”并不是说内部由异步代码实现，其实本身执行的过程和代码都是同步的，只是合成事件和钩子函数的调用顺序在更新之前，导致在合成事件和钩子函数中没法立马拿到更新后的值，形成了所谓的“异步”，当然可以通过第二个参数 <code>setState(partialState, callback)</code> 中的<code>callback</code>拿到更新后的结果。</p> <p>在<code>react</code>的生命周期和合成事件中，<code>react</code>仍然处于他的更新机制中，这时<code>isBranchUpdate</code>为true。</p> <p>按照上述过程，这时无论调用多少次<code>setState</code>，都会不会执行更新，而是将要更新的<code>state</code>存入<code>_pendingStateQueue</code>，将要更新的组件存入<code>dirtyComponent</code>。</p> <p>当上一次更新机制执行完毕，以生命周期为例，所有组件，即最顶层组件<code>didmount</code>后会将<code>isBranchUpdate</code>设置为false。这时将执行之前累积的<code>setState</code>。</p> <p><code>setState</code> 的批量更新优化也是建立在“异步”（合成事件、钩子函数）之上的，在原生事件和setTimeout 中不会批量更新，在“异步”中如果对同一个值进行多次<code>setState</code>，<code>setState</code>的批量更新策略会对其进行覆盖，取最后一次的执行，如果是同时<code>setState</code>多个不同的值，在更新时会对其进行合并批量更新。</p> <p>也就是说，一个方法里需要多次调用setState，setState了很多次，然后render（）只调用了一次</p> <p>原因：</p> <p>React会将多个this.setState产生的修改放在一个队列里，缓一缓，攒在一起，觉得差不多了再引发一次更新过程。</p> <p>react为了提高整体的渲染性能，会将一次渲染周期中的state进行合并，在这个渲染周期中你对所有setState的所有调用都会被合并起来之后，再一次性的渲染，这样可以避免频繁的调用setState导致频繁的操作dom，提高渲染性能。具体的实现方面，可以简单的理解为react中存在一个状态变量isBatchingUpdates，当处于渲染周期开始时，这个变量会被设置成true，渲染周期结束时，会被设置成false，react会根据这个状态变量，当出在渲染周期中时，仅仅只是将当前的改变缓存起来，等到渲染周期结束时，再一次性的全部render。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>1.调用setState不会立即更新
2.所有组件使用的是同一套更新机制，当所有组件didmount后，父组件didmount，然后执行更新
3.更新时会把每个组件的更新合并，每个组件只会触发一次更新的生命周期。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="setstate更新数组"><a href="#setstate更新数组" class="header-anchor">#</a> setstate更新数组</h4> <p>对于数组和对象这种引用类型的数据，setstate只能改变引用地址，改变时只能用新的对象或者数组赋值，不能直接在原对象上改</p> <p>可以使用原生js或者react官方推荐immutablejs更新数组</p> <p>实例</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>//错误例子
var list = [1];
list.push(2)
//list对象已经变化，然而引用的值依然还是同一个引用

//正确更新数组
var list = this.state.list;
this.setState({
  list:list.concat('otherData')
})

this.setState({
  list:[...list,'otherData']
})

//正确更新对象
//使用object.assign方法
var user = this.state.user;
this.setState({
  user.Object.assign({},user,{age:18})
})
//使用对象拓展语法
var user = this.state.user;
this.setState({
  user:{...user,age:18}
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>ImmutableJS更新数组</p> <h4 id="连续调用setstate只有一次生效"><a href="#连续调用setstate只有一次生效" class="header-anchor">#</a> 连续调用setstate只有一次生效</h4> <p>实例1</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>componentDidMount() {
    this.setState({ index: this.state.index + 1 }, () =&gt; {
      console.log(this.state.index);
    })
    this.setState({ index: this.state.index + 1 }, () =&gt; {
      console.log(this.state.index);
    })
}
//输出
1
1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>实例2</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>componentDidMount() {
    this.setState((preState) =&gt; ({ index: preState.index + 1 }), () =&gt; {
      console.log(this.state.index);
    })
    this.setState(preState =&gt; ({ index: preState.index + 1 }), () =&gt; {
      console.log(this.state.index);
    })
}
//输出
2
2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>原因：</p> <ul><li>1.直接传递对象的<code>setstate</code>会被合并成一次</li> <li>使用函数传递<code>state</code>不会被合并</li></ul> <h4 id="setstate自动触发两次"><a href="#setstate自动触发两次" class="header-anchor">#</a> setstate自动触发两次</h4> <p>严格模式下，</p> <h4 id="定时器中的setstate"><a href="#定时器中的setstate" class="header-anchor">#</a> 定时器中的setstate</h4> <p>定时器中的 setState，每次都会引起新的 render，即使是同一个定时器中的多次 setState</p> <p>因为定时器中的<code>setState</code>没走<code>react</code>的事物机制，执行时批量更新没被设置<code>true</code>，所以每次都直接 render 了。</p> <p>在事件执行的时候，<strong>当前上下文</strong>执行的是<code>setTimeout</code>函数，但当执行<code>setTimeout</code>函数的回调时，原来的上下文已经结束了，<strong>回调的上下文变成了 window</strong>，所以依据的批量更新属性<code>isBatchingUpdates</code>没有被设置成<code>true</code>的过程，因此始终是<code>false</code>，因此<code>setState</code>就同步执行了。</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        me<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            count<span class="token operator">:</span> me<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        me<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            count<span class="token operator">:</span> me<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

   <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        me<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            count<span class="token operator">:</span> me<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        me<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            count<span class="token operator">:</span> me<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">onClickTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        me<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            count<span class="token operator">:</span> me<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        me<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            count<span class="token operator">:</span> me<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>其实在回调函数中，setState 是不会触发批量更新机制的，无论是 promise，ajax，setTimeout 回调等等，同时设置多次 setState，每个 setState 都会单独执行并 render，因为上下文发生了变化。</p> <h4 id="原生事件中的setstate"><a href="#原生事件中的setstate" class="header-anchor">#</a> 原生事件中的setstate</h4> <p>在按钮原生事件中定义的<code>setState</code>,和定时器效果一样，每次<code>setState</code>都会引起新的<code>render</code></p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>componentDidMount() {
       this.button.addEventListener('click', this.onClick.bind(this, '原生事件'), false);
}

onClick(info) {
       console.log(info);
       this.setState({
           count: ++count
       });
       this.setState({
           count: ++count
       });
   }

   render() {
       console.log(this.state.count);
       return &lt;div&gt;
           &lt;input type=&quot;button&quot; ref={input =&gt; this.button = input} onClick={this.onClick.bind(this, 'React事件')} value=&quot;生成计时器&quot; /&gt;
           &lt;div&gt;Count:{this.state.count}&lt;/div&gt;
       &lt;/div&gt;
   }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="生命周期函数调用setstate"><a href="#生命周期函数调用setstate" class="header-anchor">#</a> 生命周期函数调用setstate</h4> <p>在componentDidMount()中，你 可以立即调用setState()。它将会触发一次额外的渲染，但是它将在浏览器刷新屏幕之前发生。这保证了在此情况下即使render()将会调用两次，用户也不会看到中间状态。谨慎使用这一模式，因为它常导致性能问题。在大多数情况下，你可以 在constructor()中使用赋值初始状态来代替。然而，有些情况下必须这样，比如像模态框和工具提示框。这时，你需要先测量这些DOM节点，才能渲染依赖尺寸或者位置的某些东西。</p> <p>componentWillUpdate和componentDidUpdate这两个生命周期中不能调用<code>setState</code>。</p> <p>在这两个生命周期里面调用<code>setState</code>会造成死循环，导致程序崩溃。</p> <p>在调用<code>setState</code>时使用函数传递<code>state</code>值，在回调函数中获取最新更新后的<code>state</code>。</p> <h3 id="react-diff算法的机制"><a href="#react-diff算法的机制" class="header-anchor">#</a> react diff算法的机制</h3> <p>diff算法的瓶颈</p> <p>由于diff操作本身也会带来性能损耗，react文档中提到，即使在最前沿的算法中，将前后两棵树完全对比的算法的复杂程度为O(n3)，其中n是树中元素的数量</p> <p>如果在react中使用了该算法，那么展示1000个元素所需要执行的计算量将在10亿范围的量级，这个开销实在太高。</p> <p>为了降低算法的复杂度，react的diff预设了3个限制：</p> <p>1.同级元素进行diff。如果一个DOM节点在前后两次更新中跨越了层级，那么React不会尝试复用</p> <p>2.不同类型的元素会产生出不同的树，如果元素由div变为p，react会销毁div及其子孙节点，并新建p及其子孙节点</p> <p>3.开发者可以通过prop key暗示哪些子元素在不同的渲染下能保持稳定</p> <p>举个例子</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>//更新前
&lt;div&gt;
   &lt;p key=&quot;ka&quot;&gt;ka&lt;/p&gt;
   &lt;h3 key=&quot;song&quot;&gt;song&lt;/h3&gt;
&lt;/div&gt;
//更新后
&lt;div&gt;
   &lt;h3 key=&quot;song&quot;&gt;song&lt;/h3&gt;
   &lt;p key=&quot;ka&quot;&gt;ka&lt;/p&gt;
&lt;/div&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>如果没有key，react会认为div的第一个子节点由p变为h3，第二个子节点由h3变为p，这符合限制2的设定，因此会销毁并重建</p> <p>当用key指明了节点的前后对应关系后，react知道key=&quot;ka&quot;的p在更新之后还存在，因此节点可以复用，只需要交换一下顺序即可</p> <h3 id="react渲染机制-work-loop"><a href="#react渲染机制-work-loop" class="header-anchor">#</a> React渲染机制(work loop)</h3> <p>React 16 之前的组件渲染方式是递归渲染：渲染父节点 -&gt; 渲染子节点</p> <p>递归渲染看起来十分简单，但是如果想在子节点的渲染过程中执行优先级更高的操作，只能保留调用栈中子节点的渲染及子节点之前节点的渲染，这样是很复杂的，这种调和/渲染也叫做 Stack Reconciler。</p> <p>Fiber 使用链表的结构去渲染节点，每一个节点都称之为 Fiber Node，每个节点会有三个属性：</p> <ul><li>child 指向第一个子节点</li> <li>sibling 指向兄弟节点</li> <li>return 指向父节点</li></ul> <p>Fiber 的渲染方式：从父节点开始，向下依次遍历子节点，深度优先渲染完子节点后，再回到其父节点去检查是否有兄弟节点，如果有兄弟节点，则从该兄弟节点开始继续深度优先的渲染，直到回退到根节点结束。</p> <p>综上，可以分为 Scheduler、Reconciliation、Commit 这三个阶段</p> <p>Scheduer 流程主要是创建更新，创建更新的方式：</p> <ul><li>ReactDOM.render</li> <li>setState</li></ul> <p>可以发现 React 将首次渲染和更新渲染统一了起来。</p> <h3 id="effect-hook机制"><a href="#effect-hook机制" class="header-anchor">#</a> Effect Hook机制</h3> <p>effect hook与其他hook的行为有一些区别</p> <p>effect hook的属性：</p> <p>​		在渲染时被创建，在浏览器执行绘制后运行；</p> <p>​		如果给出销毁指令，会在下一次绘制前被销毁；</p> <p>​		会按照定义的顺序被运行</p> <p>hook effect 将会被保存在 fiber 一个称为 <code>updateQueue</code> 的属性上，每个 effect 节点都有如下的结构.</p> <ul><li><code>tag</code> —— 一个二进制数字，它控制了 effect 节点的行为（后文我将详细说明）。</li> <li><code>create</code> —— 绘制<strong>之后</strong>运行的回调函数。</li> <li><code>destroy</code> —— 它是 <code>create()</code> 返回的回调函数，将会在初始渲染<strong>前</strong>运行。</li> <li><code>inputs</code> —— 一个集合，该集合中的值将会决定一个 effect 节点是否应该被销毁或者重新创建。</li> <li><code>next</code> —— 它指向下一个定义在函数组件中的 effect 节点。</li></ul> <p>除了 <code>tag</code> 属性，其他的属性都很简明易懂。如果你对 hook 很了解，你应该知道，React 提供了一些特殊的 effect hook：比如 <code>useMutationEffect()</code> 和 <code>useLayoutEffect()</code>。这两个 effect hook 内部都使用了 <code>useEffect()</code>，实际上这就意味着它们创建了 effect hook，但是却使用了不同的 tag 属性值。</p> <p>Default effect —— <code>UnmountPassive | MountPassive</code>.</p> <p>Mutation effect —— <code>UnmountSnapshot | MountMutation</code>.</p> <p>Layout effect —— <code>UnmountMutation | MountLayout</code>.</p> <h3 id="state、reducer-hook机制"><a href="#state、reducer-hook机制" class="header-anchor">#</a> State、Reducer Hook机制</h3> <p><code>useReducer</code> 和 <code>useState</code> 本质上是一个原理，虽然我们平时会使用 <code>useState</code> 更多，但事实上 <code>useState</code> 是 <code>useReducer</code> 的封装；</p> <h3 id="hook系统原理"><a href="#hook系统原理" class="header-anchor">#</a> Hook系统原理</h3> <p>Dispatcher</p> <p>dispatcher 是一个包含了 hook 函数的共享对象。基于 ReactDOM 的渲染状态，它将会被动态的分配或者清理，并且它能够确保用户不可在 React 组件之外获取 hook</p> <p>在切换到正确的 Dispatcher 以渲染根组件之前，我们通过一个名为 <code>enableHooks</code> 的标志来启用/禁用 hook。在技术上来说，这就意味着我们可以在运行时开启或关闭 hook。React 16.6.X 版本中也有对此的实验性实现，但它实际上处于禁用状态</p> <p>当我们完成渲染工作后，我们将 dispatcher 置空并禁止用户在 ReactDOM 的渲染周期之外使用 hook。这个机制能够保证用户不会做什么蠢事</p> <p>dispatcher 在每次 hook 的调用中都会被函数 <code>resolveDispatcher()</code> 解析。正如我之前所说，在 React 的渲染周期之外，这些都无意义了，React 将会打印出警告信息：<strong>“hook 只能在函数组件内部调用”</strong></p> <p>Hook队列</p> <p>在 React 后台，hook 被表示为以调用顺序连接起来的节点。这样做原因是 hook 并不能简单的被创建然后丢弃。它们有一套特有的机制，也正是这些机制让它们成为 hook。一个 hook 会有数个属性，在继续学习之前，我希望你能牢记于心：</p> <ul><li>它的初始状态会在初次渲染的时候被创建。</li> <li>它的状态可以在运行时更新。</li> <li>React 可以在后续渲染中记住 hook 的状态。</li> <li>React 能根据调用顺序提供给你正确的状态。</li> <li>React 知道当前 hook 属于哪个 fiber。</li></ul> <p>hook 还有一些附加的属性，但是弄明白 hook 是如何运行的关键在于它的 <code>memoizedState</code> 和 <code>next</code> 属性。其他的属性会被 <code>useReducer()</code> hook 使用，可以缓存发送过的 action 和一些基本的状态，这样在某些情况下，reduction 过程还可以作为后备被重复一次：</p> <ul><li><code>baseState</code> —— 传递给 reducer 的状态对象。</li> <li><code>baseUpdate</code> —— 最近一次创建 <code>baseState</code> 的已发送的 action。</li> <li><code>queue</code> —— 已发送 action 组成的队列，等待传入 reducer。</li></ul> <h3 id="redux-reducer"><a href="#redux-reducer" class="header-anchor">#</a> redux-reducer</h3> <p>reducer为什么要是纯函数？纯函数是什么？</p> <p>纯函数：对于相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用，也不依赖外部环境的状态。</p> <p>原因：Redux只通过比较新旧两个对象的存储位置来比较新旧两个对象是否相同（<strong>浅比较</strong>）。如果你在reducer内部直接修改旧的state对象的属性值，那么新的state和旧的state将都指向同一个对象。因此Redux认为没有任何改变，返回的state将为旧的state。两个state相同的话，页面就不会重新渲染了。</p> <h3 id="redux中间件机制"><a href="#redux中间件机制" class="header-anchor">#</a> redux中间件机制</h3> <p><code>redux</code>源码只有<strong>同步</strong>操作，也就是当<code>dispatch action</code> 时，<code>state</code>会被立即更新。若需要引入异步数据流，<a href="https://cn.redux.js.org/docs/advanced/AsyncFlow.html" target="_blank" rel="noopener noreferrer">Redux官方<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>则建议使用中间件来增强<code>createStore</code>的能力，它对外暴露了<code>applyMiddleware</code>函数，接受任意个中间件作为入参，返回作为<code>createStore</code>的入参的值</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>// 引入 redux
import { createStore } from 'redux'
// 创建 store
const store = createStore(
    reducer,
    initial_state,
    //引入中间件
    applyMiddleware(middleware1, middleware2, ...)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>以 <code>middlewareAPI</code> 作为中间件的入参，逐个调用传入的中间件，获取一个由“内层函数”组成的数组 <code>chain</code></p> <p>调用 <code>compose</code> 函数，将 <code>chain</code> 中的 “内层函数” 逐个组合起来，并调用最终组合出来的函数，传入 <code>dispatch</code> 作为入参</p> <p>返回一个新的 <code>store</code> 对象，这个 <code>store</code> 对象的 <code>dispatch</code> 已经被改写过了</p> <p><code>reduce</code> 会将数组中的每个元素执行指定的逻辑，并将结果汇总为单个返回值，假设有这样一个 <code>compose</code> 调用</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">compose</span><span class="token punctuation">(</span>f1<span class="token punctuation">,</span>f2<span class="token punctuation">,</span>f3<span class="token punctuation">,</span>f4<span class="token punctuation">)</span>
<span class="token comment">//会被解析为</span>
<span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span><span class="token function">f3</span><span class="token punctuation">(</span><span class="token function">f4</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>即<code>f1,f2,f3,f4</code>这4个中间件的内层逻辑会被组合到一个函数中去，当这个函数被调用时，中间件会依次被调用</p> <p>中间件的执行机制</p> <p>我们知道 <strong>任何的中间件都可以用自己的方式解析<code>dispatch</code>的内容，并继续传递<code>actions</code> 给下一个中间件</strong>。但注意：当最后一个中间件开始 <code>dispatch action</code> 时，<code>action</code> 必须是一个普通对象，因为这是同步式的 <code>Redux</code> 数据流 开始的地方。</p> <p><code>redux-thunk</code>源码层面可知道，它主要做的一件事就是 拦截到<code>action</code>后，检查它是否是一个函数</p> <ul><li>若是函数，则执行它并返回执行的结果</li> <li>若不是函数，则直接调用<code>next</code>，工作流继续往下走</li></ul> <p>中间件的工作模式：</p> <ul><li>中间件的执行时机：在<code>action</code>被分发之后、<code>reducer</code>触发之前</li> <li>中间件的执行前提：<code>applyMiddleware</code>函数对<code>dispatch</code>函数进行改写，使得<code>dispatch</code>触发<code>reducer</code>之前，执行<code>Redux</code>中间件的链式调用。</li></ul> <h3 id="redux-compose实现"><a href="#redux-compose实现" class="header-anchor">#</a> Redux compose实现</h3> <p>compose就是执行一系列的任务（函数），比如有以下任务队列</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> tasks <span class="token operator">=</span> <span class="token punctuation">[</span>step1<span class="token punctuation">,</span> step2<span class="token punctuation">,</span> step3<span class="token punctuation">,</span> step4<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>每一个step都是一个步骤，按照步骤一步一步的执行到结尾，这就是一个<strong>compose</strong></p> <p>compose在函数式编程中是一个很重要的工具函数，在这里实现的compose有三点说明</p> <ul><li>第一个函数是多元的（接受多个参数），后面的函数都是单元的（接受一个参数）</li> <li>执行顺序的自右向左的</li> <li>所有函数的执行都是同步的</li></ul> <p>用代码解释</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>componse<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">function</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">add2</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">+</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>add1<span class="token punctuation">,</span>add2<span class="token punctuation">,</span>add3<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span><span class="token string">'y'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token comment">//输出结果 '12xy'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="利用context-api实现redux"><a href="#利用context-api实现redux" class="header-anchor">#</a> 利用context api实现redux</h3> <p>https://segmentfault.com/a/1190000023142285</p> <h3 id="react-router原理"><a href="#react-router原理" class="header-anchor">#</a> React-router原理</h3> <p><code>React-Router</code>中的3个核心角色：</p> <p>导航：负责触发路径的改变，比如 <code>Link</code>、<code>NavLink</code> 和 <code>Redirect</code>（以<code>Link</code>为代表）</p> <p>路由：负责定义路径与组件之间的映射关系，比如<code>Route</code>和<code>Switch</code>（以<code>Route</code>为代表）</p> <p>路由器：为新的路径匹配它对应的逻辑，比如<code>BrowserRouter</code>和<code>HashRouter</code>，根据<code>Route</code>定义出来的映射关系</p> <p>负责感知路由的变化并作出反应的路由器，是整个路由系统中最为重要的一环。在<code>React-Router</code>中支持两种路由规则：<code>HashRouter</code>和<code>BrowserRouter</code>分别对应了<code>hash</code>和<code>history</code>两种背后模式，</p> <p>在react-router源码中，HashRouter 调用 <code>createHashHistory</code>，History调用<code>createBrowserHistory</code></p> <p><code>createHashHistory</code>通过使用hash tag(#) 来处理形如<code>https://www.huamu.com/#index</code>的 URL，即通过 URL 的 hash 属性来控制路由跳转</p> <p><code>createBrowserHistory</code> 它将在浏览器中使用 HTML 5 的 history API 来处理形如 <code>https://www.huamu.com/index</code>的 URL，即通过 HTML 5的 history API 来控制路由跳转</p> <h3 id="手写自定义hook-实现切换状态"><a href="#手写自定义hook-实现切换状态" class="header-anchor">#</a> 手写自定义hook，实现切换状态</h3> <div class="language-react line-numbers-mode"><pre class="language-text"><code>function SomeComponent() {
  const [state, toggleState] = useToggle(false);
  return &lt;div&gt;
    {state ? 'true' : 'false'}
    &lt;button onClick={toggleState}&gt;&lt;/button&gt;
  &lt;/div&gt;
}

// 请实现 useToggle
function useToggle(initialValue) {
    const [value, setValue] = useState(initialValue);
    const toggle = () =&gt; {setValue(!value)};
    return [value, toggle];
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="react优化"><a href="#react优化" class="header-anchor">#</a> React优化</h2> <p>https://juejin.cn/post/6935584878071119885</p> <h3 id="懒渲染react-visibility-observer"><a href="#懒渲染react-visibility-observer" class="header-anchor">#</a> 懒渲染react-visibility-observer</h3> <p>当组件进入可视区域才渲染组件，如modal/drawer这种需要用户操作才会出现的组件。</p> <p>使用react-visibility-observer监听</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>import VisibilityObserver,{useVisibilityObserver,} from &quot;react-visibility-observer&quot;

const VisibilityObserverChildren = ({callback,children}) =&gt;{
  const {isVisible} = useVisibilityObserver()
  useEffect(()=&gt;{
    callback(isVisible)
  },[callback,isVisible])
  
  return &lt;&gt;{children}&lt;/&gt;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="react库"><a href="#react库" class="header-anchor">#</a> react库</h2> <h3 id="react-helmet"><a href="#react-helmet" class="header-anchor">#</a> react-helmet</h3> <p>React Helmet是一个HTML文档head管理工具，管理对文档头的所有修改。React Helmet采用纯HTML标记并输出纯HTML标记，非常简单，对react初学者友好</p> <p>特点：</p> <p>支持所有有效的head标签，title、base、meta、link、script、noscript和style</p> <p>支持body、html和title的属性</p> <p>支持服务端渲染</p> <p>嵌套组件覆盖重复的head标签修改</p> <p>同一组件中定义时将保留重复的head标签修改(比如“apple-touch-icon”)</p> <p>支持跟踪DOM更改的回调</p> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> i react-helmet
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>import {Helmet} from &quot;react-helmet&quot;

class Application extends React.Component {
  render(){
   return(
      &lt;div className=&quot;application&quot;&gt;
        &lt;Helmet&gt;
          &lt;meta charSet=&quot;utf-8&quot;/&gt;
          &lt;title&gt;My title&lt;/title&gt;
          &lt;link rel=&quot;canonical&quot; href=&quot;http://mysite.com/example&quot; /&gt;
        &lt;/Helmet&gt;
        &lt;Child&gt;
       			&lt;Helmet&gt;
                &lt;title&gt;new Title&lt;/title&gt;
            &lt;/Helmet&gt;
       &lt;/Child&gt;
      &lt;/div&gt;
   )
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>上面代码中，后面的helmet会覆盖前面的helmet</p> <p>服务端渲染时，需要在ReactDOMServer.renderToString或ReadDOMServer.renderToStaticMarkup后调用Helmet.renderStatic()来获得你预渲染的head数据</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>ReactDOMServer.renderToString(&lt;Handler /&gt;);
const helmet = Helmet.renderStatic();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="使用antd"><a href="#使用antd" class="header-anchor">#</a> 使用antd</h3> <p>Ant-Design是蚂蚁金服开发的面向React和Vue的类似于bootstrap的框架，官网链接为：https://ant.design/index-cn</p> <p>安装包</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>npm install antd --save
cnpm i antd -S
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在App.css文件中导入样式</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>@import '~antd/dist/antd.css';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>按需导入包</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>import {  } from 'antd';

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>组件</p> <h3 id="graphql"><a href="#graphql" class="header-anchor">#</a> GraphQL</h3> <p>Apollo是基于GraphQL的全栈解决方案集合，包括了apollo-client和apollo-server，从后端到前端提供了对应的lib使得开发GraphQL更加方便</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>apollo<span class="token operator">-</span>boost 包含启动阿波罗客户端的所有依赖
react<span class="token operator">-</span>apollo 视图层面的集合
graph<span class="token operator">-</span>tag 解析查询语句
graphql 也是解析查询语句
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-react line-numbers-mode"><pre class="language-text"><code>import ApolloClient from 'apollo-boost' 

const client = new ApolloClient({
    uri: 'http://localhost:5000/graphql'
})

import { ApolloProvider,Query } from 'react-apollo'
import { Mutation,MutationFunc } from 'react-apollo'

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-react line-numbers-mode"><pre class="language-text"><code>npm install @apollo/client graphql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用hooks</p> <h3 id="eventbus"><a href="#eventbus" class="header-anchor">#</a> eventbus</h3> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> events
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//event.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>EventEmitter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'events'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//发布</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">'./event'</span>

<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span><span class="token string">'来自father的info'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Father
<span class="token comment">//订阅</span>
<span class="token comment">//emitter.addListener()事件监听订阅</span>
<span class="token comment">//emitter.removeListener()进行事件销毁，取消订阅</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">'./event'</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="react-beautiful-dnd"><a href="#react-beautiful-dnd" class="header-anchor">#</a> react-beautiful-dnd</h3> <h3 id="react-dnd"><a href="#react-dnd" class="header-anchor">#</a> react-dnd</h3> <p>Https://juejin.cn/post/6933036276660731912</p> <h3 id="react-intl-universal"><a href="#react-intl-universal" class="header-anchor">#</a> react-intl-universal</h3> <p>React-intl-universal实现</p> <h3 id="react-hot-loader"><a href="#react-hot-loader" class="header-anchor">#</a> react-hot-loader</h3> <p>React-Hot-Loader 使用了 Webpack HMR API，针对 React 框架实现了对单个 component 的热替换，并且能够保持组件的 state。
React-Hot-Loader 在编译时会在每一个 React component 外封装一层，每一个这样的封装都会注册自己的 module.hot.accept 回调，它们会监听每一个 component 的更新，在当前 component 代码更新时只替换自己的模块，而不是整个替换 root component。
同时，React-Hot-Loader 对 component 的封装还会代理 component 的 state，所以当 component 替换之后依然能够保持之前的 state。</p> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev react-hot-loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>hot-loader 是基于 webpack-dev-server，所以还得安装 webpack-dev-server</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev webpack-dev-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>首先还是要让 webpack-dev-server 打开。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> WebpackDevServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">WebpackDevServer</span><span class="token punctuation">(</span><span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  publicPath<span class="token operator">:</span> config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>publicPath<span class="token punctuation">,</span>
  hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  historyApiFallback<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Listening at http://localhost:3000/'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>然后在 webpack 的配置文件里添加 react-hot-loader。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 修改 entry</span>
  entry<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 写在入口文件之前</span>
    <span class="token string">&quot;webpack-dev-server/client?http://0.0.0.0:3000&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack/hot/only-dev-server&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 这里是你的入口文件</span>
    <span class="token string">&quot;./src/app.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;build/js/bundle.js&quot;</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">&quot;/build&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    loaders<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 在这里添加 react-hot，注意这里使用的是loaders，所以不能用 query，应该把presets参数写在 babel 的后面</span>
        loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'react-hot'</span><span class="token punctuation">,</span> <span class="token string">'babel?presets[]=react,presets[]=es2015'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 添加插件</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="uuid"><a href="#uuid" class="header-anchor">#</a> uuid</h3> <p>uuid是通用唯一识别码(Universally Unique Identifier)的缩写。是一种软件建构辨准，亦为开发软件基金会组织在分布式计算环境领域的一部分。其目的是让分布式系统中的所有元素具有唯一的辨识信息，而不需要通过中央控制端来做辨识信息的指定。</p> <p>UUID由一组32位数的16进制数字构成。对于UUID，就算每纳秒产生一百万个UUID，要花100亿年才会将所有UUID用完。</p> <p>格式</p> <p>uuid32个16进制数字用连字号分成五组来显示，所以共有36个字符</p> <p>UUID版本通过M表示，当前规范有5个版本，可选值为1、2、3、4、5，这5个版本使用不同的算法，利用不同的信息产生UUID，各版本有各版本的优势，具体来说：</p> <p>uuid.v1()：创建版本1(时间戳)UUID</p> <p>uuid.v3()：创建版本3(md5命名空间)UUID</p> <p>uuid.v4()：创建版本4(随机)UUID</p> <p>uuid.v5()：创建版本5(带SHA-1的命名空间)IIOD</p> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> uuid 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token keyword">as</span> uuidv4<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'uuid'</span>

<span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以使用uuid进行验证登陆,未登陆状态下生产uuid</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> uuid <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'uuid'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>uuid<span class="token punctuation">)</span><span class="token punctuation">{</span>
  sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'uuid'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  sessionStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'uuid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> uuid <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'uuid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>uuid<span class="token punctuation">)</span><span class="token punctuation">{</span>
    sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'uuid'</span><span class="token punctuation">,</span><span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="js-cookie"><a href="#js-cookie" class="header-anchor">#</a> js-cookie</h3> <p>cookie插件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> js-cookie --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>引用</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>

<span class="token comment">//设置cookie</span>
Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'value'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>expire<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">,</span>path<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//7天过期</span>
Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>foo<span class="token operator">:</span><span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置一个json</span>
<span class="token comment">//获取cookie</span>
Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取cookie</span>
Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取所有cookie</span>

<span class="token comment">//删除cookie</span>
Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//删除cookie</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="react-color"><a href="#react-color" class="header-anchor">#</a> react-color</h3> <p>react-color是一个拾色器，通过它获取颜色值</p> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> i react-color -S
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>import { TwitterPicker } from 'react-dom'

function () {
  render() {
    &lt;TwitterPicker 
      width=&quot;240px&quot;
      
      /&gt;
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="react-lazyload"><a href="#react-lazyload" class="header-anchor">#</a> react-lazyload</h3> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> --save react-lazyload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>懒加载图片</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>import React from 'react';
import ReactDOM from 'react-dom';
import LazyLoad from 'react-lazyload';
import MyComponent from './MyComponent';

const App = () =&gt; {
  return (
    &lt;div className=&quot;list&quot;&gt;
      &lt;LazyLoad height={200}&gt;
        &lt;img src=&quot;tiger.jpg&quot; /&gt; /*
                                  Lazy loading images is supported out of box,
                                  no extra config needed, set `height` for better
                                  experience
                                 */
      &lt;/LazyLoad&gt;
      &lt;LazyLoad height={200} once &gt;
                                /* Once this component is loaded, LazyLoad will
                                 not care about it anymore, set this to `true`
                                 if you're concerned about improving performance */
        &lt;MyComponent /&gt;
      &lt;/LazyLoad&gt;
      &lt;LazyLoad height={200} offset={100}&gt;
                              /* This component will be loaded when it's top
                                 edge is 100px from viewport. It's useful to
                                 make user ignorant about lazy load effect. */
        &lt;MyComponent /&gt;
      &lt;/LazyLoad&gt;
      &lt;LazyLoad&gt;
        &lt;MyComponent /&gt;
      &lt;/LazyLoad&gt;
    &lt;/div&gt;
  );
};

ReactDOM.render(&lt;App /&gt;, document.body);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>默认懒加载组件</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>import { lazyload } from 'react-lazyload';

@lazyload({
  height: 200,
  once: true,
  offset: 100
})
class MyComponent extends React.Component {
  render() {
    return &lt;div&gt;this component is lazyloaded by default!&lt;/div&gt;;
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tech/react/react2.html" class="prev">
        React（二）
      </a></span> <span class="next"><a href="/tech/react/react4.html">
        React（四）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.528f3631.js" defer></script><script src="/assets/js/2.619c82a8.js" defer></script><script src="/assets/js/21.cbe0d8e0.js" defer></script>
  </body>
</html>
