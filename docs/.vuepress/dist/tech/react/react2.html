<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reactï¼ˆäºŒï¼‰ | Kun&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="metaçš„æè¿°å†…å®¹">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.528f3631.js" as="script"><link rel="preload" href="/assets/js/2.619c82a8.js" as="script"><link rel="preload" href="/assets/js/20.5ccce5c5.js" as="script"><link rel="prefetch" href="/assets/js/10.ac7a4de3.js"><link rel="prefetch" href="/assets/js/11.22193742.js"><link rel="prefetch" href="/assets/js/12.6b0d96a8.js"><link rel="prefetch" href="/assets/js/13.bb592c98.js"><link rel="prefetch" href="/assets/js/14.5aadcb22.js"><link rel="prefetch" href="/assets/js/15.78a91f28.js"><link rel="prefetch" href="/assets/js/16.0463299b.js"><link rel="prefetch" href="/assets/js/17.5ade6be6.js"><link rel="prefetch" href="/assets/js/18.ae21993d.js"><link rel="prefetch" href="/assets/js/19.381fa6fe.js"><link rel="prefetch" href="/assets/js/21.cbe0d8e0.js"><link rel="prefetch" href="/assets/js/22.dec488e3.js"><link rel="prefetch" href="/assets/js/23.bd6e325e.js"><link rel="prefetch" href="/assets/js/24.7f63c0c1.js"><link rel="prefetch" href="/assets/js/25.e9d2ca3d.js"><link rel="prefetch" href="/assets/js/26.2ca2fcb2.js"><link rel="prefetch" href="/assets/js/27.9bbd6fb4.js"><link rel="prefetch" href="/assets/js/28.d07f52f0.js"><link rel="prefetch" href="/assets/js/29.69fc0484.js"><link rel="prefetch" href="/assets/js/3.983c5940.js"><link rel="prefetch" href="/assets/js/30.95ebca2d.js"><link rel="prefetch" href="/assets/js/31.0119a78d.js"><link rel="prefetch" href="/assets/js/32.1be9fafc.js"><link rel="prefetch" href="/assets/js/33.463bffa3.js"><link rel="prefetch" href="/assets/js/34.e343d136.js"><link rel="prefetch" href="/assets/js/35.7484c5cf.js"><link rel="prefetch" href="/assets/js/36.5aff1e2a.js"><link rel="prefetch" href="/assets/js/37.d06aba3d.js"><link rel="prefetch" href="/assets/js/38.bf208dc8.js"><link rel="prefetch" href="/assets/js/39.30052380.js"><link rel="prefetch" href="/assets/js/4.2fb93bc2.js"><link rel="prefetch" href="/assets/js/40.08ee34f0.js"><link rel="prefetch" href="/assets/js/41.dcd825b5.js"><link rel="prefetch" href="/assets/js/42.487f0aa8.js"><link rel="prefetch" href="/assets/js/43.67a7ad8b.js"><link rel="prefetch" href="/assets/js/44.357ba709.js"><link rel="prefetch" href="/assets/js/45.a590454b.js"><link rel="prefetch" href="/assets/js/46.e7870e58.js"><link rel="prefetch" href="/assets/js/47.abdb75cf.js"><link rel="prefetch" href="/assets/js/48.0a5ab934.js"><link rel="prefetch" href="/assets/js/49.663acd27.js"><link rel="prefetch" href="/assets/js/5.1474cf9c.js"><link rel="prefetch" href="/assets/js/50.96ef16fe.js"><link rel="prefetch" href="/assets/js/51.e0b76e5e.js"><link rel="prefetch" href="/assets/js/52.a909ae03.js"><link rel="prefetch" href="/assets/js/53.b3e7bb38.js"><link rel="prefetch" href="/assets/js/54.d2a5e7cf.js"><link rel="prefetch" href="/assets/js/55.41bdb3fe.js"><link rel="prefetch" href="/assets/js/56.58b21e41.js"><link rel="prefetch" href="/assets/js/57.c3d18e9a.js"><link rel="prefetch" href="/assets/js/58.dc3e0326.js"><link rel="prefetch" href="/assets/js/59.e2e30a9a.js"><link rel="prefetch" href="/assets/js/6.2958d7f8.js"><link rel="prefetch" href="/assets/js/60.8f5cef73.js"><link rel="prefetch" href="/assets/js/61.cf6b261c.js"><link rel="prefetch" href="/assets/js/62.54bae72d.js"><link rel="prefetch" href="/assets/js/63.8ef19855.js"><link rel="prefetch" href="/assets/js/64.4b33c41d.js"><link rel="prefetch" href="/assets/js/65.24a33653.js"><link rel="prefetch" href="/assets/js/7.4f3f4813.js"><link rel="prefetch" href="/assets/js/8.af6b4dfd.js"><link rel="prefetch" href="/assets/js/9.0ac2d280.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kun's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">
  å…³äº
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  æŠ€æœ¯
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  ç§‘ç ”
</a></div><div class="nav-item"><a href="/shoot/" class="nav-link">
  æ‘„å½±
</a></div><div class="nav-item"><a href="https://www.github.com/kun8018" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">
  å…³äº
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  æŠ€æœ¯
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  ç§‘ç ”
</a></div><div class="nav-item"><a href="/shoot/" class="nav-link">
  æ‘„å½±
</a></div><div class="nav-item"><a href="https://www.github.com/kun8018" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Tech</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/" aria-current="page" class="sidebar-link">Blogging Like a Hacker</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/react/react.html" class="sidebar-link">React</a></li><li><a href="/tech/react/react2.html" aria-current="page" class="active sidebar-link">Reactï¼ˆäºŒï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/react/react2.html#react-memo-å’Œpurecomponent" class="sidebar-link">React.memo å’Œpurecomponent</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#hook" class="sidebar-link">Hook</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/react/react2.html#hookå‡ºç°çš„åŸå› ä»¥åŠè§£å†³çš„é—®é¢˜" class="sidebar-link">hookå‡ºç°çš„åŸå› ä»¥åŠè§£å†³çš„é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#usestate" class="sidebar-link">useState</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#useeffectå’Œuselayouteffect" class="sidebar-link">useEffectå’ŒuseLayoutEffect</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#usereducer" class="sidebar-link">useReducer</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#usecontext" class="sidebar-link">useContext</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#usecallbackä¸usememo" class="sidebar-link">usecallbackä¸useMemo</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#useref" class="sidebar-link">useRef</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#è‡ªå®šä¹‰hookæ··ç”¨" class="sidebar-link">è‡ªå®šä¹‰hookæ··ç”¨</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#hookçš„ä½¿ç”¨è§„åˆ™" class="sidebar-link">hookçš„ä½¿ç”¨è§„åˆ™</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#hookçš„é—­åŒ…é™·é˜±-è¿‡æœŸé—­åŒ…" class="sidebar-link">Hookçš„é—­åŒ…é™·é˜±(è¿‡æœŸé—­åŒ…)</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#ä½¿ç”¨react-hookså¦‚ä½•è®©ä¸‹é¢çš„å­ç»„ä»¶åªrenderä¸€æ¬¡" class="sidebar-link">ä½¿ç”¨react hookså¦‚ä½•è®©ä¸‹é¢çš„å­ç»„ä»¶åªrenderä¸€æ¬¡</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#fiberæ¶æ„" class="sidebar-link">Fiberæ¶æ„</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/react/react2.html#fiberæ¶æ„ä¸­çš„åŸºæœ¬æ¦‚å¿µ" class="sidebar-link">fiberæ¶æ„ä¸­çš„åŸºæœ¬æ¦‚å¿µ</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#renderé˜¶æ®µ" class="sidebar-link">Renderé˜¶æ®µ</a></li><li class="sidebar-sub-header"><a href="/tech/react/react2.html#commité˜¶æ®µ" class="sidebar-link">Commité˜¶æ®µ</a></li></ul></li></ul></li><li><a href="/tech/react/react3.html" class="sidebar-link">Reactï¼ˆä¸‰ï¼‰</a></li><li><a href="/tech/react/react4.html" class="sidebar-link">Reactï¼ˆå››ï¼‰</a></li><li><a href="/tech/react/reactnative.html" class="sidebar-link">React Nativeå…¥é—¨</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>å‘¨è¾¹å¼€å‘æŠ€æœ¯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>æ•°æ®åº“ç›¸å…³</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>æœåŠ¡å™¨æŠ€æœ¯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>æ¡Œé¢ç«¯å¼€å‘</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ç§»åŠ¨ç«¯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ç®—æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>é™æ€è¯­è¨€</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ä¸šä½™ç ”ç©¶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å…³äº</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç§‘å­¦ç ”ç©¶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>â€‹      å‰ç«¯æ¡†æ¶ï¼Œå¿«é€Ÿå¼€å‘é¡µé¢ï¼Œå‡½æ•°å¼ç¼–ç¨‹ï¼Œä¸åç«¯apiå¿«é€Ÿæ­å»º</p> <h2 id="react-memo-å’Œpurecomponent"><a href="#react-memo-å’Œpurecomponent" class="header-anchor">#</a> React.memo å’Œpurecomponent</h2> <p>reacr.memoæ§åˆ¶å‡½æ•°ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œreacr.purecomponentæ§åˆ¶ç±»ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</p> <p>ä½¿ç”¨æ—¶å°†å‡½æ•°ç»„ä»¶ä¼ é€’ç»™react.memoå‡½æ•°å°±å¯ä»¥</p> <p>å®ä¾‹</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const Funcomponent = () =&gt;{
  return (
     &lt;div&gt;
     hiya!i am a functional component!
     &lt;/div&gt;
  )
}
const MemoFuncComponent = React.memo(Funcomponent)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>React.memoè¿”å›è‹±å›½çº¯ç»„ä»¶MemoFuncComponentï¼Œjsxä¸­å°†æ ‡è®°æ¬¡ç»„ä»¶ï¼Œæ¯å½“ç»„ä»¶çš„propså’Œstateå‘ç”Ÿå˜åŒ–æ—¶ï¼Œreactä¼šæ£€æŸ¥ä¸Šä¸€ä¸ªpropså’Œstateä¸ä¸‹ä¸€ä¸ªproså’Œstateæ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰é‡æ–°æ¸²æŸ“ï¼Œç›¸ç­‰åˆ™ä¸ä¼šé‡æ–°æ¸²æŸ“</p> <p>ç±»ç»„ä»¶ä¸­å³æˆpurecomponentå®ç°</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>import React from 'react'
class TestC extends React.PureComponent{
   constructor(props){
     super(props);
     this.state = {
       conut: 0
     }
   }
  
  render(){
    return(
      &lt;div&gt;
        {this.state.count}
        &lt;button onClick={()=&gt;this.setState({count:1})}&gt;
          click me
        &lt;/button&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="hook"><a href="#hook" class="header-anchor">#</a> Hook</h2> <p>Https://juejin.cn/post/6844903985338400782</p> <p>Hookæ˜¯react16.8æ–°å¢çš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨ä¸ç¼–å†™class çš„æƒ…å†µä¸‹ä½¿ç”¨stateå’Œå…¶ä»–reactç‰¹æ€§ï¼Œreactnativeä»0.59ç‰ˆæœ¬å¼€å§‹æ”¯æŒhookã€‚</p> <h3 id="hookå‡ºç°çš„åŸå› ä»¥åŠè§£å†³çš„é—®é¢˜"><a href="#hookå‡ºç°çš„åŸå› ä»¥åŠè§£å†³çš„é—®é¢˜" class="header-anchor">#</a> hookå‡ºç°çš„åŸå› ä»¥åŠè§£å†³çš„é—®é¢˜</h3> <p>Class component åŠ£åŠ¿</p> <ol><li>çŠ¶æ€é€»è¾‘éš¾å¤ç”¨ï¼šåœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾ï¼Œå¯èƒ½è¦ç”¨åˆ° render props ï¼ˆæ¸²æŸ“å±æ€§ï¼‰æˆ–è€… HOCï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰ï¼Œä½†æ— è®ºæ˜¯æ¸²æŸ“å±æ€§ï¼Œè¿˜æ˜¯é«˜é˜¶ç»„ä»¶ï¼Œéƒ½ä¼šåœ¨åŸå…ˆçš„ç»„ä»¶å¤–åŒ…è£¹ä¸€å±‚çˆ¶å®¹å™¨ï¼ˆä¸€èˆ¬éƒ½æ˜¯ div å…ƒç´ ï¼‰ï¼Œå¯¼è‡´å±‚çº§å†—ä½™ è¶‹å‘å¤æ‚éš¾ä»¥ç»´æŠ¤ï¼š</li> <li>åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­æ··æ‚ä¸ç›¸å¹²çš„é€»è¾‘ï¼ˆå¦‚ï¼šåœ¨ componentDidMount ä¸­æ³¨å†Œäº‹ä»¶ä»¥åŠå…¶ä»–çš„é€»è¾‘ï¼Œåœ¨ componentWillUnmount ä¸­å¸è½½äº‹ä»¶ï¼Œè¿™æ ·åˆ†æ•£ä¸é›†ä¸­çš„å†™æ³•ï¼Œå¾ˆå®¹æ˜“å†™å‡º bug ï¼‰ ç±»ç»„ä»¶ä¸­åˆ°å¤„éƒ½æ˜¯å¯¹çŠ¶æ€çš„è®¿é—®å’Œå¤„ç†ï¼Œå¯¼è‡´ç»„ä»¶éš¾ä»¥æ‹†åˆ†æˆæ›´å°çš„ç»„ä»¶</li> <li>this æŒ‡å‘é—®é¢˜ï¼šçˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ é€’å‡½æ•°æ—¶ï¼Œå¿…é¡»ç»‘å®š this</li></ol> <p>Hookä¸èƒ½åœ¨classä¸­ä½¿ç”¨ï¼Œåªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œä¸ºå‡½æ•°ç»„ä»¶å‹¾å…¥react stateåŠç”Ÿå‘½å‘¨æœŸç­‰å‡½æ•°</p> <p>reactå†…ç½®çš„hookæœ‰ä»¥ä¸‹</p> <p>åŸºç¡€hookï¼šuseStateã€useEffectã€useContext</p> <p>é¢å¤–çš„hookï¼šuseReducerã€useCallbackã€useMemoã€useRefã€useLayoutEffectã€useDebugValueã€useImperativeHandle</p> <h3 id="usestate"><a href="#usestate" class="header-anchor">#</a> useState</h3> <p>å®ä¾‹</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>useState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span>setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">you click </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        click    
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
     </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ä¸Šè¿°useStateæ–¹æ³•å®šä¹‰äº†ä¸€ä¸ªstateå˜é‡countï¼Œå¹¶ç»™ä»–åˆå§‹åŒ–çš„å€¼0ã€‚é€šè¿‡setCountæ–¹æ³•æ›´æ–°å½“å‰countçš„å€¼ã€‚</p> <p>è°ƒç”¨countæ—¶ä¸éœ€è¦ç»‘å®šthisç›´æ¥è°ƒç”¨ï¼Œæ›´æ–°countæ—¶ä¹Ÿç›´æ¥è°ƒç”¨setCountæ–¹æ³•</p> <p>usestateå®šä¹‰stateæ—¶è¿”å›ä¸€ä¸ªæœ‰ä¸¤ä¸ªå€¼çš„æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªæ˜¯å½“å‰stateï¼Œç¬¬äºŒä¸ªæ˜¯æ›´æ–°stateçš„å‡½æ•°ï¼Œ</p> <p>countä¸setCountä¸classä¸­çš„this.state.countå’Œthis.setstateç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯éœ€è¦æˆå¯¹åœ°è·å–ä»–ä»¬ã€‚</p> <p>å¦‚æœåˆå§‹åŒ–stateæ—¶éœ€è¦å¤æ‚è®¡ç®—ï¼Œå¯ä»¥è°ƒç”¨å‡½æ•°ï¼Œæ­¤å‡½æ•°åªåœ¨åˆæ¬¡æ¸²æŸ“æ—¶è¢«è°ƒç”¨</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span>setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> initialState<span class="token operator">=</span> <span class="token function">someExpensiveComputation</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> initialState<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>countä¸setCountä¸classä¸­çš„this.state.countå’Œthis.setstateç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯éœ€è¦æˆå¯¹åœ°è·å–ä»–ä»¬ã€‚</p> <p>å¯ä»¥åŒæ—¶å£°æ˜å¤šä¸ªstateå˜é‡</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">ExamplewithManyStates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span>setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">usestate</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>fruit<span class="token punctuation">,</span>setFruit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">usestate</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span>setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">usestate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>text<span class="token operator">:</span><span class="token string">'å­¦ä¹ '</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Hookåªèƒ½åœ¨å‡½æ•°æœ€å¤–å±‚è°ƒç”¨ï¼Œä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…å­å‡½æ•°ä¸­è°ƒç”¨</p> <p>å¯¹äºclassä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä¸ºäº†èƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½ï¼Œä½¿ç”¨useEffectæ–¹æ³•ï¼Œå®ƒç›¸å½“äºcomponentDidMountã€componentDidupdateã€componentWillUnmountä¸‰ä¸ªå‡½æ•°çš„ç»„åˆ</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="useeffectå’Œuselayouteffect"><a href="#useeffectå’Œuselayouteffect" class="header-anchor">#</a> useEffectå’ŒuseLayoutEffect</h3> <p>useEffecté»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚</p> <p>useEffectåœ¨å…¨éƒ¨æ¸²æŸ“å®Œæ¯•åæ‰ä¼šæ‰§è¡Œï¼Œè€ŒuseLayoutEffectä¼šåœ¨æµè§ˆå™¨layoutä¹‹åï¼Œpaintingä¹‹å‰æ‰§è¡Œ</p> <p>ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œä¸€èˆ¬å…ˆä½¿ç”¨useEffect</p> <p>ä½¿ç”¨æ­¥éª¤ï¼š</p> <ol><li>ä½œä¸º componentDidMount ä½¿ç”¨ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºæ•°ç»„ <code>[]</code></li> <li>ä½œä¸º componentDidUpdate ä½¿ç”¨ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæŒ‡å®šä¾èµ–</li> <li>ä½œä¸º componentWillUnmount ä½¿ç”¨ï¼Œé€šè¿‡ return</li></ol> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const BlinkyRender = () =&gt; {
  const [value, setValue] = useState(0);

  useEffect(() =&gt; {
    document.querySelector('#x').innerText = `value: 1000`
  }, [value]);

  return (
    &lt;div id=&quot;x&quot; onClick={() =&gt; setValue(0)}&gt;value: {value}&lt;/div&gt;
  );
};

ReactDOM.render(
  &lt;BlinkyRender /&gt;,
  document.querySelector(&quot;#root&quot;)
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="usereducer"><a href="#usereducer" class="header-anchor">#</a> useReducer</h3> <p>useStateå†…éƒ¨å°±æ˜¯é useReducerå®ç°çš„ã€‚</p> <p>useReducerå¯ä»¥ç†è§£ä¸ºæ˜¯ç”¨æ¥ä»£æ›¿ Redux çš„ï¼Œæˆ–è€…è¯´ï¼Œæ˜¯ä¸€ä¸ªåŠ å¼ºç‰ˆçš„ <code>useState</code>ã€‚</p> <p>ä½¿ç”¨æ­¥éª¤ï¼š</p> <p>1.åˆ›å»ºåˆå§‹å€¼initialState</p> <p>2.åˆ›å»ºæ‰€æœ‰æ“ä½œreduce(state,action)</p> <p>3.ä¼ ç»™useReducerï¼Œå¾—åˆ°è¯»å’Œå†™api</p> <p>4.è°ƒç”¨ï¼Œå†™({type: 'æ“ä½œç±»å‹'})</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> initial <span class="token operator">=</span> <span class="token punctuation">{</span>
  n<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> n<span class="token operator">:</span> state<span class="token punctuation">.</span>n <span class="token operator">+</span> action<span class="token punctuation">.</span>number <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;multi&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> n<span class="token operator">:</span> state<span class="token punctuation">.</span>n <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;unknown type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initial<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> n <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> number<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onClick2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> number<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>n<span class="token operator">:</span> <span class="token punctuation">{</span>n<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onClick2<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="usecontext"><a href="#usecontext" class="header-anchor">#</a> useContext</h3> <p>æ¥å—ä¸€ä¸ªcontextå¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥contextçš„å½“å‰å€¼ï¼Œç”¨äºåœ¨å‡½æ•°ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€</p> <p>ä½¿ç”¨æ–¹æ³•ï¼š</p> <p>1.ä½¿ç”¨C=createContext(initial)åˆ›å»ºä¸Šä¸‹æ–‡</p> <p>2.ä½¿ç”¨&lt;C.provider&gt;åœˆå®šä½œç”¨åŸŸ</p> <p>3.åœ¨ä½œç”¨åŸŸå†…ä½¿ç”¨ <code>useContext(C)</code> æ¥ä½¿ç”¨ä¸Šä¸‹æ–‡</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const C = createContext(null);

function App() {
  console.log(&quot;App æ‰§è¡Œäº†&quot;);
  const [n, setN] = useState(0);
  return (
    &lt;C.Provider value={{ n, setN }}&gt;
      &lt;div className=&quot;App&quot;&gt;
        &lt;Baba /&gt;
      &lt;/div&gt;
    &lt;/C.Provider&gt;
  );
}

function Baba() {
  const { n, setN } = useContext(C);
  return (
    &lt;div&gt;
      æˆ‘æ˜¯çˆ¸çˆ¸ n: {n} &lt;Child /&gt;
    &lt;/div&gt;
  );
}

function Child() {
  const { n, setN } = useContext(C);
  const onClick = () =&gt; {
    setN(i =&gt; i + 1);
  };
  return (
    &lt;div&gt;
      æˆ‘æ˜¯å„¿å­ æˆ‘å¾—åˆ°çš„ n: {n}
      &lt;button onClick={onClick}&gt;+1&lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="usecallbackä¸usememo"><a href="#usecallbackä¸usememo" class="header-anchor">#</a> usecallbackä¸useMemo</h3> <p>useMemoæ—¶ä¸€ç§ç¼“å­˜æœºåˆ¶æé€Ÿï¼Œå½“ä»–çš„ä¾èµ–æœªå‘ç”Ÿæ”¹å˜æ—¶å°±ä¸ä¼šè§¦å‘é‡æ–°è®¡ç®—ï¼Œä¸vueä¸­computedç±»ä¼¼</p> <p>useMemo</p> <p>ä½¿ç”¨è¯­æ³•ï¼šuseMemo(()=&gt; fn,deps)</p> <p>æŠŠåˆ›å»ºå‡½æ•°å’Œä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥useMemoï¼Œå®ƒåªä¼šåœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰é‡æ–°è®¡ç®—memo</p> <p>useMemoä¸usecallbackçš„åŒºåˆ«ï¼š<code>useMemo</code>å¯ä»¥ç¼“å­˜æ‰€æœ‰å¯¹è±¡ï¼Œ<code>useCallback</code>åªèƒ½ç¼“å­˜å‡½æ•°ã€‚</p> <p><code>useCallback(x =&gt; log(x), [m])</code> ç­‰ä»·äº <code>useMemo(() =&gt; x =&gt; log(x), [m])</code></p> <h3 id="useref"><a href="#useref" class="header-anchor">#</a> useRef</h3> <p>ä¸»è¦ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ•°æ®çš„å¼•ç”¨ï¼Œå¹¶è®©è¿™ä¸ªæ•°æ®åœ¨ render è¿‡ç¨‹ä¸­å§‹ç»ˆ<strong>ä¿æŒä¸å˜</strong>ã€‚</p> <p>åŸºæœ¬è¯­æ³•ï¼š <code>const count = useRef(0)</code>ï¼Œè¯»å–ç”¨ <code>count.current</code></p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>export function ReactEcharts(props) {
  const {option, loading} = props
  const container = useRef(null)
  const chart = useRef(null)

  useEffect(() =&gt; {
    const width = document.documentElement.clientWidth
    const c = container.current
    console.log(c)
    c.style.width = `${width - 20}px`
    c.style.height = `${(width - 20) * 1.2}px`
    chart.current = echarts.init(c, 'dark')

  }, []) // [] - mounted on first time

  useEffect(() =&gt; {
    chart.current.setOption(option)
  }, [option]) // when option change ç±»ä¼¼ vue çš„ watch

  useEffect(() =&gt; {
    if (loading) chart.current.showLoading()
    else chart.current.hideLoading()
  }, [loading])
  return (
    &lt;div ref={container}/&gt;
  )
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="è‡ªå®šä¹‰hookæ··ç”¨"><a href="#è‡ªå®šä¹‰hookæ··ç”¨" class="header-anchor">#</a> è‡ªå®šä¹‰hookæ··ç”¨</h3> <p>å¯ä»¥æŠŠä¸åŒçš„hookæŒ‰ç…§å®é™…çš„éœ€æ±‚æ··åˆèµ·æ¥ï¼Œå°è£…æˆä¸€ä¸ªæ–°çš„å‡½æ•°ä½¿ç”¨</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const useList = () =&gt; {
  const [list, setList] = useState(null);
  useEffect(() =&gt; {
    ajax(&quot;/list&quot;).then(list =&gt; {
      setList(list);
    });
  }, []); // [] ç¡®ä¿åªåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œ
  return {
    list: list,
    setList: setList
  };
};
export default useList;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="hookçš„ä½¿ç”¨è§„åˆ™"><a href="#hookçš„ä½¿ç”¨è§„åˆ™" class="header-anchor">#</a> hookçš„ä½¿ç”¨è§„åˆ™</h3> <p>hookæœ‰ä»¥ä¸‹ä½¿ç”¨è§„åˆ™ï¼š</p> <ol><li>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hook</li> <li>ç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„ React å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨ä»–ä»¬ã€‚</li> <li>é¡ºåºè°ƒç”¨ã€‚éµå®ˆè¿™æ¡è§„åˆ™ï¼Œä½ å°±èƒ½ç¡®ä¿ Hook åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½æŒ‰ç…§åŒæ ·çš„é¡ºåºè¢«è°ƒç”¨ã€‚è¿™è®© React èƒ½å¤Ÿåœ¨å¤šæ¬¡çš„ useState å’Œ useEffect è°ƒç”¨ä¹‹é—´ä¿æŒ hook çŠ¶æ€çš„æ­£ç¡®ã€‚</li></ol> <p>åœ¨å•ä¸ªç»„ä»¶ä¸­å¯ä»¥ä½¿ç”¨å¤šä¸ª State Hook æˆ– Effect Hookï¼Œä½†æ˜¯React æ€ä¹ˆçŸ¥é“å“ªä¸ª state å¯¹åº”å“ªä¸ª <code>useState</code>ï¼Ÿç­”æ¡ˆæ˜¯ React é çš„æ˜¯ Hook è°ƒç”¨çš„é¡ºåºã€‚å› ä¸ºæˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼ŒHook çš„è°ƒç”¨é¡ºåºåœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚åªè¦ Hook çš„è°ƒç”¨é¡ºåºåœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ä¿æŒä¸€è‡´ï¼ŒReact å°±èƒ½æ­£ç¡®åœ°å°†å†…éƒ¨ state å’Œå¯¹åº”çš„ Hook è¿›è¡Œå…³è”ã€‚</p> <p>å¦‚æœåœ¨è¯­å¥ä¸­ä½¿ç”¨hook</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token comment">// ğŸ”´ åœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ Hook è¿åç¬¬ä¸€æ¡è§„åˆ™</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ <code>name !== ''</code> è¿™ä¸ªæ¡ä»¶å€¼ä¸º <code>true</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šæ‰§è¡Œè¿™ä¸ª Hookã€‚ä½†æ˜¯ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶æˆ‘ä»¬å¯èƒ½æ¸…ç©ºäº†è¡¨å•ï¼Œè¡¨è¾¾å¼å€¼å˜ä¸º <code>false</code>ã€‚æ­¤æ—¶çš„æ¸²æŸ“ä¼šè·³è¿‡è¯¥ Hookï¼ŒHook çš„è°ƒç”¨é¡ºåºå‘ç”Ÿäº†æ”¹å˜ï¼š</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. è¯»å–å˜é‡åä¸º name çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰</span>
<span class="token comment">// useEffect(persistForm)  // ğŸ”´ æ­¤ Hook è¢«å¿½ç•¥ï¼</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// ğŸ”´ 2 ï¼ˆä¹‹å‰ä¸º 3ï¼‰ã€‚è¯»å–å˜é‡åä¸º surname çš„ state å¤±è´¥</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// ğŸ”´ 3 ï¼ˆä¹‹å‰ä¸º 4ï¼‰ã€‚æ›¿æ¢æ›´æ–°æ ‡é¢˜çš„ effect å¤±è´¥</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>React ä¸çŸ¥é“ç¬¬äºŒä¸ª <code>useState</code> çš„ Hook åº”è¯¥è¿”å›ä»€ä¹ˆã€‚React ä¼šä»¥ä¸ºåœ¨è¯¥ç»„ä»¶ä¸­ç¬¬äºŒä¸ª Hook çš„è°ƒç”¨åƒä¸Šæ¬¡çš„æ¸²æŸ“ä¸€æ ·ï¼Œå¯¹åº”çš„æ˜¯ <code>persistForm</code> çš„ effectï¼Œä½†å¹¶éå¦‚æ­¤ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œåé¢çš„ Hook è°ƒç”¨éƒ½è¢«æå‰æ‰§è¡Œï¼Œå¯¼è‡´ bug çš„äº§ç”Ÿã€‚</p> <h3 id="hookçš„é—­åŒ…é™·é˜±-è¿‡æœŸé—­åŒ…"><a href="#hookçš„é—­åŒ…é™·é˜±-è¿‡æœŸé—­åŒ…" class="header-anchor">#</a> Hookçš„é—­åŒ…é™·é˜±(è¿‡æœŸé—­åŒ…)</h3> <p>é—­åŒ…é™·é˜±å°±æ˜¯åœ¨React Hookè¿›è¡Œå¼€å‘æ—¶ï¼Œé€šè¿‡useStateå®šä¹‰çš„å€¼æ‹¿åˆ°çš„éƒ½ä¸æ˜¯æœ€æ–°çš„å€¼</p> <p>ä¸Šä»£ç </p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const App = () =&gt;{
   const [count,setCount] = useState(0)
   useEffect(()=&gt;{
     const timeId = setInterval(()=&gt;{
        setCount(count+1)
     },1000)
     return ()=&gt;{clearInterval(timeId)}
   },[])
   return (
      &lt;span&gt;{count}&lt;/span&gt;
   )
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œcountå¹¶ä¸ä¼šå’Œç†æƒ³ä¸­ä¸€æ ·æ¯è¿‡ä¸€ç§’è‡ªåŠ¨+1å¹¶æ›´æ–°DOMï¼Œè€Œæ˜¯ä»0å˜æˆ1åï¼Œconsoleæ‰“å°å‡ºçš„countä¸€ç›´æ˜¯è®¾ç«‹çš„é»˜è®¤å€¼0</p> <p>å› ä¸ºuseEffectçš„ä¾èµ–æ•°ç»„æ˜¯ç©ºæ•°ç»„ï¼Œé‚£setIntervalé‡Œé¢çš„countæ˜¯é€šè¿‡é—­åŒ…å–å¾—çš„å€¼ï¼Œä»–è¯»å–åˆ°çš„ç¬¬ä¸€æ¬¡çš„countï¼Œå¹¶ä¸”useEffectå¹¶æ²¡æœ‰æ›´æ–°ï¼Œå› ä¸ºæ¯æ¬¡éƒ½æ˜¯0</p> <p>å¦‚æœå»æ‰useEffectçš„ä¾èµ–æ•°ç»„å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç„¶è€Œä¼šé€ æˆæ¯æ¬¡Appç»„ä»¶æ¸²æŸ“éƒ½ä¼šè¿è¡ŒuseEffecté‡Œé¢çš„å‡½æ•°ï¼Œå°±ä¼šé€ æˆä¸å¿…è¦çš„æµªè´¹å’Œéšè—çš„bug</p> <h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="header-anchor">#</a> è§£å†³æ–¹æ¡ˆ</h4> <p><strong>ä½¿ç”¨setstateå›è°ƒ</strong></p> <p>æŠŠsetCount(count+1)æ”¹æˆsetCount(count=&gt;count+1)ï¼Œå‡½æ•°å¼æ›´æ–°</p> <p>å®ƒå…è®¸æˆ‘ä»¬æŒ‡å®šstateå¦‚ä½•æ”¹å˜è€Œä¸å¼•ç”¨å½“å‰çš„stateï¼Œå› ä¸ºå›è°ƒå‡½æ•°ä¸­çš„å‚æ•°æ˜¯æœ€æ–°çš„countå€¼</p> <p><strong>ä½¿ç”¨useReducerä»£æ›¿</strong></p> <p>æŠŠsetCountæ”¹æˆuseReducerçš„dispatchï¼Œå› ä¸ºuseReducerçš„dispatchçš„èº«ä»½æ°¸è¿œæ˜¯ç¨³å®šçš„ã€‚å³ä½¿reducerå‡½æ•°æ˜¯å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨ä¸”ä¾èµ–props</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const setCountReducer = (state,action)=&gt;{
   switch(action.type){
     case 'add':
       return state+action.value 
     case 'minus':
       return state-action.value
     default: 
       return state
   }
}

const App = () =&gt;{
  const [count,dispatch] = useReducer(setCountReducer,0)
  useEffect(()=&gt;{
    const timeId = setInterval(()=&gt;{
      dispatch({type:'add',value:1})
    },1000)
    return ()=&gt; clearInterval(timeId)
  },[])
  return (
     &lt;span&gt;{count}&lt;/span&gt;
  )
} 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>ä½¿ç”¨useRefå­˜å‚¨å˜é‡</strong></p> <p>é€šè¿‡useRefç”Ÿæˆçš„å¯¹è±¡é»˜è®¤éƒ½æ˜¯{current:{}},æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä»–ä¹Ÿæ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œä¸ä¼šå› ä¸ºç»„ä»¶çš„é‡æ–°æ¸²æŸ“å¯¼è‡´å–å¾—é—­åŒ…çš„å¯¹è±¡å¼•ç”¨ï¼Œå› æ­¤å®ƒä¸ä»…å¯ä»¥ç»‘å®šDOMï¼Œä¹Ÿå¯ä»¥ç»‘å®šä»»æ„æˆ‘ä»¬æƒ³ç»‘å®šçš„æ•°æ®</p> <p>æ”¹é€ ä»£ç å¦‚ä¸‹</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const App = () =&gt;{
  const [count,setCount] = useState(0)
  const countRef = useRef()
  countRef.current = count
  useEffect(()=&gt;{
    const timeId = setInterval(()=&gt;{
      setCount(countRef.current+1)
    },1000)
    return ()=&gt; clearInterval(timeId)
  },[])
  return (
     &lt;span&gt;{countRef.current}&lt;/span&gt;
  )
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="å…¶ä»–ä¼šå¯¼è‡´é—­åŒ…é™·é˜±çš„æƒ…å†µ"><a href="#å…¶ä»–ä¼šå¯¼è‡´é—­åŒ…é™·é˜±çš„æƒ…å†µ" class="header-anchor">#</a> å…¶ä»–ä¼šå¯¼è‡´é—­åŒ…é™·é˜±çš„æƒ…å†µ</h4> <p>å¼‚æ­¥å‡½æ•°</p> <p>ä½¿ç”¨setIntervalå’ŒsetTimeoutå‡½æ•°æ—¶ï¼Œå†…éƒ¨çš„å˜é‡è¯»å–çš„æ˜¯å¼‚æ­¥å‡½æ•°åœ¨è¿è¡Œæ—¶ç»„ä»¶å¤„åœ¨é—­åŒ…æƒ…å†µä¸‹çš„å½“å‰å€¼ï¼Œå› ä¸ºåœ¨å¼‚æ­¥å‡½æ•°å†…éƒ¨çš„æ•°æ®å¹¶ä¸ä¼šåœ¨domæ›´æ–°ä¹‹åæ›´æ–°ä¸ºæ–°çš„å€¼ï¼Œä»–ä»¬çš„å˜é‡å¼•ç”¨å·²ç»ä¸æ˜¯åŒä¸€ä¸ªäº†</p> <p>ä¸Šä»£ç </p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const App = ()=&gt;{
  const [count,setCount] = useState(0)
  const consoleCount = ()=&gt;{
    const timeId = setTimeout(()=&gt;{
       console.log(count)
    },2000)
    return ()=&gt; clearTimeout(timeId)
  }
  return (
    &lt;div&gt;
      &lt;span&gt;{count}&lt;/span&gt;
      &lt;button onClick={()=&gt;setCount(count+1)}&gt;æŒ‰æˆ‘åŠ 1&lt;/button&gt;
      &lt;button onClick={consoleCount}&gt;è¾“å‡ºcount&lt;/button&gt;
    &lt;/div&gt;
  )
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>å…ˆç‚¹å‡»ä¸‰æ¬¡åŠ 1æŒ‰é’®ï¼ŒæŠŠcountå˜æˆ3ï¼Œç„¶åç‚¹å‡»è¾“å‡ºæŒ‰é’®ï¼Œæ­¤æ—¶å†ç‚¹å‡»åŠ 1æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºçš„countè¿˜æ˜¯3ï¼Œå³è¾“å‡ºçš„countæ˜¯æ—§å€¼</p> <p>domç›‘å¬å‡½æ•°äº‹ä»¶ä¸­çš„åŒ¿åå‡½æ•°</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>const App = () =&gt;{
    const [count,setCount] = useState(0)
    const consoleCount = ()=&gt;{
      console.log(count)
    }
    useEffect(()=&gt;{
      window.addEventListener('scroll',consoleCount)
      return ()=&gt;{
         window.removeEventListener('scroll',consoleCount)
      }
    },[])
  
    return (
       &lt;div style={{height:'400vh'}}&gt;
         &lt;span&gt;{count}&lt;/span&gt;
        &lt;button onClick={()=&gt;setCount(count+1)}&gt;æŒ‰æˆ‘åŠ 1&lt;/button&gt;
      &lt;button onClick={consoleCount}&gt;è¾“å‡ºcount&lt;/button&gt;
      &lt;/div&gt;
    )
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ä¸ç®¡é¡µé¢æ€ä¹ˆæ»šåŠ¨ï¼Œè¾“å‡ºçš„countæ°¸è¿œæ˜¯0ã€‚å› ä¸ºaddEventListeneråªåœ¨useEffectåˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œäº†ç»‘å®šï¼Œæ‰§è¡Œå‡½æ•°çš„æ—¶å€™ï¼Œcountè¯»å–çš„æ˜¯ç»‘å®šå‡½æ•°æ—¶çš„æ—§å€¼</p> <p>ä½¿ç”¨useRef()å­˜å‚¨å®ä¾‹å˜é‡ä¹Ÿèƒ½è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯reactå®˜æ–¹æ¨èçš„æ–¹æ³•ã€‚</p> <h3 id="ä½¿ç”¨react-hookså¦‚ä½•è®©ä¸‹é¢çš„å­ç»„ä»¶åªrenderä¸€æ¬¡"><a href="#ä½¿ç”¨react-hookså¦‚ä½•è®©ä¸‹é¢çš„å­ç»„ä»¶åªrenderä¸€æ¬¡" class="header-anchor">#</a> ä½¿ç”¨react hookså¦‚ä½•è®©ä¸‹é¢çš„å­ç»„ä»¶åªrenderä¸€æ¬¡</h3> <p>ä½¿ç”¨useRefä¿å­˜å­ç»„ä»¶çŠ¶æ€ï¼Œå½“çˆ¶ç»„ä»¶æ›´æ–°æ—¶ï¼Œç›´æ¥æ›´æ–°refå€¼ï¼Œå½“å­ç»„ä»¶clickæ—¶ï¼Œåœ¨æ›´æ–°refå€¼åï¼Œå†è°ƒç”¨ä¸€æ¬¡updateè§¦å‘å­ç»„ä»¶æ¸²æŸ“</p> <div class="language-react line-numbers-mode"><pre class="language-text"><code>import React,{useEffect,useMemo,useState,useRef} from 'react'
function A(){
   const [count,setCount] = useState(0);
   
   return (
      &lt;div&gt;
        &lt;p&gt;æˆ‘æ˜¯çˆ¶ç»„ä»¶&lt;/p&gt;
        &lt;p&gt;çˆ¶ç»„ä»¶çš„countæ˜¯{count}&lt;/p&gt;
        &lt;button&gt;click&lt;/button&gt;
        &lt;B count={count}/&gt;
      &lt;/div&gt;
   );
}

const B = React.memo(({count:}{count:number})=&gt;{
  const numberRef = useRef(0);
  const [,update] = useState({});
  const updateNumber = () =&gt;{
    numberRef.current++;
    update({});
  };
  
  useMemo(()=&gt;{
    numberRef.current = count;
  },[count])
  
  console.log('å­ç»„ä»¶Render')
  
  return(
     &lt;div&gt;
       &lt;p&gt;æˆ‘æ˜¯å­ç»„ä»¶&lt;/p&gt;
       &lt;p&gt;å­ç»„ä»¶çš„numberæ˜¯{numberRef.current}&lt;/p&gt;
       &lt;button onClick={updateNumber}&gt;click&lt;/button&gt;
     &lt;/div&gt;
  )
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="fiberæ¶æ„"><a href="#fiberæ¶æ„" class="header-anchor">#</a> Fiberæ¶æ„</h2> <p>react16ç›¸æ¯”äºreact15ï¼Œç»è¿‡é‡æ„åReconciliationå’ŒRenderingè¢«åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„é˜¶æ®µã€‚</p> <h3 id="fiberæ¶æ„ä¸­çš„åŸºæœ¬æ¦‚å¿µ"><a href="#fiberæ¶æ„ä¸­çš„åŸºæœ¬æ¦‚å¿µ" class="header-anchor">#</a> fiberæ¶æ„ä¸­çš„åŸºæœ¬æ¦‚å¿µ</h3> <p>Fiber çš„æ¶æ„æœ‰ä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼šåè°ƒ/æ¸²æŸ“ å’Œ æäº¤ã€‚</p> <p><strong>reconcileråè°ƒé˜¶æ®µ</strong>ï¼šå½“ç»„ä»¶æ¬¡åˆå§‹åŒ–å’Œå…¶åçš„çŠ¶æ€æ›´æ–°ä¸­ï¼ŒReactä¼šåˆ›å»ºä¸¤é¢—ä¸ç›¸åŒçš„è™šæ‹Ÿæ ‘ï¼ŒReact éœ€è¦åŸºäºè¿™ä¸¤æ£µæ ‘ä¹‹é—´çš„å·®åˆ«æ¥åˆ¤æ–­å¦‚ä½•æœ‰æ•ˆç‡çš„æ›´æ–° UI ä»¥ä¿è¯å½“å‰ UI ä¸æœ€æ–°çš„æ ‘ä¿æŒåŒæ­¥ï¼Œè®¡ç®—æ ‘å“ªäº›éƒ¨åˆ†éœ€è¦æ›´æ–°ã€‚<strong>react diffç®—æ³•å°±å‘ç”Ÿåœ¨è¿™ä¸ªé˜¶æ®µ</strong></p> <p><strong>rendereré˜¶æ®µ</strong>ï¼šæ¸²æŸ“å™¨è´Ÿè´£å°†æ‹¿åˆ°çš„è™šæ‹Ÿç»„ä»¶æ ‘ä¿¡æ¯ï¼Œæ ¹æ®å…¶å¯¹åº”ç¯å¢ƒçœŸå®åœ°æ›´æ–°æ¸²æŸ“åˆ°åº”ç”¨ä¸­ã€‚æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹ä¸€ä¸‹danè‡ªå·±çš„åšå®¢ä¸­çš„æ–‡ç« =ã€‹<a href="https://overreacted.io/react-as-a-ui-runtime/#renderers" target="_blank" rel="noopener noreferrer">è¿è¡Œæ—¶çš„react=ã€‹æ¸²æŸ“å™¨<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œä»‹ç»äº†reactçš„Rendereræ¸²æŸ“å™¨å¦‚react-domå’Œreact nativeç­‰ï¼Œå…¶å¯ä»¥æ ¹æ®ä¸åŒçš„ä¸»ç¯å¢ƒæ¥ç”Ÿæˆä¸åŒçš„å®ä¾‹ã€‚</p> <p>åè°ƒé˜¶æ®µçš„å·¥ä½œï¼š</p> <p>åè°ƒé˜¶æ®µé€šå¸¸è¢«ç§°ä¸ºâ€œæ¸²æŸ“é˜¶æ®µâ€ã€‚è¿™æ˜¯Reactéå†ç»„ä»¶æ ‘çš„é˜¶æ®µï¼Œå¹¶ä¸”ï¼š</p> <ul><li>æ›´æ–°çŠ¶æ€å’Œå±æ€§</li> <li>è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­</li> <li>è·å–ç»„ä»¶çš„<code>children</code></li> <li>å°†å®ƒä»¬ä¸ä¹‹å‰çš„<code>children</code>è¿›è¡Œå¯¹æ¯”</li> <li>å¹¶è®¡ç®—å‡ºéœ€è¦æ‰§è¡Œçš„DOMæ›´æ–°</li></ul> <p><strong>fiberå¯¹è±¡</strong></p> <p>ä¸€ä¸ªfiberå¯¹è±¡æ˜¯è¡¨å¾workçš„ä¸€ä¸ªåŸºæœ¬å•å…ƒã€‚</p> <p>æ¯ä¸€ä¸ªReactå…ƒç´ å¯¹åº”ä¸€ä¸ªfiberå¯¹è±¡ï¼Œfibersæ˜¯ä¸€ä¸ªåŸºäºchild, sibling å’Œ returnå±æ€§æ„æˆçš„é“¾è¡¨ã€‚ fiberå¯¹è±¡æ ¸å¿ƒçš„å±æ€§å’Œå«ä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <p><strong>childã€silbingã€return</strong></p> <p>fiberå¯¹è±¡çš„å±æ€§ï¼Œè¿™äº›å±æ€§æŒ‡å‘å…¶ä»–fiberï¼Œè¡¨å¾å½“å‰å·¥ä½œå•å…ƒçš„ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒï¼Œç”¨äºæè¿°fiberçš„é€’å½’æ ‘ç»“æ„ã€‚</p> <p>childï¼š å¯¹åº”äºçˆ¶fiberèŠ‚ç‚¹çš„å­fiber silbingï¼š å¯¹åº”äºfiberèŠ‚ç‚¹çš„åŒç±»å…„å¼ŸèŠ‚ç‚¹ returnï¼š å¯¹åº”äºfiberèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</p> <p>ç›¸å¯¹äºReact v16ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæ­£æ˜¯å¾—ç›Šäºfiberå¯¹è±¡çš„childã€sibingå’Œreturnå±æ€§æ„æˆçš„å•é“¾è¡¨ç»“æ„ä»¥åŠfiberå¯¹è±¡ä¸­å­˜å‚¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ‰ä½¿å¾—schedulerå¯ä»¥è¾¾åˆ°æš‚åœã€ä¸­æ­¢ã€é‡æ–°å¼€å§‹ç­‰å¹¶å‘æ¨¡å¼çš„æ–°ç‰¹æ€§ã€‚</p> <p><strong>work</strong></p> <p>åœ¨React reconciliationè¿‡ç¨‹ä¸­å‡ºç°çš„å„ç§æ¯”å¦‚state updateï¼Œprops update æˆ– refs updateç­‰å¿…é¡»æ‰§è¡Œè®¡ç®—çš„æ´»åŠ¨ï¼Œè¿™äº›æ´»åŠ¨æˆ‘ä»¬åœ¨Fiberæ¶æ„ä½“ç³»é‡Œé¢ç»Ÿä¸€ç§°ä¹‹ä¸º â€œworkâ€ã€‚</p> <p><strong>worktag</strong></p> <p>workTag ç±»å‹ï¼Œç”¨äºæè¿°ä¸€ä¸ªReactå…ƒç´ çš„ç±»å‹ï¼Œå³ä¸ºä¸Šè¿°fiberå¯¹è±¡çš„ fiber.tag</p> <p><strong>stateNode</strong></p> <p>ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªDOMèŠ‚ç‚¹æˆ–å…¶ä»–è·ŸfiberèŠ‚ç‚¹ç›¸å…³è”çš„Reactå…ƒç´ çš„å®ä¾‹çš„å¼•ç”¨ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥è¯´è¿™ä¸ªå±æ€§æ˜¯ç”¨äºä¿å­˜ä¸ä¸€ä¸ªfiberç›¸å…³è”çš„æœ¬åœ°çŠ¶æ€ã€‚å³ä¸Šè¿°fiberå¯¹è±¡çš„ fiber.stateNodeã€‚</p> <p><strong>currentæ ‘å’ŒworkInProgressæ ‘</strong></p> <p>é¦–æ¬¡æ¸²æŸ“åï¼ŒReactç”Ÿæˆä¸€ä¸ªç”¨äºæ¸²æŸ“UIå¹¶èƒ½æ˜ å°„åº”ç”¨çŠ¶æ€çš„fiberæ ‘ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸ºcurrentæ ‘ã€‚å½“Reactéå†currentæ ‘ï¼Œå®ƒä¸ºæ¯ä¸€ä¸ªå­˜åœ¨çš„fiberèŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªalternateå±æ€§çš„æ›¿ä»£èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹æ„æˆworkInProgressæ ‘ã€‚</p> <p>æ‰€æœ‰å‘ç”Ÿupdateçš„workéƒ½åœ¨workInProgressæ ‘ä¸­æ‰§è¡Œï¼Œå¦‚æœalternateå±æ€§è¿˜æœªåˆ›å»ºï¼ŒReactå°†åœ¨å¤„ç†updateä¹‹å‰åœ¨createWorkInProgresså‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªcurrentæ ‘çš„å‰¯æœ¬ï¼Œå³å½¢æˆworkInProgressæ ‘ï¼Œç”¨äºæ˜ å°„æ–°çš„çŠ¶æ€å¹¶åœ¨commité˜¶æ®µåˆ·æ–°åˆ°å±å¹•ã€‚</p> <p><strong>æ‰€æœ‰è¿™äº›æ´»åŠ¨éƒ½è¢«ç§°ä¸ºFiberå†…éƒ¨çš„å·¥ä½œã€‚</strong> éœ€è¦å®Œæˆçš„å·¥ä½œç±»å‹å–å†³äºReact Elementçš„ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œå¯¹äº <code>Class Component</code> Reactéœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªç±»ï¼Œç„¶è€Œå¯¹äº<code>Functional Component</code>å´ä¸éœ€è¦ã€‚</p> <p>åœ¨æµè§ˆå™¨ä¸­GUIæ¸²æŸ“çº¿ç¨‹ä¸JSå¼•æ“çº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œå½“JSå¼•æ“æ‰§è¡Œæ—¶GUIçº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼ˆç›¸å½“äºè¢«å†»ç»“äº†ï¼‰ï¼ŒGUIæ›´æ–°ä¼šè¢«ä¿å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ç­‰åˆ°JSå¼•æ“ç©ºé—²æ—¶ç«‹å³è¢«æ‰§è¡Œã€‚</p> <p><strong>Stack Reconciler å’Œ fiber reconciliation</strong></p> <p>React16 æ¨å‡ºFiberä¹‹å‰åè°ƒç®—æ³•æ˜¯Stack Reconcilerï¼Œå³é€’å½’éå†æ‰€æœ‰çš„ Virtual DOM èŠ‚ç‚¹æ‰§è¡ŒDiffç®—æ³•ï¼Œä¸€æ—¦å¼€å§‹ä¾¿æ— æ³•ä¸­æ–­ï¼Œç›´åˆ°æ•´é¢—è™šæ‹Ÿdomæ ‘æ„å»ºå®Œæˆåæ‰ä¼šé‡Šæ”¾ä¸»çº¿ç¨‹ï¼Œå› å…¶JavaScriptå•çº¿ç¨‹çš„ç‰¹ç‚¹ï¼Œè‹¥å½“ä¸‹ç»„ä»¶å…·æœ‰å¤æ‚çš„åµŒå¥—å’Œé€»è¾‘å¤„ç†ï¼Œdiffä¾¿ä¼šå µå¡UIè¿›ç¨‹ï¼Œä½¿åŠ¨ç”»å’Œäº¤äº’ç­‰ä¼˜å…ˆçº§ç›¸å¯¹è¾ƒé«˜çš„ä»»åŠ¡æ— æ³•ç«‹å³å¾—åˆ°å¤„ç†ï¼Œé€ æˆé¡µé¢å¡é¡¿æ‰å¸§ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚åœ¨<code>React15</code>åŠä¹‹å‰ï¼Œ<code>React</code>ä¼šé€’å½’æ¯”å¯¹<code>VirtualDOM</code>æ ‘ï¼Œæ‰¾å‡ºéœ€è¦å˜åŠ¨çš„èŠ‚ç‚¹ï¼Œç„¶ååŒæ­¥æ›´æ–°å®ƒä»¬ã€‚è¿™ä¸ªè¿‡ç¨‹<code>React</code>ç§°ä¸º<code>Reconciliation(åè°ƒ)</code>ã€‚</p> <p>åœ¨<code>Reconciliation</code>æœŸé—´ï¼Œ<code>React</code>ä¼šä¸€ç›´å ç”¨ç€æµè§ˆå™¨èµ„æºï¼Œä¸€åˆ™ä¼šå¯¼è‡´ç”¨æˆ·è§¦å‘çš„äº‹ä»¶å¾—ä¸åˆ°å“åº”, äºŒåˆ™ä¼šå¯¼è‡´æ‰å¸§ï¼Œç”¨æˆ·å¯èƒ½ä¼šæ„Ÿè§‰åˆ°å¡é¡¿ã€‚</p> <p>é’ˆå¯¹ä¸Šè¿°ç—›ç‚¹ï¼Œæˆ‘ä»¬æœŸæœ›å°†**â€æ‰¾å‡ºæœ‰å¢åˆ æ”¹çš„èŠ‚ç‚¹â€œï¼Œâ€ç„¶ååŒæ­¥æ›´æ–°ä»–ä»¬â€œ<strong>è¿™ä¸ªè¿‡ç¨‹åˆ†è§£æˆä¸¤ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œæˆ–è€…é€šè¿‡æŸç§æ–¹å¼èƒ½è®©æ•´ä¸ªè¿‡ç¨‹</strong>å¯ä¸­æ–­å¯æ¢å¤çš„æ‰§è¡Œ**ï¼Œç±»ä¼¼äºå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿçš„å•å¤„ç†å™¨è°ƒåº¦ã€‚</p> <p>fiberçš„æ ¸å¿ƒç›®æ ‡ï¼š</p> <ul><li>æŠŠå¯ä¸­æ–­çš„å·¥ä½œæ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡</li> <li>ä¸ºä¸åŒç±»å‹çš„æ›´æ–°åˆ†é…ä»»åŠ¡ä¼˜å…ˆçº§</li> <li>æ›´æ–°æ—¶èƒ½å¤Ÿæš‚åœï¼Œç»ˆæ­¢ï¼Œå¤ç”¨æ¸²æŸ“ä»»åŠ¡</li></ul> <p>è¿™æ˜¯ä¸€ç§<strong>åˆä½œå¼è°ƒåº¦</strong>ï¼Œéœ€è¦ç¨‹åºå’Œæµè§ˆå™¨äº’ç›¸ä¿¡ä»»ã€‚æµè§ˆå™¨ä½œä¸ºé¢†å¯¼è€…ï¼Œä¼šåˆ†é…æ‰§è¡Œæ—¶é—´ç‰‡ï¼ˆå³requestIdleCallbackï¼‰ç»™ç¨‹åºå»é€‰æ‹©è°ƒç”¨ï¼Œç¨‹åºéœ€è¦æŒ‰ç…§çº¦å®šåœ¨è¿™ä¸ªæ—¶é—´å†…æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤è¿˜æµè§ˆå™¨ã€‚</p> <p>Fiberæ˜¯ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼ŒReactå°±ä¼šæ£€æŸ¥ç°åœ¨è¿˜å‰©å¤šå°‘æ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰æ—¶é—´å°±å°†æ§åˆ¶æƒäº¤è¿˜æµè§ˆå™¨ï¼›ç„¶åç»§ç»­è¿›è¡Œä¸‹ä¸€å¸§çš„æ¸²æŸ“ã€‚</p> <p>ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†</p> <p>å¦‚æœæ²¡æœ‰é•¿å­ï¼Œåˆ™æ ‡è¯†å½“å‰èŠ‚ç‚¹éå†å®Œæˆã€‚<code>completeUnitOfWork</code>ä¸­æ”¶é›†</p> <p>å¦‚æœæ²¡æœ‰ç›¸é‚»å…„å¼Ÿï¼Œåˆ™è¿”å›çˆ¶èŠ‚ç‚¹æ ‡è¯†çˆ¶èŠ‚ç‚¹éå†å®Œæˆã€‚<code>completeUnitOfWork</code>ä¸­æ”¶é›†</p> <p>å¦‚æœæ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œæ ‡è¯†æ‰€æœ‰éå†å®Œæˆã€‚<code>over</code></p> <p>å¦‚æœæœ‰é•¿å­ï¼Œåˆ™éå†ï¼›<code>beginWork</code>ä¸­æ”¶é›†ï¼›æ”¶é›†å®Œåè¿”å›å…¶é•¿å­ï¼Œå›åˆ°<code>ç¬¬2æ­¥</code>å¾ªç¯éå†</p> <p>å¦‚æœæœ‰ç›¸é‚»å…„å¼Ÿï¼Œåˆ™éå†ï¼›<code>beginWork</code>ä¸­æ”¶é›†ï¼›æ”¶é›†å®Œåè¿”å›å…¶é•¿å­ï¼Œå›åˆ°<code>ç¬¬2æ­¥</code>å¾ªç¯éå†</p> <h3 id="renderé˜¶æ®µ"><a href="#renderé˜¶æ®µ" class="header-anchor">#</a> Renderé˜¶æ®µ</h3> <p><strong>enqueueSetState</strong></p> <p>ä»¥ç±»ç»„ä»¶ä¸ºä¾‹ï¼ŒReactDOMä¸­çš„updaterå¯¹è±¡æ˜¯ä¸€ä¸ªclassComponentUpdaterï¼Œç”¨äºè·å–fiberå®ä¾‹ã€updateé˜Ÿåˆ—å’Œè°ƒåº¦ work</p> <p>fiber.updateQueueæ˜¯ä¸€ä¸ªå…·æœ‰updatesä¼˜å…ˆçº§çš„é“¾è¡¨ï¼ˆUpdateQueue is a linked list of prioritized updatesï¼‰</p> <p>è·ŸFiberä¸€æ ·ï¼Œupdate é˜Ÿåˆ—ä¹Ÿæ˜¯æˆå¯¹å‡ºç°ï¼šä¸€ä¸ªä»£è¡¨å±å¹•å¯è§çŠ¶æ€çš„ current é˜Ÿåˆ—ï¼Œä¸€ä¸ªåœ¨commité˜¶æ®µä¹‹å‰å¯è¢«å¼‚æ­¥è®¡ç®—å’Œå¤„ç†çš„work-in-progress é˜Ÿåˆ—ã€‚å¦‚æœä¸€ä¸ªwork-in-progressé˜Ÿåˆ—åœ¨å®Œæˆä¹‹å‰è¢«ä¸¢å¼ƒï¼Œåˆ™å°†ä¼šé€šè¿‡å…‹éš†ä¸€ä¸ªcurenté˜Ÿåˆ—æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„work-in-progressé˜Ÿåˆ—ã€‚</p> <p>å‡½æ•°è°ƒç”¨æ ˆï¼šperformUnitOfWork --&gt; beginWork --&gt; updateClassComponent --&gt; finishedComponent --&gt; completeUnitOfWork</p> <p><strong>completeUnitOfWork</strong></p> <p>Reactåœ¨completeUnitOfWorkå‡½æ•°ä¸­æ„å»ºeffect-list</p> <p>æ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ä¸€éƒ¨åˆ†ï¼Œè·å–workInProgress.alternateã€çˆ¶èŠ‚ç‚¹workInProgress.returnå’ŒworkInProgress.siblingï¼Œå¦‚æœå­˜åœ¨å…„å¼ŸèŠ‚ç‚¹åˆ™è¿”å›ã€‚å¦åˆ™ï¼Œè¿”å›çˆ¶èŠ‚ç‚¹ã€‚</p> <h3 id="commité˜¶æ®µ"><a href="#commité˜¶æ®µ" class="header-anchor">#</a> Commité˜¶æ®µ</h3> <p>ç±»ä¼¼äº<code>Git</code>çš„åˆ†æ”¯åŠŸèƒ½ï¼Œä»æ—§æ ‘é‡Œé¢forkä¸€ä»½ï¼Œåœ¨æ–°åˆ†æ”¯ä¸­è¿›è¡Œ<strong>æ·»åŠ ã€åˆ é™¤ã€æ›´æ–°</strong>æ“ä½œï¼Œç„¶åå†è¿›è¡Œæäº¤ã€‚</p> <p>fiberå¤§é‡ä½¿ç”¨é“¾è¡¨ã€‚ç”±äºæ•°ç»„çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œä»æ•°ç»„çš„èµ·ç‚¹æˆ–è€…ä¸­é—´æ’å…¥æˆ–ç§»é™¤é¡¹çš„æˆæœ¬å¾ˆé«˜ã€‚é“¾è¡¨ç›¸å¯¹äºä¼ ç»Ÿçš„æ•°ç»„çš„ä¼˜åŠ¿åœ¨äºæ·»åŠ æˆ–ç§»é™¤å…ƒç´ çš„æ—¶å€™ä¸éœ€è¦ç§»åŠ¨å…¶ä»–å…ƒç´ ï¼Œ<strong>éœ€è¦æ·»åŠ å’Œç§»é™¤å¾ˆå¤šå…ƒç´ æ—¶ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯é“¾è¡¨ï¼Œè€Œéæ•°ç»„ã€‚</strong> é“¾è¡¨åœ¨Reactçš„Fiberæ¶æ„å’ŒHookså®ç°å‘æŒ¥å¾ˆå¤§çš„ä½œç”¨ã€‚</p> <p>commité˜¶æ®µè¢«åˆ†ä¸ºå‡ ä¸ªå­é˜¶æ®µã€‚æ¯ä¸ªå­é˜¶æ®µéƒ½å•ç‹¬è¿›è¡Œeffect listä¼ é€’ã€‚æ‰€æœ‰çš„mutation effectséƒ½ä¼šåœ¨æ‰€æœ‰çš„layout effectsä¹‹å‰æ‰§è¡Œã€‚</p> <p>è¢«åˆ†ä¸ºå¦‚ä¸‹ä¸‰ä¸ªå­é˜¶æ®µï¼š</p> <ul><li>before mutationï¼šReactä½¿ç”¨æ­¤é˜¶æ®µè¯»å– host treeçš„stateçŠ¶æ€ã€‚ è¿™æ˜¯è°ƒç”¨getSnapshotBeforeUpdateç”Ÿå‘½å‘¨æœŸçš„åœ°æ–¹ã€‚</li> <li>mutation phaseï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼ŒReact ä¼šæ”¹å˜host treeã€‚ å½“è¯¥é˜¶æ®µæ‰§è¡Œç»“æŸæ—¶ï¼Œwork-in-progressæ ‘ä¼šå˜æˆcurrentæ ‘ï¼Œè¿™å¿…é¡»å‘ç”Ÿåœ¨â€œmutation phaseâ€é˜¶æ®µä¹‹åï¼Œä»¥ä¾¿äºåœ¨componentWillUnmountç”Ÿå‘½å‘¨æœŸå†…ï¼Œä»ç„¶æ˜¯ä¹‹å‰çš„currentæ ‘ã€‚ä½†æ˜¯ï¼Œä¹Ÿè¦å‘ç”Ÿåœ¨â€œlayout phaseâ€é˜¶æ®µä¹‹å‰ï¼Œä»¥ä¾¿äºåœ¨componentDidMount / Updateç”Ÿå‘½å‘¨æœŸé—´ï¼Œcurrentæ ‘æ˜¯å·²å®Œæˆçš„workæ“ä½œçš„ã€‚</li> <li>layout phaseï¼šåœ¨è¿™ä¸ªé˜¶æ®µhost treeå·²ç»è¢«æ›´æ”¹å¹¶è°ƒç”¨ effectsã€‚componentDidMount / Updateç­‰ç”Ÿå‘½å‘¨æœŸåœ¨è¿™ä¸ªé˜¶æ®µè¢«æ‰§è¡Œã€‚</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/tech/react/react.html" class="prev">
        React
      </a></span> <span class="next"><a href="/tech/react/react3.html">
        Reactï¼ˆä¸‰ï¼‰
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.528f3631.js" defer></script><script src="/assets/js/2.619c82a8.js" defer></script><script src="/assets/js/20.5ccce5c5.js" defer></script>
  </body>
</html>
