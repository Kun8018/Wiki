<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NodeJs开发（一） | Kun&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="meta的描述内容">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.107701cb.js" as="script"><link rel="preload" href="/assets/js/2.619c82a8.js" as="script"><link rel="preload" href="/assets/js/14.4a9f97de.js" as="script"><link rel="prefetch" href="/assets/js/10.4c94b81d.js"><link rel="prefetch" href="/assets/js/11.f5303132.js"><link rel="prefetch" href="/assets/js/12.0450625b.js"><link rel="prefetch" href="/assets/js/13.cd86f0f8.js"><link rel="prefetch" href="/assets/js/15.dbdc93f4.js"><link rel="prefetch" href="/assets/js/16.006f93ff.js"><link rel="prefetch" href="/assets/js/17.ad3cdb92.js"><link rel="prefetch" href="/assets/js/18.1b7ef2b7.js"><link rel="prefetch" href="/assets/js/19.0a7bdbd0.js"><link rel="prefetch" href="/assets/js/20.0d56d304.js"><link rel="prefetch" href="/assets/js/21.3190efab.js"><link rel="prefetch" href="/assets/js/22.4e836b52.js"><link rel="prefetch" href="/assets/js/23.03993835.js"><link rel="prefetch" href="/assets/js/24.a01f0216.js"><link rel="prefetch" href="/assets/js/25.6781aead.js"><link rel="prefetch" href="/assets/js/26.ddf559ad.js"><link rel="prefetch" href="/assets/js/27.46e966a4.js"><link rel="prefetch" href="/assets/js/28.5c6a09d7.js"><link rel="prefetch" href="/assets/js/29.5db34a2c.js"><link rel="prefetch" href="/assets/js/3.c6ec38c3.js"><link rel="prefetch" href="/assets/js/30.9f2849c6.js"><link rel="prefetch" href="/assets/js/31.5815c55c.js"><link rel="prefetch" href="/assets/js/32.574798bd.js"><link rel="prefetch" href="/assets/js/33.0d623fd7.js"><link rel="prefetch" href="/assets/js/34.83890c8c.js"><link rel="prefetch" href="/assets/js/35.89b4b514.js"><link rel="prefetch" href="/assets/js/36.5a1b2b99.js"><link rel="prefetch" href="/assets/js/37.702be7e9.js"><link rel="prefetch" href="/assets/js/38.0063f952.js"><link rel="prefetch" href="/assets/js/39.787f0c14.js"><link rel="prefetch" href="/assets/js/4.e268862a.js"><link rel="prefetch" href="/assets/js/40.c99cd2ad.js"><link rel="prefetch" href="/assets/js/41.f5621bfc.js"><link rel="prefetch" href="/assets/js/42.c7540d40.js"><link rel="prefetch" href="/assets/js/43.4c36a635.js"><link rel="prefetch" href="/assets/js/44.b9cba9f3.js"><link rel="prefetch" href="/assets/js/45.69b2d954.js"><link rel="prefetch" href="/assets/js/46.5534b655.js"><link rel="prefetch" href="/assets/js/47.f16f43f3.js"><link rel="prefetch" href="/assets/js/48.fb20e8b3.js"><link rel="prefetch" href="/assets/js/49.0f580aeb.js"><link rel="prefetch" href="/assets/js/5.0c896d33.js"><link rel="prefetch" href="/assets/js/50.f9b08984.js"><link rel="prefetch" href="/assets/js/51.1cf6d401.js"><link rel="prefetch" href="/assets/js/52.d08beb36.js"><link rel="prefetch" href="/assets/js/53.12958900.js"><link rel="prefetch" href="/assets/js/54.5054df3f.js"><link rel="prefetch" href="/assets/js/55.b71ef02a.js"><link rel="prefetch" href="/assets/js/56.c4c0ace1.js"><link rel="prefetch" href="/assets/js/57.2353a8bb.js"><link rel="prefetch" href="/assets/js/58.30db1013.js"><link rel="prefetch" href="/assets/js/59.2b1f1022.js"><link rel="prefetch" href="/assets/js/6.2958d7f8.js"><link rel="prefetch" href="/assets/js/60.ee89bede.js"><link rel="prefetch" href="/assets/js/61.1fbe0671.js"><link rel="prefetch" href="/assets/js/62.84e1e2cf.js"><link rel="prefetch" href="/assets/js/63.2e3baa5f.js"><link rel="prefetch" href="/assets/js/64.56588b49.js"><link rel="prefetch" href="/assets/js/65.69bba41a.js"><link rel="prefetch" href="/assets/js/66.f7708893.js"><link rel="prefetch" href="/assets/js/67.a93cc627.js"><link rel="prefetch" href="/assets/js/68.bbe764d2.js"><link rel="prefetch" href="/assets/js/69.7d632097.js"><link rel="prefetch" href="/assets/js/7.4f3f4813.js"><link rel="prefetch" href="/assets/js/70.9fbcc14a.js"><link rel="prefetch" href="/assets/js/71.e4b8c89d.js"><link rel="prefetch" href="/assets/js/72.b7d8c12a.js"><link rel="prefetch" href="/assets/js/73.d033e936.js"><link rel="prefetch" href="/assets/js/74.6b83aade.js"><link rel="prefetch" href="/assets/js/8.af6b4dfd.js"><link rel="prefetch" href="/assets/js/9.0ac2d280.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kun's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  科研
</a></div><div class="nav-item"><a href="/shoot/" class="nav-link">
  摄影
</a></div><div class="nav-item"><a href="https://www.github.com/kun8018" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  科研
</a></div><div class="nav-item"><a href="/shoot/" class="nav-link">
  摄影
</a></div><div class="nav-item"><a href="https://www.github.com/kun8018" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Tech</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/" aria-current="page" class="sidebar-link">Blogging Like a Hacker</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Javascript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/Javascript/Node.html" class="sidebar-link">Javascript开发（一）</a></li><li><a href="/tech/Javascript/Node10.html" class="sidebar-link">NodeJs开发（五）</a></li><li><a href="/tech/Javascript/Node2.html" class="sidebar-link">Javascript开发（二）</a></li><li><a href="/tech/Javascript/Node3.html" class="sidebar-link">Javascript开发（三）</a></li><li><a href="/tech/Javascript/Node4.html" class="sidebar-link">Javascript开发（四）</a></li><li><a href="/tech/Javascript/Node5.html" class="sidebar-link">JavaScript开发（五）</a></li><li><a href="/tech/Javascript/Node6.html" aria-current="page" class="active sidebar-link">NodeJs开发（一）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#初始化node文件夹" class="sidebar-link">初始化Node文件夹</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#创建服务器与客户端" class="sidebar-link">创建服务器与客户端</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#读取文件夹、文件" class="sidebar-link">读取文件夹、文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#stream" class="sidebar-link">Stream</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#buffer" class="sidebar-link">Buffer</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#os操作" class="sidebar-link">OS操作</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#路径操作" class="sidebar-link">路径操作</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#核心工具函数" class="sidebar-link">核心工具函数</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#node模块化加载方法" class="sidebar-link">Node模块化加载方法</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#node全局变量" class="sidebar-link">Node全局变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#当前目录与当前文件" class="sidebar-link">当前目录与当前文件</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#定时器函数" class="sidebar-link">定时器函数</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#控制台输出函数" class="sidebar-link">控制台输出函数</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#process" class="sidebar-link">Process</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#node运行原理" class="sidebar-link">Node运行原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#运行原理" class="sidebar-link">运行原理</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#事件循环" class="sidebar-link">事件循环</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#node事件循环与浏览器事件循环的区别" class="sidebar-link">Node事件循环与浏览器事件循环的区别</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#setimmediate与settimeout" class="sidebar-link">setimmediate与settimeout</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#process-nexttick" class="sidebar-link">process.nextTick</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#eventemitter" class="sidebar-link">eventEmitter</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#多进程" class="sidebar-link">多进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#孤儿进程与僵尸进程" class="sidebar-link">孤儿进程与僵尸进程</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#多线程" class="sidebar-link">多线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#线程间通信" class="sidebar-link">线程间通信</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#node调用c-包" class="sidebar-link">Node调用C++包</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#设置npm镜像源" class="sidebar-link">设置npm镜像源</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#md5加密包" class="sidebar-link">MD5加密包</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#文件包" class="sidebar-link">文件包</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#功能模块" class="sidebar-link">功能模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#commander-js" class="sidebar-link">commander.js</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#inquire" class="sidebar-link">inquire</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#chalk" class="sidebar-link">chalk</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#process-2" class="sidebar-link">process</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#转码包" class="sidebar-link">转码包</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#graphql" class="sidebar-link">Graphql</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#剪贴板的使用" class="sidebar-link">剪贴板的使用</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#生成二维码" class="sidebar-link">生成二维码</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#判断设备信息" class="sidebar-link">判断设备信息</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#七牛云的使用" class="sidebar-link">七牛云的使用</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#发邮件" class="sidebar-link">发邮件</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#http爬虫" class="sidebar-link">http爬虫</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#node应用打包可执行文件" class="sidebar-link">node应用打包可执行文件</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#node应用部署docker" class="sidebar-link">Node应用部署Docker</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#node常见问题汇总" class="sidebar-link">Node常见问题汇总</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#npm-err-maximum-call-stack-size-exceeded" class="sidebar-link">npm ERR! Maximum call stack size exceeded</a></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#core-js" class="sidebar-link">core-js</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/Javascript/Node6.html#学习资源" class="sidebar-link">学习资源</a></li></ul></li><li><a href="/tech/Javascript/Node7.html" class="sidebar-link">NodeJs开发（二）</a></li><li><a href="/tech/Javascript/Node8.html" class="sidebar-link">NodeJs开发（三）</a></li><li><a href="/tech/Javascript/Node9.html" class="sidebar-link">NodeJs开发（四）</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>周边开发技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据库相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>服务器技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>桌面端开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>移动端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>进阶前端技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>静态语言</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>业余研究</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关于</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>科学研究</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Javascript第六篇，NodeJs第一篇，注重Node后端开发。</p> <h2 id="初始化node文件夹"><a href="#初始化node文件夹" class="header-anchor">#</a> 初始化Node文件夹</h2> <p>初始化文件夹</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>npm init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>初始化文件夹后生成pacakge.json文件</p> <p><em>nodemon</em>用来监视node.js应用程序中的任何更改并自动重启服务,非常适合用在开发环境中。</p> <p>安装nodemon</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>npm i -g nodemon
npm run serve  //运行服务器
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>package.json中dependency是全局使用的依赖</p> <p>dev_dependcy只在开发时用的依赖，打包后不会上传，使用npm install -D 安装</p> <h2 id="创建服务器与客户端"><a href="#创建服务器与客户端" class="header-anchor">#</a> 创建服务器与客户端</h2> <p>创建服务器</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发送 HTTP 头部 </span>
    <span class="token comment">// HTTP 状态值: 200 : OK</span>
    <span class="token comment">// 内容类型: text/plain</span>
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 发送响应数据 &quot;Hello World&quot;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 终端打印如下信息</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:8888/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>创建客户端</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// 用于请求的选项</span>
<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
   host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
   port<span class="token operator">:</span> <span class="token string">'8080'</span><span class="token punctuation">,</span>
   path<span class="token operator">:</span> <span class="token string">'/index.html'</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token comment">// 处理响应的回调函数</span>
<span class="token keyword">var</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">// 不断更新数据</span>
   <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
   response<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      body <span class="token operator">+=</span> data<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   response<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 数据接收完成</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 向服务端发送请求</span>
<span class="token keyword">var</span> req <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>服务端处理get、post请求</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>服务端安全退出：</p> <p>api: Server.close()</p> <h2 id="读取文件夹、文件"><a href="#读取文件夹、文件" class="header-anchor">#</a> 读取文件夹、文件</h2> <p>Node由fs模块提供读写文件服务。基本上是POSIX文件操作命令的简单包装</p> <p>基本上所有的与文件相关的操作都与fs核心模块有关</p> <p>导入fs模块</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>fs模块常用的方法：读文件、写文件、追加写入文件、文件拷贝、创建目录</p> <p>读写文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//读、写文件</span>
<span class="token keyword">var</span> readme <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;readme.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//同步读文件</span>

<span class="token keyword">var</span> readme <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;readme.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;utf8&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;writeme.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;readme&quot;</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'writeme.txt'</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>追加写入文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>拷贝文件、删除文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>
fs<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;3.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;4.txt&quot;</span><span class="token punctuation">)</span>  <span class="token comment">//同步拷贝</span>
<span class="token comment">//异步拷贝，带回调函数</span>
fs<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span><span class="token string">&quot;3.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;4.txt&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//删除文件</span>
fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">'input.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>创建目录</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//创建、读取、移除目录</span>
fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>识别文件、目录类型</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//识别文件、目录类型</span>
fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
stats<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="stream"><a href="#stream" class="header-anchor">#</a> Stream</h3> <p>stream（流）是一种抽象的数据结构。流可以把文件资源拆分成小块，一块一块的运输，资源就像水流一样进行传输，减轻服务器压力。</p> <p>stream可以分为四类：</p> <p>可读 Readable，有两个状态：paused、flowing。</p> <p>可写 Writable，两个重要事件：drain、finish。</p> <p>可读可写（双向）Duplex</p> <p>可读可写（变化）Transform</p> <p>可读流有两个状态 paused 和 flowing。</p> <p>可读流默认处于 paused 态，一旦添加 data 事件监听，它就变为 flowing 态。删掉 data 事件监听，paused 态。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 默认处于 paused 态</span>
<span class="token keyword">const</span> stream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./big_file.txt'</span><span class="token punctuation">)</span>
stream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
stream<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂停</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 恢复</span>
  stream<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>用管道pipe连接两个不同的流，管道可以分为两个事件，监听data，stream1一有数据就传给stream2，监听 end 事件，当 stream1 停了，就停掉 stream2</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>stream1<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	stream2<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

stream1<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	stream2<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>https://juejin.im/post/5f1c508ff265da22ff546dca#heading-25</p> <h3 id="buffer"><a href="#buffer" class="header-anchor">#</a> Buffer</h3> <p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。</p> <p>但在处理像TCP流或文件流时，必须使用到二进制数据。因此在 Node.js中，定义了一个 Buffer 类，该类用来创建一个专门存放二进制数据的缓存区。</p> <p>在 Node.js 中，Buffer 类是随 Node 内核一起发布的核心库。Buffer 库为 Node.js 带来了一种存储原始数据的方法，可以让 Node.js 处理二进制数据，每当需要在 Node.js 中处理I/O操作中移动的数据时，就有可能使用 Buffer 库。原始数据存储在 Buffer 类的实例中。一个 Buffer 类似于一个整数数组，但它对应于 V8 堆内存之外的一块原始内存。</p> <p>https://juejin.im/post/6845166891401478158</p> <h2 id="os操作"><a href="#os操作" class="header-anchor">#</a> OS操作</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>os<span class="token punctuation">.</span><span class="token function">tmpdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回操作系统的默认临时文件夹</span>
os<span class="token punctuation">.</span><span class="token function">hostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回操作系统的主机名</span>
os<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回操作系统的发行版本,字符串</span>
os<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回操作系统名，</span>
os<span class="token punctuation">.</span><span class="token function">uptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回上次重新启动之后操作系统的运行时间，单位为秒</span>
os<span class="token punctuation">.</span><span class="token function">totalmem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回系统总内存量，单位字节</span>
os<span class="token punctuation">.</span><span class="token function">freemem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回系统空闲内存量，单位字节</span>
os<span class="token punctuation">.</span><span class="token function">arch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回操作系统的CPU架构</span>
os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回数组对象，包含每个CPU的信息</span>
os<span class="token punctuation">.</span><span class="token function">networkInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//返回系统上可用的网络接口的详细信息</span>
os<span class="token punctuation">.</span><span class="token function">userInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//返回包含当前username、uid、gid、shell和homedir的对象</span>
os<span class="token punctuation">.</span><span class="token function">platform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//返回Nodejs的编译平台，如darwin、freebsd、linux、openbsd、win32等</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="路径操作"><a href="#路径操作" class="header-anchor">#</a> 路径操作</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//获取文件夹路径</span>
path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token comment">//获取文件名</span>
path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token punctuation">,</span> ext<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">//获取文件后缀名</span>
path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token comment">//将路径转化为数组</span>
path<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
<span class="token comment">//绝对路径相对路径转化</span>
path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">from</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token comment">//转化为绝对路径</span>
path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token comment">//转化为相对路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="核心工具函数"><a href="#核心工具函数" class="header-anchor">#</a> 核心工具函数</h2> <p>util 是一个Node.js 核心模块，提供常用函数的集合，用于弥补核心 JavaScript 的功能 过于精简的不足。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>util.inherits(constructor, superConstructor)</strong> 是一个实现对象间原型继承的函数。JavaScript 的面向对象特性是基于原型的，与常见的基于类的不同。JavaScript 没有提供对象继承的语言级别特性，而是通过原型复制来实现的。</p> <p><strong>util.inspect(object,[showHidden],[depth],[colors])</strong> 是一个将任意对象转换 为字符串的方法，通常用于调试和错误输出。它至少接受一个参数 object，即要转换的对象。</p> <p>util.isArray(object)判断给定的参数 &quot;object&quot; 是一个数组则返回 true，否则返回 false。</p> <p>util.isRegExp(object)判断给定的参数 &quot;object&quot; 是一个正则表达式返回true，否则返回false。</p> <p>util.isDate(object)判断给定的参数 &quot;object&quot; 是一个data对象则返回true，否则返回false。</p> <h2 id="node模块化加载方法"><a href="#node模块化加载方法" class="header-anchor">#</a> Node模块化加载方法</h2> <p>JavaScript 现在有两种模块。一种是 ES6 模块，简称 ESM；另一种是 CommonJS 模块，简称 CJS。</p> <p>CommonJS 模块是 Node.js 专用的，与 ES6 模块不兼容。它们采用不同的加载方案。从 Node.js v13.2 版本开始，Node.js 已经默认打开了 ES6 模块支持。</p> <p>Node.js 要求 ES6 模块采用<code>.mjs</code>后缀文件名。也就是说，只要脚本文件里面使用<code>import</code>或者<code>export</code>命令，那么就必须采用<code>.mjs</code>后缀名。Node.js 遇到<code>.mjs</code>文件，就认为它是 ES6 模块，默认启用严格模式，不必在每个模块文件顶部指定<code>&quot;use strict&quot;</code>。</p> <p>如果不希望将后缀名改成<code>.mjs</code>，可以在项目的<code>package.json</code>文件中，指定<code>type</code>字段为<code>module</code>。</p> <p>ES6 模块与 CommonJS 模块尽量不要混用。<code>require</code>命令不能加载<code>.mjs</code>文件，会报错，只有<code>import</code>命令才可以加载<code>.mjs</code>文件。反过来，<code>.mjs</code>文件里面也不能使用<code>require</code>命令，必须使用<code>import</code>。</p> <p><code>package.json</code>文件有两个字段可以指定模块的入口文件：<code>main</code>和<code>exports</code>。比较简单的模块，可以只使用<code>main</code>字段，指定模块加载的入口文件。</p> <h2 id="node全局变量"><a href="#node全局变量" class="header-anchor">#</a> Node全局变量</h2> <p>node程序内部自带一些变量和函数，可以在node程序全局使用</p> <h3 id="当前目录与当前文件"><a href="#当前目录与当前文件" class="header-anchor">#</a> 当前目录与当前文件</h3> <div class="language-node line-numbers-mode"><pre class="language-text"><code>_filename//输出当前脚本文件的绝对路径
_dirname//输出当前脚本文件的目录
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="定时器函数"><a href="#定时器函数" class="header-anchor">#</a> 定时器函数</h3> <div class="language-node line-numbers-mode"><pre class="language-text"><code>var t= setTimeout(cb, ms);//设定ms后执行函数cb
clearTimeout(t)
setInterval(cb, ms)//每个ms后执行函数cb
clearTimeout(t)//停止一个之前创建的定时器
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Node独有的定时器函数：</p> <p>setImmediate/clearImmediate</p> <h3 id="控制台输出函数"><a href="#控制台输出函数" class="header-anchor">#</a> 控制台输出函数</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span>log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="process"><a href="#process" class="header-anchor">#</a> Process</h3> <p><code>process</code>对象是 Node 的一个全局对象，提供当前 Node 进程的信息。它可以在脚本的任意位置使用，不必通过<code>require</code>命令加载。该对象部署了<code>EventEmitter</code>接口。</p> <p>基本属性：</p> <ul><li><code>process.argv</code>：返回一个数组，成员是当前进程的所有命令行参数。一般第一个参数是node路径，第二个参数是文件路径，第三个参数</li> <li><code>process.env</code>：返回一个对象，成员为当前Shell的环境变量，比如<code>process.env.HOME</code>。</li> <li><code>process.installPrefix</code>：返回一个字符串，表示 Node 安装路径的前缀，比如<code>/usr/local</code>。相应地，Node 的执行文件目录为<code>/usr/local/bin/node</code>。</li> <li><code>process.pid</code>：返回一个数字，表示当前进程的进程号。</li> <li><code>process.platform</code>：返回一个字符串，表示当前的操作系统，比如<code>Linux</code>。</li> <li><code>process.title</code>：返回一个字符串，默认值为<code>node</code>，可以自定义该值。</li> <li><code>process.version</code>：返回一个字符串，表示当前使用的 Node 版本，比如<code>v7.10.0</code>。</li></ul> <p>针对shell的属性：</p> <p><code>process.env</code>属性返回一个对象，包含了当前Shell的所有环境变量。比如，<code>process.env.HOME</code>返回用户的主目录。</p> <p>通常的做法是，新建一个环境变量<code>NODE_ENV</code>，用它确定当前所处的开发阶段，生产阶段设为<code>production</code>，开发阶段设为<code>develop</code>或<code>staging</code>，然后在脚本中读取<code>process.env.NODE_ENV</code>即可。</p> <p>方法：</p> <ul><li><code>process.chdir()</code>：切换工作目录到指定目录。</li> <li><code>process.cwd()</code>：返回运行当前脚本的工作目录的路径。<code>process.cwd()</code>与<code>__dirname</code>的区别。前者进程发起时的位置，后者是脚本的位置，两者可能是不一致的。</li> <li><code>process.exit()</code>：退出当前进程。</li> <li><code>process.getgid()</code>：返回当前进程的组ID（数值）。</li> <li><code>process.getuid()</code>：返回当前进程的用户ID（数值）。</li> <li><code>process.nextTick()</code>：指定回调函数在当前执行栈的尾部、下一次Event Loop之前执行。</li> <li><code>process.on()</code>：监听事件。</li> <li><code>process.setgid()</code>：指定当前进程的组，可以使用数字ID，也可以使用字符串ID。</li> <li><code>process.setuid()</code>：指定当前进程的用户，可以使用数字ID，也可以使用字符串ID。</li></ul> <h2 id="node运行原理"><a href="#node运行原理" class="header-anchor">#</a> Node运行原理</h2> <h3 id="运行原理"><a href="#运行原理" class="header-anchor">#</a> 运行原理</h3> <p>Node.js 被分为了四层，分别是 <code>应用层</code>、<code>V8引擎层</code>、<code>Node API层</code> 和 <code>LIBUV层</code>。</p> <p>应用层： 即 JavaScript 交互层，常见的就是 Node.js 的模块，比如 http，fs</p> <p>V8引擎层： 即利用 V8 引擎来解析JavaScript 语法，进而和下层 API 交互</p> <p>NodeAPI层： 为上层模块提供系统调用，一般是由 C 语言来实现，和操作系统进行交互 。</p> <p>LIBUV层： 是跨平台的底层封装，实现了 事件循环、文件操作等，是 Node.js 实现异步的核心</p> <h3 id="事件循环"><a href="#事件循环" class="header-anchor">#</a> 事件循环</h3> <p>node事件循环与浏览器循环是不同的</p> <p>当Node.js启动时会初始化<code>event loop</code>, 每一个<code>event loop</code>都会包含按如下顺序六个循环阶段：</p> <p>1.<strong><code>timers</code> 阶段</strong>: 这个阶段执行 <code>setTimeout(callback)</code> 和 <code>setInterval(callback)</code> 预定的 callback, timer指定一个下限时间而不是准确时间，在达到这个下限时间后执行回调。在指定时间过后，timers会尽可能早地执行回调，但系统调度或者其它回调的执行可能会延迟它们。</p> <p>2.<strong><code>I/O callbacks</code> 阶段</strong>: 此阶段执行某些系统操作的回调，例如TCP错误的类型。 例如，如果TCP套接字在尝试连接时收到 ECONNREFUSED，则某些* nix系统希望等待报告错误。 这将操作将等待在==I/O回调阶段==执行;</p> <p>3.<strong><code>idle, prepare</code> 阶段</strong>: 仅node内部使用;</p> <p>4.<strong><code>poll</code> 阶段</strong>:</p> <p>获取新的I/O事件, 例如操作读取文件等等，适当的条件下node将阻塞在这里;</p> <p>如果 poll 队列不空，event loop会遍历队列并同步执行回调，直到队列清空或执行的回调数到达系统上限；</p> <p>如果 poll 队列为空，则发生以下两件事之一：</p> <p>如果代码已经被setImmediate()设定了回调, event loop将结束 poll 阶段进入 check 阶段来执行 check 队列（里面的回调 callback）。</p> <p>如果代码没有被setImmediate()设定回调，event loop将阻塞在该阶段等待回调被加入 poll 队列，并立即执行。setImmediate() 实际上是一个特殊的timer，跑在event loop中一个独立的阶段。它使用<code>libuv</code>的API 来设定在 poll 阶段结束后立即执行回调。</p> <p>5.<strong><code>check</code> 阶段</strong>: 执行 <code>setImmediate()</code> 设定的callbacks，check阶段在poll阶段之后;</p> <p>6.<strong><code>close callbacks</code> 阶段</strong>: 比如 <code>socket.on(‘close’, callback)</code> 的callback会在这个阶段执行;如果一个 socket 或 handle 被突然关掉，close事件将在这个阶段被触发，否则将通过process.nextTick()触发</p> <p>日常开发的绝大部分异步任务都在timers、poll、check这3个阶段处理的</p> <h3 id="node事件循环与浏览器事件循环的区别"><a href="#node事件循环与浏览器事件循环的区别" class="header-anchor">#</a> Node事件循环与浏览器事件循环的区别</h3> <p>在浏览器环境中，microtask任务队列是每个macrotask执行完之后执行，而在Nodejs中microtask在事件循环的各个阶段之间执行</p> <h3 id="setimmediate与settimeout"><a href="#setimmediate与settimeout" class="header-anchor">#</a> setimmediate与settimeout</h3> <p>两者非常相似，区别在于调用时机不同：</p> <p>setimmediate设计在poll阶段完成时执行，即check阶段；</p> <p>setTimeout设计在poll阶段为空闲时，且设定事件达到后执行，但它在timer阶段执行</p> <p>但当二者在异步i/o callback内部调用时，总是先执行setimmediate，再执行setTimeout</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//setTimeout可能先执行也可能后执行</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>_filename<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//setImmediate总是先于setTimeout</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="process-nexttick"><a href="#process-nexttick" class="header-anchor">#</a> process.nextTick</h3> <p>这个函数是独立于Event Loop之外的，有自己的队列，当每个阶段完成时，如果存在nextTick队列就清空队列中的所有回调函数，并且优先于其他microtask执行</p> <h2 id="eventemitter"><a href="#eventemitter" class="header-anchor">#</a> eventEmitter</h2> <p>Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列。</p> <p>Node.js 里面的许多对象都会分发事件：一个 net.Server 对象会在每次有新连接时触发一个事件， 一个 fs.readStream 对象会在文件被打开的时候触发一个事件。 所有这些产生事件的对象都是 events.EventEmitter 的实例。</p> <p>events 模块只提供了一个对象： events.EventEmitter。EventEmitter 的核心就是事件触发与事件监听器功能的封装。</p> <p>实例</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//event.js 文件</span>
<span class="token keyword">var</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter<span class="token punctuation">;</span> 
<span class="token keyword">var</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'some_event'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'some_event 事件触发'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'some_event'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>常用场景：</p> <ol><li><p>模块间传递消息</p></li> <li><p>回调函数内外传递消息</p></li> <li><p>处理流数据，因为流是在EventEmitter基础上实现的. 4) 观察者模式发射触发机制相关应用</p></li></ol> <h2 id="多进程"><a href="#多进程" class="header-anchor">#</a> 多进程</h2> <p>child_process模块开启多个子进程来执行node文件，执行开启的进程是主进程，被开启的进程是子进程。</p> <p>child_process模块用于新建子进程。子进程的运行结果储存在系统缓存之中（最大200KB），等到子进程运行结束以后，主进程再用回调函数读取子进程的运行结果。</p> <p>node有三种创建子进程的接口，每种方法有特定的使用场景。</p> <p>exec/execFile: 用于执行bash命令，它的参数是一个命令字符串。用操作系统原生的方式执行各种命令，适用于输出轻量数据，执行的结果会存储在Buffer中，不同的是前者创建shell进行来执行命令，后者直接创建进程执行可执行文件，</p> <p>spawn:是流式和操作系统进行交互，它属于异步执行，适用于子进程长时间运行的情况，适用于进程输入、输出数据量比较大的情况，支持stream的形式输入输出，可以用于任何命令，可以创建常驻后台进程。</p> <p>fork: fork是spawn的特例，fork是两个node程序(javascript)之间时行交互，fork会在父子进程之间创建IPC通道，通过监听message事件和调用send方法，就可以在父子进程间通信了。</p> <p>进程通信</p> <p>使用 child_process.fork() 生成新进程之后，就可以用 child.send(message, [sendHandle]) 向新进程发送消息。新进程中通过监听message事件，来获取消息。</p> <p>Node.js默认单进程运行，对于32位系统最高可以使用512MB内存，对于64位最高可以使用1GB内存。对于多核CPU的计算机来说，这样做效率很低，因为只有一个核在运行，其他核都在闲置。Node中提供了cluster模块，cluster实现了对child_process的封装，通过fork方法创建子进程的方式实现多进程模型。通过该模块简化多进程服务器程序的开发，统一通过主进程监听接口和分发请求。</p> <p>cluster模块允许设立一个主进程和若干个worker进程，由主进程监控和协调worker进程的运行。worker之间采用进程间通信交换消息，cluster模块内置一个负载均衡器，采用Round-robin算法协调各个worker进程之间的负载。运行时，所有新建立的链接都由主进程完成，然后主进程再把TCP连接分配给指定的worker进程。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//导入cluster</span>
<span class="token keyword">var</span> cluster <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cluster'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//判断是否是主进程，是主进程就按cpu数新建若干worker进程，是worker进程就在该进程启动一个服务器程序</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>cluster<span class="token punctuation">.</span>isMaster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> numWorkers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Master cluster setting up '</span> <span class="token operator">+</span> numWorkers <span class="token operator">+</span> <span class="token string">' workers...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numWorkers<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cluster<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//监听子进程状态，主进程一旦监听到worker进程的exit事件，就会重启一个worker进程。worker进程一旦启动成功，可以正常运行了，就会发出online事件。</span>
  cluster<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">worker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Worker '</span> <span class="token operator">+</span> worker<span class="token punctuation">.</span>process<span class="token punctuation">.</span>pid <span class="token operator">+</span> <span class="token string">' is online'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  cluster<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">worker<span class="token punctuation">,</span> code<span class="token punctuation">,</span> signal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Worker '</span> <span class="token operator">+</span> worker<span class="token punctuation">.</span>process<span class="token punctuation">.</span>pid <span class="token operator">+</span> <span class="token string">' died with code: '</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">', and signal: '</span> <span class="token operator">+</span> signal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Starting a new worker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cluster<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;hello world\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>cluster代表整个集群，也就是工作进程和主进程，随着当前执行进程的变化，cluster的属性也在变化。在cluster上绑定的事件对每个进程都起作用，cluster的某些api只对主进程起作用，如fork、cluster.workers，有一些只对工作进程有用，如cluter.worker</p> <p>worker对象：</p> <h3 id="孤儿进程与僵尸进程"><a href="#孤儿进程与僵尸进程" class="header-anchor">#</a> 孤儿进程与僵尸进程</h3> <p>孤儿进程是指父进程先退出，子进程由 pid 为 1 的 init 进程托管。</p> <p>僵尸进程是指子进程先退出，但是父进程没有获取子进程的状态信息，导致子进程的进程描述符仍然保存在系统中。僵尸进程是有危害的，处理方法是退出主进程，init 进程会以父进程的身份对僵尸进程状态进行处理。</p> <p>守护进程是在「后台运行」不受「终端控制」的进程（如输入、输出等）。在 nodejs 中，开启守护进程需要满足三个条件：</p> <ul><li>使子进程成为进程组的头</li> <li>中断父子进程的 i/o</li> <li>去除父进程的事件循环中对子进程的引用</li></ul> <h2 id="多线程"><a href="#多线程" class="header-anchor">#</a> 多线程</h2> <p>通常node的单线程是由于JavaScript的执行默认是单线程的，但是JavaScript的宿主环境，无论是node还是浏览器都是多线程的</p> <p>node的单线程带来了一些问题，比如对cpu 的利用不足，某个未捕获的异常可能会导致整个程序的退出等。node的事件驱动和无阻塞特性使得在I/O密集型的业务场景（如限时抢购）等体现出巨大的优势。但是遇到加密、解密等CPU密集型复杂运算。当一个CPU占用率高的任务执行迟迟未完成时，后续队列中的延时、监听回调、nextTick等函数都会因被阻塞而无法执行，造成严重的延迟。更严重的情况。如果某个请求抛出错误，将有可能导致整个服务瘫痪。</p> <p>nodejs中有三种线程</p> <p>event loop的主线程</p> <p>libuv的异步I/O线程池</p> <p>Node10.5之后，Node提供了worker_threads给node提供了真正的多线程</p> <p>worker_thread模块中有四个对象两个类</p> <p>isMainThread:是否是主线程</p> <p>MessagePort:用于线程间的通信，继承自EventEmitter</p> <p>MessageChannel:用于创建异步、双向通信的通道实例</p> <p>threadId:线程ID</p> <p>Worker：用于在主线程中创建子线程，第一个参数为filename，表示子线程的执行入口</p> <p>parentPort:在worker线程中表示父进程的MessagePort类型的对象，在主线程中为null</p> <p>workData:用于在主进程中向子进程传递数据</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
    Worker<span class="token punctuation">,</span>
    MessageChannel<span class="token punctuation">,</span>
    MessagePort<span class="token punctuation">,</span>
    isMainThread<span class="token punctuation">,</span>
    parentPort
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'worker_threads'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>isMainThread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Workd</span><span class="token punctuation">(</span>_filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> subChannel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>hereIsYourPort<span class="token operator">:</span>subChannel<span class="token punctuation">.</span>port1<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>subChannel<span class="token punctuation">.</span>port1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subChannel<span class="token punctuation">.</span>port2<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'received:'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    subChannel<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">assert</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>hereIsYourPort <span class="token keyword">instanceof</span> <span class="token class-name">MessagePort</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        value<span class="token punctuation">.</span>hereIsYourPort<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'the worker is sending this'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        value<span class="token punctuation">.</span>hereIsYourPort<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="线程间通信"><a href="#线程间通信" class="header-anchor">#</a> 线程间通信</h3> <p>worker_thread线程之间可以共享内存。使用ArrayBuffer或SharedArrayBuffer</p> <p><strong>parentPort</strong></p> <p>主要用于主子线程通信，通过经典的 on('message'), postMessage形式</p> <p><strong>MessageChannel</strong></p> <p>可以通过线程间的消息传递来实现双向通信。 在内部，一个 Worker 具有一对内置的 MessagePort，在创建该 Worker 时它们已经相互关联。 虽然父端的 MessagePort 对象没有直接公开，但其功能是通过父线程的 Worker 对象上的 worker.postMessage() 和 worker.on('message') 事件公开的。
要创建自定义的消息传递通道（建议使用默认的全局通道，因为这样可以促进关联点的分离），用户可以在任一线程上创建一个 MessageChannel 对象，并将该 MessageChannel 上的 MessagePort 中的一个通过预先存在的通道传给另一个线程，</p> <p>https://www.cnblogs.com/mengff/p/12815198.html</p> <h2 id="node调用c-包"><a href="#node调用c-包" class="header-anchor">#</a> Node调用C++包</h2> <p><code>node-ffi</code>提供了一组强大的工具，用于在<code>Node.js</code>环境中使用纯<code>JavaScript</code>调用动态链接库接口。它可以用来为库构建接口绑定，而不需要使用任何<code>C++</code>代码。</p> <p><code>node-ffi</code>并不能直接调用<code>C++</code>代码，你需要将<code>C++</code>代码编译为动态链接库：在 <code>Windows</code>下是 <code>Dll</code> ，在 <code>Mac OS</code>下是 <code>dylib</code> <code>，Linux</code> 是 <code>so</code> 。</p> <p><code>node-ffi</code> 加载 <code>Library</code>是有限制的，只能处理 <code>C</code>风格的 <code>Library</code>。</p> <p>编辑tsconfig.json</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ts由于有较严的格式规范，往往会报一些不必要的格式警告，干扰编译</p> <p>解决方法：</p> <p>在vscode中下载插件prettier，然后在代码中全选，右键菜单选择格式化文档即可</p> <h2 id="设置npm镜像源"><a href="#设置npm镜像源" class="header-anchor">#</a> 设置npm镜像源</h2> <p></p> <div class="language-Node line-numbers-mode"><pre class="language-text"><code>npm config get registry  // 查看npm当前镜像源

https://registry.npm.taobao.org/  // 设置npm镜像源为淘宝镜像

yarn config get registry  // 查看yarn当前镜像源

https://registry.npm.taobao.org/  // 设置yarn镜像源为淘宝镜像
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>新建npmrc文件</p> <p>在npmrc文件中粘贴npm地址</p> <h2 id="md5加密包"><a href="#md5加密包" class="header-anchor">#</a> MD5加密包</h2> <p>Js-md5</p> <h2 id="文件包"><a href="#文件包" class="header-anchor">#</a> 文件包</h2> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> fs-extra
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>文件包可以替代原生的node fs模块，实现更强大的文件处理功能。</p> <p>导入</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>异步拷贝文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Async with promises:</span>
fs<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token string">'/tmp/myfile'</span><span class="token punctuation">,</span> <span class="token string">'/tmp/mynewfile'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Sync:</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">copySync</span><span class="token punctuation">(</span><span class="token string">'/tmp/myfile'</span><span class="token punctuation">,</span> <span class="token string">'/tmp/mynewfile'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="功能模块"><a href="#功能模块" class="header-anchor">#</a> 功能模块</h2> <h3 id="commander-js"><a href="#commander-js" class="header-anchor">#</a> commander.js</h3> <p>前端开发node cli 必备技能。</p> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> commander
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>api</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
program
    <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;intl helper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">'0.0.1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">//执行结果：</span>
node index<span class="token punctuation">.</span>js <span class="token operator">-</span><span class="token constant">V</span>
 
<span class="token number">0.0</span><span class="token number">.1</span>
<span class="token comment">//如果希望程序响应-v选项而不是-V选项，</span>
<span class="token comment">//只需使用与option方法相同的语法将自定义标志传递给version方法</span>
program
  <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">'0.0.1'</span><span class="token punctuation">,</span> <span class="token string">'-v, --version'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>commander.js中命令行有两种可变性，一个叫做<code>option</code>，意为选项。一个叫做<code>command</code>，意为命令。</p> <p>常用api</p> <p><code>version</code></p> <p>用法： <code>.version('x.y.z')</code></p> <p>用于设置命令程序的版本号，</p> <p><code>option</code></p> <p>用户：<code>.option('-n, --name &lt;name&gt;', 'your name', 'GK')</code></p> <ul><li>第一个参数是选项定义，分为短定义和长定义。用|，,， 连接。
<ul><li>参数可以用<code>&lt;&gt;</code>或者<code>[]</code>修饰，前者意为必须参数，后者意为可选参数。</li></ul></li> <li>第二个参数为选项描述</li> <li>第三个参数为选项参数默认值，可选。</li></ul> <p><code>command</code></p> <p>用法：<code>.command('init &lt;path&gt;', 'description')</code></p> <ul><li><code>command</code>的用法稍微复杂，原则上他可以接受三个参数，第一个为命令定义，第二个命令描述，第三个为命令辅助修饰对象。</li> <li>第一个参数中可以使用<code>&lt;&gt;</code>或者<code>[]</code>修饰命令参数</li> <li>第二个参数可选。
<ul><li>当没有第二个参数时，commander.js将返回<code>Command</code>对象，若有第二个参数，将返回原型对象。</li> <li>当带有第二个参数，并且没有显示调用<code>action(fn)</code>时，则将会使用子命令模式。</li> <li>所谓子命令模式即，<code>./pm</code>，<code>./pm-install</code>，<code>./pm-search</code>等。这些子命令跟主命令在不同的文件中。</li></ul></li> <li>第三个参数一般不用，它可以设置是否显示的使用子命令模式。</li></ul> <p><code>description</code></p> <p>用法：<code>.description('command description')</code></p> <p>用于设置命令的描述</p> <p>用法：<code>.action(fn)</code></p> <p>用于设置命令执行的相关回调。<code>fn</code>可以接受命令的参数为函数形参，顺序与<code>command()</code>中定义的顺序一致。</p> <p><code>parse</code></p> <p>用法：<code>program.parse(process.argv)</code></p> <p>此api一般是最后调用，用于解析<code>process.argv</code>。</p> <p><code>outputHelp</code></p> <p>用法：<code>program.outputHelp()</code></p> <p>一般用于未录入参数时自动打印帮助信息。</p> <h3 id="inquire"><a href="#inquire" class="header-anchor">#</a> inquire</h3> <p><code>Inquirer.js</code>可以理解成就是给输入命令行的用户提供一个好看的界面，提供一下功能：</p> <ul><li>有错误反馈；</li> <li>向用户提问；</li> <li>解析输入；</li> <li>校验回答；</li> <li>能在用户输入的时候提供友好的提示。</li></ul> <p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> inquirer --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Inquirer 提供<code>prompt</code>对象，该对象中提供配置项，<code>then</code>会在用户回答完所有问题后执行，<code>catch</code>则是报出异常：</p> <p>prompt是一个对象数组，对象主要包含以下几种配置：</p> <p>type： 类型，主要类型有input、number、confirm、list、rawlist、expand、checkbox、password、editor；</p> <p>name：可以理解成当前回答的变量名；</p> <p>message：问题描述；</p> <p>default：问题的默认值；</p> <p>choice：问题选项；</p> <p>validate：回答的校验器；</p> <p>filter：回答的过滤器；</p> <p>transformer：接收用户输入，回答散列和选项标志，并返回一个转换后的值显示给用户。</p> <p>when：是否应该问这个问题</p> <p>PageSize：控制选项显示的个数，就是是否当前最多显示多少个选项，如果超过则需要向下才能显示更多；</p> <p>prefix：更改默认的前缀消息。</p> <p>suffix：更改默认后缀消息。</p> <p>askAnswered：如果答案已经存在，就必须提出问题。</p> <p>loop：是否启用列表循环。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'preset'</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">'Please pick a preset:'</span><span class="token punctuation">,</span>
    choices<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'default(babel, eslint)'</span><span class="token punctuation">,</span> <span class="token string">'Manually select feature'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function-variable function">filter</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'key'</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">&quot;input the text key:&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'features'</span><span class="token punctuation">,</span>
  message<span class="token operator">:</span> <span class="token string">'Checkout the feature needed for you project:'</span><span class="token punctuation">,</span>
  choices<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Babel'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'TypeScript'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Progressive Web App (PWA) Support'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Router'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Vuex'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'CSS Pre-processors'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Linter / Formatter'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Unit Testing'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'E2E Testing'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  pageSize<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
  <span class="token function-variable function">validate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>answer<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'You must choose at least one topping.'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>answers<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'  '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="chalk"><a href="#chalk" class="header-anchor">#</a> chalk</h3> <p><code>chalk</code> 包的作用是修改控制台中字符串的样式，包括：</p> <ol><li>字体样式(加粗、隐藏等)</li> <li>字体颜色</li> <li>背景颜色</li></ol> <p>使用</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span>red<span class="token punctuation">.</span>bold<span class="token punctuation">.</span><span class="token function">bgWhite</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="process-2"><a href="#process-2" class="header-anchor">#</a> process</h3> <p><a href="https://www.npmjs.com/package/progress" target="_blank" rel="noopener noreferrer">progress <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是现在最常用的 <code>npm</code> 包用来渲染进度条。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> --save progress
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> ProgressBar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgressBar</span><span class="token punctuation">(</span><span class="token string">':bar'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> total<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  bar<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>bar<span class="token punctuation">.</span>complete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\ncomplete\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="转码包"><a href="#转码包" class="header-anchor">#</a> 转码包</h3> <p>node默认支持utf8、base64、binary，如果要请求或处理GBK或者Gb2312页面或文件就需要转码</p> <p>安装iconv-lite</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> iconv-lite --save 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>引入</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> iconv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'iconv-lite'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在原来的输出语句中加入解码函数就可以</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stdout'</span><span class="token operator">+</span>iconv<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">'GBK'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="graphql"><a href="#graphql" class="header-anchor">#</a> Graphql</h3> <p>安装依赖</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install apollo<span class="token operator">-</span>server@<span class="token number">2.13</span><span class="token number">.1</span> graphql@<span class="token number">14.6</span><span class="token number">.0</span>  type<span class="token operator">-</span>graphql@<span class="token number">0.17</span><span class="token number">.6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>引入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;reflect-metadata&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>buildSchema<span class="token punctuation">,</span>ObjectType<span class="token punctuation">,</span>Field<span class="token punctuation">,</span><span class="token constant">ID</span><span class="token punctuation">,</span>Resolver<span class="token punctuation">,</span>Query<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;type-graphql&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ApolloServer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;apollo-server&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>后端定义schema和resolver</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>@<span class="token function">ObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Post</span><span class="token punctuation">{</span>
    @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token constant">ID</span><span class="token punctuation">)</span>
    id<span class="token operator">:</span> string<span class="token punctuation">;</span>

    @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    created<span class="token operator">:</span> Data<span class="token punctuation">;</span>

    @<span class="token function">Field</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    content<span class="token operator">:</span> String<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@<span class="token function">Resolver</span><span class="token punctuation">(</span>Post<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">PostResolver</span> <span class="token punctuation">{</span>
    @<span class="token function">Query</span><span class="token punctuation">(</span><span class="token parameter">returns</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>Post<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>Post<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
           <span class="token punctuation">{</span>
              id<span class="token operator">:</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
              created<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              content<span class="token operator">:</span><span class="token string">'aaa'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              id<span class="token operator">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
              created<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              content<span class="token operator">:</span><span class="token string">'bbb'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              id<span class="token operator">:</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
              created<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              content<span class="token operator">:</span><span class="token string">'ccc'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>运行项目，在localhost:4444打开graphql的playground进行测试</p> <h3 id="剪贴板的使用"><a href="#剪贴板的使用" class="header-anchor">#</a> 剪贴板的使用</h3> <p>使用第三方包，安装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install clipboard<span class="token operator">-</span>polyfill
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>引用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> clipboard <span class="token keyword">from</span> <span class="token string">&quot;clipboard-polyfill&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>实例</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>clipboard<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span><span class="token string">&quot;this&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
clipboard<span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="生成二维码"><a href="#生成二维码" class="header-anchor">#</a> 生成二维码</h3> <h3 id="判断设备信息"><a href="#判断设备信息" class="header-anchor">#</a> 判断设备信息</h3> <p>使用navigator对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">checkdevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token punctuation">{</span>
    versions<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> u <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span>
        app <span class="token operator">=</span> navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">//移动终端浏览器版本信息</span>
        trident<span class="token operator">:</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Trident&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//IE内核</span>
        presto<span class="token operator">:</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Presto&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//opera内核</span>
        webKit<span class="token operator">:</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;AppleWebKit&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//苹果、谷歌内核</span>
        gecko<span class="token operator">:</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Gecko&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;KHTML&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//火狐内核</span>
        mobile<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>u<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">AppleWebKit.*Mobile.*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//是否为移动终端</span>
        ios<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>u<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\(i[^;]+;( U;)? CPU.+Mac OS X</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//ios终端</span>
        android<span class="token operator">:</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Android&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Linux&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//android终端或uc浏览器</span>
        iPhone<span class="token operator">:</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPhone&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//是否为iPhone或者QQHD浏览器</span>
        iPad<span class="token operator">:</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPad&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//是否iPad</span>
        webApp<span class="token operator">:</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Safari&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//是否web应该程序，没有头部与底部</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    language<span class="token operator">:</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>browserLanguage <span class="token operator">||</span> navigator<span class="token punctuation">.</span>language<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>browser<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>mobile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//判断是否是移动设备打开。browser代码在下面</span>
    <span class="token comment">// 此时为移动端打开.跳转到移动站</span>
    <span class="token comment">// if(window.location.href.indexOf(&quot;ooo0o.com/mobile&quot;) != -1){</span>
    <span class="token comment">//     return;</span>
    <span class="token comment">// }else {</span>
    <span class="token comment">//     window.location.href = &quot;https://www.ooo0o.com/mobile&quot;</span>
    <span class="token comment">// }</span>

    <span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取判断用的对象</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ua<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">MicroMessenger</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;micromessenger&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//在微信中打开</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>browser<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>ios<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;weixinios&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;weixin&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>browser<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>android<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//是否在安卓浏览器打开</span>

      <span class="token comment">// alert('安卓手机中打开的');</span>
      <span class="token comment">/*window.location.href=&quot;https://jushizhibo.com/android/app-release.apk&quot;;*/</span>
      <span class="token comment">// window.open('https://jushizhibo.com/android/app-release.apk','_self')</span>
      <span class="token keyword">return</span> <span class="token string">&quot;anzhuo&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>browser<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>ios<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//是否在IOS浏览器打开</span>
      <span class="token comment">// alert('IOS中打开的');</span>
      <span class="token comment">/*window.location.href=&quot;https://www.baidu.com&quot;;*/</span>
      <span class="token comment">// window.open('transparentfactory://xiangqingye','_self')</span>
      <span class="token keyword">return</span> <span class="token string">&quot;ios&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//此时是非移动端,则跳转PC站</span>
    <span class="token comment">// alert('PC中打开的');</span>
    <span class="token comment">// if(window.location.href.indexOf(&quot;ooo0o.com/mobile&quot;) != -1){</span>
    <span class="token comment">//     window.location.href = &quot;https://www.ooo0o.com&quot;</span>
    <span class="token comment">// }</span>
    <span class="token keyword">return</span> <span class="token string">&quot;pc&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>使用时导入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>checkdevice<span class="token punctuation">}</span>  <span class="token keyword">from</span> <span class="token string">'checkdevice.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="七牛云的使用"><a href="#七牛云的使用" class="header-anchor">#</a> 七牛云的使用</h3> <p>安装七牛包</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>npm install qiniu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>新建文件，设置七牛云参数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> bucket<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
<span class="token keyword">var</span> imageUrl<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
<span class="token keyword">var</span> accessKey <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
<span class="token keyword">var</span> secretKey <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
<span class="token keyword">var</span> mac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>digest<span class="token punctuation">.</span>Mac</span><span class="token punctuation">(</span>accessKey<span class="token punctuation">,</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> option<span class="token operator">=</span><span class="token punctuation">{</span>
    scope<span class="token operator">:</span>bucket<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> putPolicy<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>rs<span class="token punctuation">.</span>PutPolicy</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
<span class="token keyword">var</span> uploadToken <span class="token operator">=</span> putPolicy<span class="token punctuation">.</span><span class="token function">uploadToken</span><span class="token punctuation">(</span>mac<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上传代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

config<span class="token punctuation">.</span>zone<span class="token operator">=</span> qiniu<span class="token punctuation">.</span>zone<span class="token punctuation">.</span>Zone_z0<span class="token punctuation">;</span><span class="token comment">//选择七牛云的机房</span>
<span class="token comment">//是否使用https、是否使用cdn加速</span>
config<span class="token punctuation">.</span>usehttpsDomain<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span>useCdnDomain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> formUploader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>form_up<span class="token punctuation">.</span>FormUploader</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> putExtra <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>form_up<span class="token punctuation">.</span>PutExtra</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> key <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

formUploader<span class="token punctuation">.</span><span class="token function">putFile</span><span class="token punctuation">(</span>uploadToken<span class="token punctuation">,</span>key<span class="token punctuation">,</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>pathName<span class="token punctuation">)</span><span class="token punctuation">,</span>putExtra<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">respErr<span class="token punctuation">,</span>respBody<span class="token punctuation">,</span>respInfo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>resqErr<span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">throw</span> respErr<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>respInfo<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>respBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>respInfo<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>respBody<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>                                                   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>https://segmentfault.com/a/1190000017064729</p> <h3 id="发邮件"><a href="#发邮件" class="header-anchor">#</a> 发邮件</h3> <p>导入模块Nodemailer</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>npm install nodemailer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用方法(包官网https://nodemailer.com/)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//引入包</span>
<span class="token keyword">const</span> nodemailer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;nodemailer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建邮件请求对象（qq邮箱、163邮箱或其他）</span>
  <span class="token keyword">let</span> transporter <span class="token operator">=</span> nodemailer<span class="token punctuation">.</span><span class="token function">createTransport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    host<span class="token operator">:</span> <span class="token string">&quot;smtp.ethereal.email&quot;</span><span class="token punctuation">,</span><span class="token comment">//邮箱服务器</span>
    port<span class="token operator">:</span> <span class="token number">587</span><span class="token punctuation">,</span>（端口号）
    secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// true for 465, false for other ports</span>
    auth<span class="token operator">:</span> <span class="token punctuation">{</span>
      user<span class="token operator">:</span> testAccount<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token comment">// 账号</span>
      pass<span class="token operator">:</span> testAccount<span class="token punctuation">.</span>pass <span class="token comment">// 你的邮箱服务器请求密码</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//所发送的邮件信息</span>
  <span class="token keyword">let</span> mailobj<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'&quot;Fred Foo 👻&quot; &lt;foo@example.com&gt;'</span><span class="token punctuation">,</span> <span class="token comment">// sender address</span>
    to<span class="token operator">:</span> <span class="token string">&quot;bar@example.com, baz@example.com&quot;</span><span class="token punctuation">,</span> <span class="token comment">// list of receivers</span>
    subject<span class="token operator">:</span> <span class="token string">&quot;Hello ✔&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Subject line</span>
    text<span class="token operator">:</span> <span class="token string">&quot;Hello world?&quot;</span><span class="token punctuation">,</span> <span class="token comment">// plain text body</span>
    html<span class="token operator">:</span> <span class="token string">&quot;&lt;b&gt;Hello world?&lt;/b&gt;&quot;</span> <span class="token comment">// html body</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//发送邮件</span>
  transporter<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>mailobj<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="http爬虫"><a href="#http爬虫" class="header-anchor">#</a> http爬虫</h3> <h3 id="node应用打包可执行文件"><a href="#node应用打包可执行文件" class="header-anchor">#</a> node应用打包可执行文件</h3> <p>pkg可以将node项目打包为一个单独的可执行文件，在未安装nodejs的机器上运行。支持win、linux等多系统</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> pkg --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="node应用部署docker"><a href="#node应用部署docker" class="header-anchor">#</a> Node应用部署Docker</h3> <p>Docker允许你以应用程序所有的依赖打包成一个标准化的单元，这被称为一个容器，对于应用开发而言，一个容器就是一个蜕化到最基础的linux操作系统，一个镜像是你加载到容器中的软件</p> <p>在node app应用的目录下新建一个Dockerfile，编辑这个文件</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment">#从Docker站点获取相关镜像</span>
<span class="token keyword">From</span> node<span class="token punctuation">:</span>12
<span class="token comment">#在镜像中创建一个文件夹存放应用程序代码，这将是应用程序工作的目录</span>
<span class="token keyword">WORKDIR</span> /usr/src/app
<span class="token comment">#安装应用程序的所有依赖</span>
<span class="token keyword">COPY</span> package*.json ./

<span class="token keyword">RUN</span> npm install 
<span class="token comment">#在Docker镜像中使用COPY命令绑定你的应用程序</span>
<span class="token keyword">COPY</span> . .
<span class="token comment">#定义映射端口，如应用程序的端口为8080，则与docker的镜像做映射</span>
<span class="token keyword">EXPOSE</span> 8080
<span class="token comment">#最后要定义运行时的CMD命令来运行应用程序，这里使用node serverjs启动服务器</span>
<span class="token keyword">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;server.js&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>在dockerfile的同一个文件夹下创建.dockerignore文件，带有以下内容</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>node_modules
npm<span class="token punctuation">-</span>debug.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这将避免本地模块和调试日志被拷贝进入你的Docker镜像中，不会把镜像中安装的模块覆盖</p> <p>准备好之后就可以使用命令行构建和运行镜像</p> <p>进入dockerfile所在的目录，运行命令构建镜像</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker build -t <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/node-web-app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>构建之后就可以显示或者运行镜像</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用-d模式以分离模式运行docker容器，使得容器在后台自助运行</p> <p>开关符-p在容器中把一个公共端口导向到私有的端口</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker run -p <span class="token number">49160</span>:8080 -d <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span>/node-web-app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="node常见问题汇总"><a href="#node常见问题汇总" class="header-anchor">#</a> Node常见问题汇总</h2> <h3 id="npm-err-maximum-call-stack-size-exceeded"><a href="#npm-err-maximum-call-stack-size-exceeded" class="header-anchor">#</a> npm ERR! Maximum call stack size exceeded</h3> <p>解决方法：全局更新npm</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>npm install npm -g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="core-js"><a href="#core-js" class="header-anchor">#</a> core-js</h3> <p>warning react-native &gt; create-react-class &gt; fbjs &gt; core-js@1.2.7: core-js@&lt;2.6.8 is no longer maintained. Please, upgrade to core-js@3 or at least to actual version of core-js@2</p> <p>旧包不在维护，安装新包，自动卸载旧版本</p> <div class="language-node line-numbers-mode"><pre class="language-text"><code>npm install --save core-js@^3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：警告可能是由于你所安装的新包在使用旧版本的依赖所导致的警告，但是如果不是你自己开发的，你不能更改包的源码和依赖项，所以这种情况忽略警告吧</p> <h2 id="学习资源"><a href="#学习资源" class="header-anchor">#</a> 学习资源</h2> <p>node问答：https://github.com/jimuyouyou/node-interview-questions</p> <p>https://javascript.ruanyifeng.com/</p> <p>https://markpop.github.io/2014/10/29/NodeJs%E6%95%99%E7%A8%8B/</p> <p>node包讲解：https://github.com/chyingp/nodejs-learning-guide</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/8/2021, 10:45:23 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tech/Javascript/Node5.html" class="prev">
        JavaScript开发（五）
      </a></span> <span class="next"><a href="/tech/Javascript/Node7.html">
        NodeJs开发（二）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.107701cb.js" defer></script><script src="/assets/js/2.619c82a8.js" defer></script><script src="/assets/js/14.4a9f97de.js" defer></script>
  </body>
</html>
