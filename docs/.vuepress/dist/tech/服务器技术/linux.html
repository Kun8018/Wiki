<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux | Kun&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="meta的描述内容">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.107701cb.js" as="script"><link rel="preload" href="/assets/js/2.619c82a8.js" as="script"><link rel="preload" href="/assets/js/41.f5621bfc.js" as="script"><link rel="prefetch" href="/assets/js/10.4c94b81d.js"><link rel="prefetch" href="/assets/js/11.f5303132.js"><link rel="prefetch" href="/assets/js/12.0450625b.js"><link rel="prefetch" href="/assets/js/13.cd86f0f8.js"><link rel="prefetch" href="/assets/js/14.4a9f97de.js"><link rel="prefetch" href="/assets/js/15.dbdc93f4.js"><link rel="prefetch" href="/assets/js/16.006f93ff.js"><link rel="prefetch" href="/assets/js/17.ad3cdb92.js"><link rel="prefetch" href="/assets/js/18.1b7ef2b7.js"><link rel="prefetch" href="/assets/js/19.0a7bdbd0.js"><link rel="prefetch" href="/assets/js/20.0d56d304.js"><link rel="prefetch" href="/assets/js/21.3190efab.js"><link rel="prefetch" href="/assets/js/22.4e836b52.js"><link rel="prefetch" href="/assets/js/23.03993835.js"><link rel="prefetch" href="/assets/js/24.a01f0216.js"><link rel="prefetch" href="/assets/js/25.6781aead.js"><link rel="prefetch" href="/assets/js/26.ddf559ad.js"><link rel="prefetch" href="/assets/js/27.46e966a4.js"><link rel="prefetch" href="/assets/js/28.5c6a09d7.js"><link rel="prefetch" href="/assets/js/29.5db34a2c.js"><link rel="prefetch" href="/assets/js/3.c6ec38c3.js"><link rel="prefetch" href="/assets/js/30.9f2849c6.js"><link rel="prefetch" href="/assets/js/31.5815c55c.js"><link rel="prefetch" href="/assets/js/32.574798bd.js"><link rel="prefetch" href="/assets/js/33.0d623fd7.js"><link rel="prefetch" href="/assets/js/34.83890c8c.js"><link rel="prefetch" href="/assets/js/35.89b4b514.js"><link rel="prefetch" href="/assets/js/36.5a1b2b99.js"><link rel="prefetch" href="/assets/js/37.702be7e9.js"><link rel="prefetch" href="/assets/js/38.0063f952.js"><link rel="prefetch" href="/assets/js/39.787f0c14.js"><link rel="prefetch" href="/assets/js/4.e268862a.js"><link rel="prefetch" href="/assets/js/40.c99cd2ad.js"><link rel="prefetch" href="/assets/js/42.c7540d40.js"><link rel="prefetch" href="/assets/js/43.4c36a635.js"><link rel="prefetch" href="/assets/js/44.b9cba9f3.js"><link rel="prefetch" href="/assets/js/45.69b2d954.js"><link rel="prefetch" href="/assets/js/46.5534b655.js"><link rel="prefetch" href="/assets/js/47.f16f43f3.js"><link rel="prefetch" href="/assets/js/48.fb20e8b3.js"><link rel="prefetch" href="/assets/js/49.0f580aeb.js"><link rel="prefetch" href="/assets/js/5.0c896d33.js"><link rel="prefetch" href="/assets/js/50.f9b08984.js"><link rel="prefetch" href="/assets/js/51.1cf6d401.js"><link rel="prefetch" href="/assets/js/52.d08beb36.js"><link rel="prefetch" href="/assets/js/53.12958900.js"><link rel="prefetch" href="/assets/js/54.5054df3f.js"><link rel="prefetch" href="/assets/js/55.b71ef02a.js"><link rel="prefetch" href="/assets/js/56.c4c0ace1.js"><link rel="prefetch" href="/assets/js/57.2353a8bb.js"><link rel="prefetch" href="/assets/js/58.30db1013.js"><link rel="prefetch" href="/assets/js/59.2b1f1022.js"><link rel="prefetch" href="/assets/js/6.2958d7f8.js"><link rel="prefetch" href="/assets/js/60.ee89bede.js"><link rel="prefetch" href="/assets/js/61.1fbe0671.js"><link rel="prefetch" href="/assets/js/62.84e1e2cf.js"><link rel="prefetch" href="/assets/js/63.2e3baa5f.js"><link rel="prefetch" href="/assets/js/64.56588b49.js"><link rel="prefetch" href="/assets/js/65.69bba41a.js"><link rel="prefetch" href="/assets/js/66.f7708893.js"><link rel="prefetch" href="/assets/js/67.a93cc627.js"><link rel="prefetch" href="/assets/js/68.bbe764d2.js"><link rel="prefetch" href="/assets/js/69.7d632097.js"><link rel="prefetch" href="/assets/js/7.4f3f4813.js"><link rel="prefetch" href="/assets/js/70.9fbcc14a.js"><link rel="prefetch" href="/assets/js/71.e4b8c89d.js"><link rel="prefetch" href="/assets/js/72.b7d8c12a.js"><link rel="prefetch" href="/assets/js/73.d033e936.js"><link rel="prefetch" href="/assets/js/74.6b83aade.js"><link rel="prefetch" href="/assets/js/8.af6b4dfd.js"><link rel="prefetch" href="/assets/js/9.0ac2d280.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kun's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  科研
</a></div><div class="nav-item"><a href="/shoot/" class="nav-link">
  摄影
</a></div><div class="nav-item"><a href="https://www.github.com/kun8018" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="/tech/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  科研
</a></div><div class="nav-item"><a href="/shoot/" class="nav-link">
  摄影
</a></div><div class="nav-item"><a href="https://www.github.com/kun8018" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Tech</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/" aria-current="page" class="sidebar-link">Blogging Like a Hacker</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>周边开发技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据库相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>服务器技术</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/服务器技术/SpingBoot.html" class="sidebar-link">Spring Boot学习</a></li><li><a href="/tech/服务器技术/docker.html" class="sidebar-link">概述</a></li><li><a href="/tech/服务器技术/k8s.html" class="sidebar-link">k8s</a></li><li><a href="/tech/服务器技术/linux.html" class="active sidebar-link">Linux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#linux概述" class="sidebar-link">Linux概述</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#下载与安装" class="sidebar-link">下载与安装</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#修改镜像源和网络" class="sidebar-link">修改镜像源和网络</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#常用命令" class="sidebar-link">常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#systemd" class="sidebar-link">systemd</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#什么命令都不能用了" class="sidebar-link">什么命令都不能用了</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#用户" class="sidebar-link">用户</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#连接" class="sidebar-link">连接</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#快捷键" class="sidebar-link">快捷键</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#增加cpu占有率" class="sidebar-link">增加CPU占有率</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#centos" class="sidebar-link">centos</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#vim" class="sidebar-link">Vim</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#linux下软件包" class="sidebar-link">linux下软件包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#安装方法" class="sidebar-link">安装方法</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#下载方法" class="sidebar-link">下载方法</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#安装cmake" class="sidebar-link">安装cmake</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#rpm-build" class="sidebar-link">rpm-build</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#selinux" class="sidebar-link">Selinux</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#firewalld和utf" class="sidebar-link">firewalld和utf</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#全局端口转发" class="sidebar-link">全局端口转发</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#定时执行脚本" class="sidebar-link">定时执行脚本</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#nginx" class="sidebar-link">Nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#默认主页、目录访问" class="sidebar-link">默认主页、目录访问</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#反向代理" class="sidebar-link">反向代理</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#配置浏览器缓存" class="sidebar-link">配置浏览器缓存</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#负载均衡" class="sidebar-link">负载均衡</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#支持cors跨域" class="sidebar-link">支持CORS跨域</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#高可用keep-alived" class="sidebar-link">高可用keep-alived</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#屏蔽ip-国外ip" class="sidebar-link">屏蔽ip/国外ip</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#重定向" class="sidebar-link">重定向</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#配置图片防盗链" class="sidebar-link">配置图片防盗链</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#https配置" class="sidebar-link">Https配置</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#缓冲优化" class="sidebar-link">缓冲优化</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#gzip压缩" class="sidebar-link">gzip压缩</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#错误日志" class="sidebar-link">错误日志</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#性能" class="sidebar-link">性能</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#伪静态" class="sidebar-link">伪静态</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#资源" class="sidebar-link">资源</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#apache" class="sidebar-link">Apache</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#部署项目" class="sidebar-link">部署项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#react" class="sidebar-link">react</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#node" class="sidebar-link">Node</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#服务器翻墙github太慢问题" class="sidebar-link">服务器翻墙GitHub太慢问题</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#linux端口无法访问问题排查" class="sidebar-link">linux端口无法访问问题排查</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#docker" class="sidebar-link">docker</a></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#v2ray" class="sidebar-link">V2ray</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#客户端使用" class="sidebar-link">客户端使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/tech/服务器技术/linux.html#nextcloud个人网盘服务器" class="sidebar-link">Nextcloud个人网盘服务器</a></li></ul></li><li><a href="/tech/服务器技术/rust.html" class="sidebar-link">Rust</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>桌面端开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>移动端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>进阶前端技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>静态语言</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>业余研究</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关于</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>科学研究</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="linux概述"><a href="#linux概述" class="header-anchor">#</a> Linux概述</h2> <p>在我看来，Linux是一个对软件开发非常友好的操作系统。它去除了很多windows下的杂质，保留了非常干净的系统。Mac系统也是与它有很多相似的地方，才这样好用。</p> <p></p> <h2 id="下载与安装"><a href="#下载与安装" class="header-anchor">#</a> 下载与安装</h2> <p>​       以linux为内核的有Ubuntu，Debian、Centos，操作方式大同小异</p> <p>​       因为linux是开源系统，所以在百度或者谷歌直接搜索ubuntu16.0，就能找到安装包。安装的时候找阿里镜像源，会下载的快一些。</p> <h2 id="修改镜像源和网络"><a href="#修改镜像源和网络" class="header-anchor">#</a> 修改镜像源和网络</h2> <p>清华大学镜像源网站：https://mirrors.tuna.tsinghua.edu.cn/</p> <h2 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h2> <p>查看进程</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">ps</span> aux
<span class="token function">ps</span> -elf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查看端口状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">lsof</span> -i:端口号
<span class="token comment">##查看tcp udp端口和进程等情况</span>
<span class="token function">netstat</span> -tunlp <span class="token operator">|</span> <span class="token function">grep</span> 端口号
<span class="token function">netstat</span> -ntlp <span class="token comment">## 查看当前所有tcp端口</span>
<span class="token function">netstat</span> -ntulp <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">80</span> <span class="token comment">##查看所有80端口使用情况</span>
<span class="token function">netstat</span> -l <span class="token comment">##只显示监听端口</span>
<span class="token function">netstat</span> -lt <span class="token comment">## 只列出所有监听TCP端口</span>
<span class="token function">netstat</span> -lu <span class="token comment">## 只列出所有监听UDP端口</span>
<span class="token function">netstat</span> -lx <span class="token comment">## 只列出所有监听UNIX端口</span>
<span class="token function">netstat</span> -pt <span class="token comment">## 在netstat输出中显示PIC和进程名称</span>
<span class="token function">netstat</span> -an <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">':80'</span> <span class="token comment">##找出运行在指定端口的进程</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>服务器常用端口</p> <p>21 ftp ftp服务器所开放的端口，用于上传下载</p> <p>22 ssh 22端口就是ssh端口，用于通过命令行模式远程连接Linux系统的服务器</p> <p>25 SMTP SMTP服务器所开放的端口，用于发送邮件</p> <p>80 HTTP 用于网站服务例如IIS、Apache、Nginx等提供对外访问</p> <p>113 POP3 110端口是为POP3服务开放的</p> <p>143 IMAP 143端口主页用于Internet Message</p> <p>443 HTTPS 网页浏览端口，能提供加密和通过安全端口传输的另一种HTTP</p> <p>3306 MySQL  3306端口是MySQL数据库的默认端口，用于MySQL对外提供服务</p> <p>8080 代理端口 8080端口同80端口，是被用于www代理服务的，可以实现网页浏览，经常在访问某个网站或使用代理服务器时会加上8080端口，此外Apache Tomcat web server默认服务端口就是8080</p> <p>清除端口进程</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">kill</span> <span class="token punctuation">[</span>信号<span class="token punctuation">]</span> PID//pid号
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>kill信号</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">kill</span> -0:程序退出时收到该信息
<span class="token function">kill</span> -1:挂掉电话线或者终端连接的挂起信号，这个信号也会造成某些进程在没有终止的情况下重新初始化
<span class="token function">kill</span> -2:表示结束进程，但不是强制性的，常用的ctrl+c就是发出一个kill -2命令
<span class="token function">kill</span> -3:退出
<span class="token function">kill</span> -9:杀死进程，即强制结束进程，有可能会导致程序崩溃等
<span class="token function">kill</span> -11:段错误
<span class="token function">kill</span> -15:正常结束进程，是kill命令段默认信号
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>删除文件/文件夹</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">rm</span> -f filename

<span class="token function">rm</span> -rf filename
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>set</p> <p>set命令用于设置shell</p> <p>关机/重启</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 立即关机</span>
<span class="token function">shutdown</span> -h now
<span class="token comment">## 10分钟后关机</span>
<span class="token function">shutdown</span> -h <span class="token number">10</span>
<span class="token comment">## 立刻关机</span>
power off
<span class="token comment">## 重启</span>
<span class="token function">reboot</span>
<span class="token comment">## 重启</span>
<span class="token function">shutdown</span> -r now
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>传输文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 从服务器上下载文件</span>
<span class="token function">scp</span> username@servernama:/path/filename /var/www/local_dir

<span class="token comment">## 上传文件到服务器</span>
<span class="token function">scp</span> /path/filename username@servernama:/path

<span class="token comment">## 下载目录</span>
<span class="token function">scp</span> -r username@servernama:/path/ /var/www/local_dir

<span class="token comment">## 上传目录</span>
<span class="token function">scp</span> -r /var/www/local_dir username@servernama:/path
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>修改文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sed</span> <span class="token string">'s/properties/property/g'</span> build.xml
<span class="token comment">## 批量替换</span>
<span class="token function">grep</span> -ilr <span class="token string">'log('</span> *<span class="token operator">|</span>xargs-<span class="token operator">|</span>@ <span class="token function">sed</span> -i <span class="token string">&quot;'s/print(///Log(/g'@
## 
sed -i &quot;</span>s/hello/hi/g<span class="token string">&quot; test.txt
## 删除行首空格
sed -i 's/^ //g'test
## 删除行尾空格
sed -i 's/$//g' test
## 替换当前目录中所有含有hello字符的文件中的hello为hi
sed -i &quot;</span>s/hello/hi/g&quot; <span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> <span class="token string">&quot;hello&quot;</span> -rl ./<span class="token variable">`</span></span>
<span class="token comment">## 批量操作当前目录以m开头的文件</span>
<span class="token function">sed</span> -i <span class="token string">'s/foo/bar/g'</span> ./m*
<span class="token comment">## 查找所有子目录中m开头的文件并进行替换</span>
<span class="token function">sed</span> -i <span class="token string">'s/foo/bar/g'</span> <span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> foo -rl --include<span class="token operator">=</span><span class="token string">&quot;m*&quot;</span> ./<span class="token variable">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="systemd"><a href="#systemd" class="header-anchor">#</a> systemd</h3> <p>历史上，linux的启动一直采用init进程</p> <p>init进程有两个缺点：</p> <p>启动时间长、启动脚本复杂</p> <p>systemd就是为解决这个问题而生的，d是守护进程daemon的缩写。</p> <p>systemd取代了initd，成为了系统的第一个进程（pid等于1），其他进程都是它的子进程</p> <p>systemd的优点是功能强大，使用方便，缺点是体系庞大，非常复杂</p> <p>systemd的常用命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 重启系统</span>
<span class="token function">sudo</span> systemctl <span class="token function">reboot</span>
<span class="token comment">## 关闭系统，切断电源</span>
<span class="token function">sudo</span> systemctl poweroff
<span class="token comment">## cpu停止工作</span>
<span class="token function">sudo</span> systemctl <span class="token function">halt</span>
<span class="token comment">## 暂停系统</span>
<span class="token function">sudo</span> systemctl <span class="token function">suspend</span>
<span class="token comment">## 让系统进入冬眠状态</span>
<span class="token function">sudo</span> systemctl hibernate
<span class="token comment">## 让系统进入交互式休眠状态</span>
<span class="token function">sudo</span> systemctl hybrid-sleep
<span class="token comment">## 启动救援状态</span>
<span class="token function">sudo</span> systemctl rescue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>查看本机信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 查看当前主机信息</span>
hostnamectl

<span class="token comment">## 设置主机名</span>
<span class="token function">sudo</span> hostnamectl set-hostname rhel7

<span class="token comment">## 查看本地化设置</span>
localectl

<span class="token comment">## 设置本地化参数</span>
<span class="token function">sudo</span> localectl set-locale <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_GB.utf8
<span class="token function">sudo</span> lccalectl set-keymap en_GB

<span class="token comment">## 查看当前登陆的用户</span>
loginctl list-users

<span class="token comment">## 列出当前session</span>
loginctl list-sessions

<span class="token comment">## 列出显示指定用户的信息</span>
loginctl show-user ruanyf

<span class="token comment">## 查看当前时区设置</span>
timedatectl 

<span class="token comment">## 显示所有可用的时区</span>
timedatectl list-timezones

<span class="token comment">## 设置当前时区</span>
<span class="token function">sudo</span> timedatectl set-timezone America/New_York
<span class="token function">sudo</span> timedatectl set-time YYYY-MM-DD
<span class="token function">sudo</span> timedatectl set-time HH:MM:SS
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>查看Unit信息</p> <p>nohup命令</p> <p>nohup命令用于在后台不挂断地运行命令，挂起进程，退出终端不会影响程序的运行</p> <p>nohup命令在默认情况下，也就是非重定向时，会输出一个名叫nohup。out的文件到当前目录，如果当前目录到nohup。out文件不可写，输出到HOME/nohu。pout文件中</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">nohup</span> ./nebula-httpd <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="node应用的systemd启动"><a href="#node应用的systemd启动" class="header-anchor">#</a> node应用的systemd启动</h4> <p>创建配置文件,后缀为service</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>node simple server

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token comment">##启动命令</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>always
<span class="token assign-left variable">User</span><span class="token operator">=</span>nobody
<span class="token assign-left variable">Group</span><span class="token operator">=</span>nobody
<span class="token assign-left variable">Environment</span><span class="token operator">=</span><span class="token environment constant">PATH</span><span class="token operator">=</span>/usr/bin:/user/local/bin
<span class="token assign-left variable">Environment</span><span class="token operator">=</span>NODE_ENV<span class="token operator">=</span>production
<span class="token assign-left variable">WorkingDirectory</span><span class="token operator">=</span>/tmp/node-systemd-demo

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>将配置文件拷贝到systemd之中</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">cp</span> node-server.service /etc/systemd/system
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重载配置文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> systemctl daemon-reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="什么命令都不能用了"><a href="#什么命令都不能用了" class="header-anchor">#</a> 什么命令都不能用了</h3> <p>环境变量配置错误造成的，输入</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者手动在/etc/profile中添加此行</p> <h2 id="用户"><a href="#用户" class="header-anchor">#</a> 用户</h2> <p>普通用户可以用sudo</p> <p>如果提示不再sudoers文件中，在sudoers文件中添加用户</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/sudoers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加语句</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">username</span> <span class="token attr-value">ALL=(ALL)  ALL</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="连接"><a href="#连接" class="header-anchor">#</a> 连接</h2> <p>linux最重要的用途还是服务器吧，目前绝大多数服务器都是linux系统。centos或者ubuntu、debian，在本地可以远程连接服务器进行操作</p> <p>通过密码连接服务器</p> <p>直接输入命令</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>ssh 用户名@IP地址 -p 端口号
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行后会要求输入密码，输入即可登录</p> <p>通过密钥连接服务器</p> <p>首先在服务器端创建密钥对，下载私钥</p> <p>将私钥保存在.ssh文件下，如果没有.ssh目录，创建一个</p> <div class="language-mac line-numbers-mode"><pre class="language-text"><code>cd ~
mkdir .ssh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改密钥权限</p> <div class="language-mac line-numbers-mode"><pre class="language-text"><code>cd ~/.ssh
chmod 400 密钥文件名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>通过ssh密钥方式连接服务器</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>ssh -i ~/.ssh/mac root@192.168.0.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>~/.ssh/mac为下载的私钥的路径和文件名</p> <p>root是服务器端管理员账号，一般是root</p> <p>192.168.0.1是服务器的公网ip</p> <p>终端变成root就说明连接成功</p> <p>让mac终端始终保持与远程连接状态（Broken pipe）</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo vim /etc/ssh/ssh_config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加设置</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code># 断开时重试连接的次数
ServerAliveCountMax 5
# 每隔5s发送一个空请求以保持连接
ServerAliveInterval 5
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="快捷键"><a href="#快捷键" class="header-anchor">#</a> 快捷键</h2> <p>启动终端：ctrl+alt+T</p> <p>​        创建目录：mkdir</p> <p>​        返回上层目录：cd ..</p> <p>​        停止运行：Ctrl+c</p> <p>​        关闭终端   Ctrl+alt+Q</p> <p>​        新建终端   Ctrl+alt+N</p> <h2 id="增加cpu占有率"><a href="#增加cpu占有率" class="header-anchor">#</a> 增加CPU占有率</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token punctuation">$(</span>cat/proc/cpuinfo <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">&quot;physical id&quot;</span> <span class="token operator">|</span><span class="token function">wc</span> -l<span class="token punctuation">)</span><span class="token variable">`</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/null <span class="token operator">&amp;</span> <span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="centos"><a href="#centos" class="header-anchor">#</a> centos</h2> <p>查找操作系统的内核版本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">uname</span> -r
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>更新系统底层的库文件</p> <div class="language-centos line-numbers-mode"><pre class="language-text"><code>yum update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="vim"><a href="#vim" class="header-anchor">#</a> Vim</h2> <p>vim命令</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code><span class="token punctuation">:</span><span class="token keyword">w</span> 保存文件但不退出<span class="token keyword">vim</span> 
<span class="token punctuation">:</span><span class="token keyword">w</span><span class="token operator">!</span> 强制保存文件但不退出<span class="token keyword">vim</span> 
<span class="token punctuation">:</span><span class="token keyword">wq</span> 保存文件并退出<span class="token keyword">vim</span>
<span class="token punctuation">:</span><span class="token keyword">wq</span><span class="token operator">!</span>强制保存文件并退出<span class="token keyword">vim</span>
<span class="token punctuation">:</span><span class="token keyword">q</span> 不保存文件直接退出
<span class="token punctuation">:</span><span class="token keyword">q</span><span class="token operator">!</span> 不保存文件强制退出<span class="token keyword">vim</span>
<span class="token punctuation">:</span><span class="token keyword">e</span><span class="token operator">!</span> 放弃所有修改，从上次保存文件开始再编辑命令历史
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="linux下软件包"><a href="#linux下软件包" class="header-anchor">#</a> linux下软件包</h2> <p>linux下应用程序的软件包按<strong>内容类别</strong>分为两类：</p> <p>1.可执行文件(编译后的二进制软件包)</p> <p>解压包之后就可以直接运行，类似于windows下的软件包，安装完可以直接使用，但是看不到源程序，而且下载时要注意这个软件是否是你所使用的平台，否则无法正常安装，如centos与ubuntu</p> <p>优点：使用简单，只需要几个命令就能实现软件包的安装、卸载、升级、查询，安装速度快</p> <p>缺点：不能看源代码，功能选择不如源代码灵活，依赖性</p> <p>2.源程序(源码包)</p> <p>解开包之后你还需要使用编译器将其编译为可执行文件，这是linux独有的，windows的思想是不开放源程序</p> <p>优点：开源，可以自由选择所需功能，可看源码，卸载方便</p> <p>缺点：安装步骤过多，编译时间过长</p> <p>二进制软件包与源码包区别：</p> <p>与直接从源代码安装相比，软件包管理易于安装和卸载，易于更新已安装的软件包，易于保护配置文件，易于跟踪已安装文件</p> <p>通常用tar打包的都是源程序，用rpm、dpkg打包的则常是可执行程序，一般来说，自己动手打包源程序更具灵活性，但是容易遇到各种问题，而可执行程序包更容易安装，但是灵活性会差很多，所以一般一个软件会提供多种打包格式的安装程序。</p> <p>linux下应用程序的软件包按<strong>格式</strong>分类：</p> <p>linux下的软件安装包主要有rpm、deb、tar.gz三种格式</p> <p>软件后缀为.rpm最初是Red Hat Linux提供的一种包封装格式，rpm较deb发行早，所以现在许多linux发行版本都使用。rpm包本质就是一个可以在特定机器上运行的Linux软件，可以在红帽Linux、Suse、Fedora直接进行安装，但在Ubuntu上无法识别</p> <p>软件后缀为.deb是Debian linux提供的包封装格式。deb的包管理器dpkg只在debian上有，ubuntu也支持，可以在ubuntu上进行安装</p> <p>软件后缀.tar.gz、tar.Z、tar.bz2、.tgz是使用unix系统打包工具tar打包的。tar包在所有Linux版本中都能运行，但是安装过程也最麻烦，tar包就是一个压缩包，是为了便于传输所产生的一种专门用于网络流通的文件格式，tar包与deb、rpm包相比，tar包不一定是软件，也可能是图片、文本等等</p> <p>软件后缀为.bin的一般是一些商业软件</p> <h3 id="安装方法"><a href="#安装方法" class="header-anchor">#</a> 安装方法</h3> <p>rpm包：</p> <p>查询系统中所有的rpm包</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">rpm</span> -qa

<span class="token comment">## 查询所有包含某个字符串sql的软件包</span>
<span class="token function">rpm</span> -qa <span class="token operator">|</span><span class="token function">grep</span> sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">rpm</span> -i your-package.rpm
<span class="token comment">## 强制安装</span>
<span class="token function">rpm</span> -i --force your-package.rpm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>卸载（后缀不能包含rpm）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">rpm</span> -e your-package
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>升级软件包</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">rpm</span> -Uvh your-package.rpm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装rpm-build</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum list <span class="token operator">|</span><span class="token function">grep</span> rpm-build
yum <span class="token function">install</span> -y rpm-build.x86_64
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>tar包：</p> <h3 id="下载方法"><a href="#下载方法" class="header-anchor">#</a> 下载方法</h3> <p>wget可以下载整个页面和文件</p> <p>wget会遵守robots.txt文件。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">wget</span> -r -p -e <span class="token assign-left variable">robots</span><span class="token operator">=</span>off http://www.example.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="安装cmake"><a href="#安装cmake" class="header-anchor">#</a> 安装cmake</h3> <p>准备编译环境</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum -y <span class="token function">install</span> gcc gcc-c++
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>获取源码并解压</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> https://github.com/Kitware/CMake/releases/download/3.15.5/cmake-3.15.5.tar.gz
<span class="token comment">## 备用下载地址 https://down.24kplus.com/linux/cmake/cmake-3.15.5.tar.gz</span>

<span class="token function">tar</span> -zxf cmake-3.15.5.tar.gz

<span class="token builtin class-name">cd</span> cmake-3.15.5
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>编译安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./bootstrap --prefix<span class="token operator">=</span>/usr --datadir<span class="token operator">=</span>share/cmake --docdir<span class="token operator">=</span>doc/cmake <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> 
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>验证安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>cmake --version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="rpm-build"><a href="#rpm-build" class="header-anchor">#</a> rpm-build</h3> <p>如果你想打包rpm包，可能还需要rpm-build包</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum <span class="token function">install</span> rpm-build 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="selinux"><a href="#selinux" class="header-anchor">#</a> Selinux</h2> <p>安全增强型 Linux（SELinux）是一种采用安全架构的 <a href="https://www.redhat.com/zh/topics/linux/what-is-linux" target="_blank" rel="noopener noreferrer">Linux® 系统<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它能够让管理员更好地管控哪些人可以访问系统。它最初是作为 <a href="https://www.redhat.com/zh/topics/linux/what-is-the-linux-kernel" target="_blank" rel="noopener noreferrer">Linux 内核<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的一系列补丁，由美国国家安全局（NSA）利用 Linux 安全模块（LSM）开发而成。</p> <p>SELinux 于 2000 年发布到开源社区，并于 2003 年集成到上游 Linux 内核中。</p> <p>SELinux 定义了每个人对系统上的应用、进程和文件的访问权限。它利用安全策略（一组告知 SELinux 哪些能访问，哪些不能访问的规则）来强制执行策略所允许的访问。</p> <p>当应用或进程（称为主体）发出访问对象（如文件）的请求时，SELinux 会检查访问向量缓存（AVC），其中缓存有主体和对象的访问权限。</p> <p>查看selinux状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 命令1</span>
/usr/sbin/sestatus -v
<span class="token comment">## SELinux status:                 enabled</span>
<span class="token comment">## 命令2</span>
getenforce
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>临时关闭</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>setenforce <span class="token number">0</span> <span class="token comment">##设置SELinux 成为permissive模式</span>
<span class="token comment">##setenforce 1 设置SELinux 成为enforcing模式</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>也可以修改/etc/selinux/config 文件</p> <p>将SELINUX=enforcing改为SELINUX=disabled</p> <h2 id="firewalld和utf"><a href="#firewalld和utf" class="header-anchor">#</a> firewalld和utf</h2> <h3 id="全局端口转发"><a href="#全局端口转发" class="header-anchor">#</a> 全局端口转发</h3> <p>iptables 是一个配置 Linux 内核 防火墙 的命令行工具，是 netfilter 项目的一部分。
术语 iptables 也经常代指该内核级防火墙。
iptables 用于 ipv4，ip6tables 用于 ipv6。
需要root账户执行以下操作</p> <p>开启iptables</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token number">1</span> <span class="token operator">&gt;</span>/proc/sys/net/ipv4/ip_forward
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认值0是禁止ip转发，修改为1即开启ip转发功能。</p> <p>简单转发</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#-- 把访问本机 8091 端口的请求转发到 8090端口</span>
$ iptables -t nat -A PREROUTING -p tcp --dport <span class="token number">8091</span> -j REDIRECT --to-ports <span class="token number">8090</span>
<span class="token comment">#-- 把访问本机 8093 端口的请求转发到 192.168.1.3 的 8090端口</span>
$ iptables -t nat -A PREROUTING -i eth0 -p tcp --dport <span class="token number">8093</span> -j DNAT --to <span class="token number">192.168</span>.1.3:8090
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="定时执行脚本"><a href="#定时执行脚本" class="header-anchor">#</a> 定时执行脚本</h2> <p>crontab可以在指定的时间执行一个shell脚本以及一系列Linux命令</p> <p>常用于定时备份数据库、日志等</p> <p>常用命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">crontab</span> -e     <span class="token comment">##修改crontab文件，</span>
<span class="token function">crontab</span> -l     <span class="token comment">##显示crontab文件</span>
<span class="token function">crontab</span> -r     <span class="token comment">##删除crontab文件</span>
<span class="token function">crontab</span> -ir    <span class="token comment">##删除crontab文件之前提醒用户</span>

<span class="token function">service</span> crond status
<span class="token function">service</span> crond start
<span class="token function">service</span> crond stop
<span class="token function">service</span> crond restart
<span class="token function">service</span> crond reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>基本格式</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>* * * * * <span class="token builtin class-name">command</span>
<span class="token comment">#分 时 日 月 周 + 命令</span>
<span class="token number">10</span> <span class="token number">0</span> * * * <span class="token builtin class-name">command</span> ./a.sh
<span class="token comment">## 每天0点10分执行命令</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h2> <p>Nginx是常用的网络服务器，ubuntu和debian类似，这里以centos7为例</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>yum install nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>nginx的默认安装目录为<code>/usr/local/nginx</code>,配置文件的目录为<code>/usr/local/nginx/conf/nginx.conf</code></p> <p>启动nginx服务</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>systemctl enable nginx<span class="token punctuation">.</span>service 
systemctl start nginx<span class="token punctuation">.</span>service
systemctl stop nginx<span class="token punctuation">.</span>service
systemctl restart nginx<span class="token punctuation">.</span>service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>nginx命令</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>nginx <span class="token operator">-</span>s reload  <span class="token comment"># 热重启</span>
nginx <span class="token operator">-</span>s reopen  <span class="token comment"># 重启Nginx</span>
nginx <span class="token operator">-</span>s stop    <span class="token comment"># 快速关闭</span>
nginx <span class="token operator">-</span>s quit    <span class="token comment"># 等待工作进程处理完成后关闭</span>
nginx <span class="token operator">-</span>T         <span class="token comment"># 查看配置文件的实际内容</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="默认主页、目录访问"><a href="#默认主页、目录访问" class="header-anchor">#</a> 默认主页、目录访问</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">root</span> <span class="token operator">/</span>网站根目录<span class="token punctuation">;</span>
  <span class="token comment"># 优先使用默认主页</span>
  <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm <span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token punctuation">;</span>
  <span class="token comment"># 当默认主页不存在时直接列出目录内文件树</span>
  <span class="token keyword">autoindex</span> on<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h3> <p>先了解正向代理</p> <p>正向代理：局域网中的电脑用户想要直接访问网络是不可行的，只能通过代理服务器来访问，这种代理服务就被称为正向代理。</p> <p>反向代理是一个<code>Web</code>服务器，它接受客户端的连接请求，然后将请求转发给上游服务器，并将从服务器得到的结果返回给连接的客户端。</p> <p>客户端访问网络不需要配置，只要把请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据，然后再返回到客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器IP地址</p> <p>location匹配规则：</p> <p>～：正则匹配，区分大小写</p> <p>～*：正则匹配，不区分大小写</p> <p>@：定义一个命名的location，用于内部定向，例如error_page、try_files</p> <p>=：普通字符匹配，精确匹配</p> <p>^～：普通字符匹配，如果该选项匹配，则只匹配该选项，不再向下匹配其他选项</p> <p>匹配优先级（与location书写的先后顺序关系不大）：</p> <p>1.精确匹配：=符号严格匹配这个查询，如果找到，停止搜索，</p> <p>2.普通字符匹配：所有剩下的常规字符串，最长的匹配；如果找到^~这个符号停止搜索；</p> <p>3.正则匹配；</p> <p>4.默认匹配：如果第三条条件生效使用第三条，否则使用第二条</p> <p>nginx做http反向代理</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>api <span class="token punctuation">{</span>
  <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">32020</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">server</span><span class="token punctuation">{</span>
  <span class="token keyword">listen</span><span class="token punctuation">:</span><span class="token number">90</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span><span class="token punctuation">:</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.1</span>
    
  <span class="token keyword">location</span> <span class="token operator">/</span>edu<span class="token operator">/</span><span class="token punctuation">{</span>
    <span class="token keyword">root</span> html<span class="token punctuation">;</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">32020</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">location</span> <span class="token operator">/</span>ovd<span class="token operator">/</span><span class="token punctuation">{</span>
    <span class="token keyword">root</span> html<span class="token punctuation">;</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">32020</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>更多指令说明</p> <table><thead><tr><th style="text-align:left;">指令</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>proxy_connect_timeout</code></td> <td style="text-align:left;"><code>Nginx</code>从接受请求至连接到上游服务器的最长等待时间</td></tr> <tr><td style="text-align:left;"><code>proxy_send_timeout</code></td> <td style="text-align:left;">后端服务器数据回传时间(代理发送超时)</td></tr> <tr><td style="text-align:left;"><code>proxy_read_timeout</code></td> <td style="text-align:left;">连接成功后，后端服务器响应时间(代理接收超时)</td></tr> <tr><td style="text-align:left;"><code>proxy_cookie_domain</code></td> <td style="text-align:left;">替代从上游服务器来的<code>Set-Cookie</code>头的<code>domain</code>属性</td></tr> <tr><td style="text-align:left;"><code>proxy_cookie_path</code></td> <td style="text-align:left;">替代从上游服务器来的<code>Set-Cookie</code>头的<code>path</code>属性</td></tr> <tr><td style="text-align:left;"><code>proxy_buffer_size</code></td> <td style="text-align:left;">设置代理服务器（<code>nginx</code>）保存用户头信息的缓冲区大小</td></tr> <tr><td style="text-align:left;"><code>proxy_buffers</code></td> <td style="text-align:left;"><code>proxy_buffers</code>缓冲区，网页平均在多少<code>k</code>以下</td></tr> <tr><td style="text-align:left;"><code>proxy_set_header</code></td> <td style="text-align:left;">重写发送到上游服务器头的内容，也可以通过将某个头部的值设置为空字符串，而不发送某个头部的方法实现</td></tr> <tr><td style="text-align:left;"><code>proxy_ignore_headers</code></td> <td style="text-align:left;">这个指令禁止处理来自代理服务器的应答。</td></tr> <tr><td style="text-align:left;"><code>proxy_intercept_errors</code></td> <td style="text-align:left;">使<code>nginx</code>阻止<code>HTTP</code>应答代码为400或者更高的应答。</td></tr></tbody></table> <h4 id="泛域名转发"><a href="#泛域名转发" class="header-anchor">#</a> 泛域名转发</h4> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span> <span class="token operator">~</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\w<span class="token operator">-</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">)</span>\<span class="token punctuation">.</span><span class="token keyword">user</span>\<span class="token punctuation">.</span>demo\<span class="token punctuation">.</span>com$<span class="token punctuation">;</span>
  
  <span class="token comment">#配合上面语句可以把不同的域名转发到不同目录，如xuexb.user.demo.com-&gt; /home/user/wwwroot/user/xuexb a01.user.demo.com-&gt; /home/user/wwwroot/user/a01</span>
  <span class="token keyword">root</span> <span class="token operator">/</span>home<span class="token operator">/</span><span class="token keyword">user</span><span class="token operator">/</span>wwwroot<span class="token operator">/</span><span class="token keyword">user</span><span class="token operator">/</span>$<span class="token number">1</span><span class="token punctuation">;</span>
  
  <span class="token comment">## xuexb.user.demo.com/path -&gt; 127.0.0.1:8080/xuexb/path a01.user.demo.com/path -&gt; 127.0.0.1:8080/a01/path</span>
  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>NginX<span class="token operator">-</span><span class="token keyword">Proxy</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span>$<span class="token number">1</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="nodejs"><a href="#nodejs" class="header-anchor">#</a> Nodejs</h4> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">server_name</span> www<span class="token punctuation">.</span>xxoo<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
  
  <span class="token keyword">root</span> <span class="token operator">/</span>wwwroot<span class="token operator">/</span>www<span class="token punctuation">.</span>xxoo<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span>f <span class="token variable">$request_filename</span><span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">rewrite</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> $<span class="token number">1</span><span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">-</span>f <span class="token variable">$request_filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">rewrite</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>js<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>js <span class="token punctuation">{</span>
    
    <span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>NginX<span class="token operator">-</span><span class="token keyword">Proxy</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8001</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    
    <span class="token keyword">proxy_redirect</span> off<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="配置浏览器缓存"><a href="#配置浏览器缓存" class="header-anchor">#</a> 配置浏览器缓存</h3> <p>不缓存</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">expires</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if_modified_since</span> off<span class="token punctuation">;</span><span class="token comment">##</span>
<span class="token punctuation">}</span>
<span class="token comment">## Cache-Control: no-cache;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>设置缓存</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">expires</span> <span class="token number">1</span>d<span class="token punctuation">;</span>
  <span class="token comment">## expires max;</span>
<span class="token punctuation">}</span>
<span class="token comment">## Cache-Control: max-age=315360000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>根据路径设置不同的缓存策略</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">set</span> <span class="token variable">$expires_time</span> <span class="token number">1</span>M<span class="token punctuation">;</span>
  
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$request_uri</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token function">admin</span><span class="token punctuation">(</span>\<span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">?</span>$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">set</span> <span class="token variable">$expires_time</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$request_uri</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token function">admin</span><span class="token punctuation">(</span>\<span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">?</span>$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">set</span> <span class="token variable">$expires_time</span> max<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">expires</span> <span class="token variable">$expires_time</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h3> <p><code>upstream</code>模块能够使用3种负载均衡算法：轮询、<code>IP</code>哈希、最少连接数。</p> <p><strong>轮询：</strong> 默认情况下使用轮询算法，不需要配置指令来激活它，它是基于在队列中谁是下一个的原理确保访问均匀地分布到每个上游服务器；</p> <p>轮询时考研指定轮询几率，<code>weight</code>和访问比率成正比，用于后端服务器性能不均的情况。</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment">#10次一般只会有1次会访问到8081，而有9次会访问到8080</span>
<span class="token keyword">upstream</span> test <span class="token punctuation">{</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span> weight<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">8081</span> weight<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>IP哈希：</strong> 通过<code>ip_hash</code>指令来激活，<code>Nginx</code>通过<code>IPv4</code>地址的前<code>3</code>个字节或者整个<code>IPv6</code>地址作为哈希键来实现，同一个IP地址总是能被映射到同一个上游服务器；</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">upstream</span> test <span class="token punctuation">{</span>
    <span class="token keyword">ip_hash</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>最少连接数：</strong> 通过<code>least_conn</code>指令来激活，该算法通过选择一个活跃数最少的上游服务器进行连接。如果上游服务器处理能力不同，可以通过给<code>server</code>配置<code>weight</code>权重来说明，该算法将考虑到不同服务器的加权最少连接数。</p> <p>upstream使用第三方模块</p> <p>Fair：按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">upstream</span> backend <span class="token punctuation">{</span>
    fair<span class="token punctuation">;</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>url_hash:这是个第三方模块，按访问<code>url</code>的<code>hash</code>结果来分配请求，使每个<code>url</code>定向到同一个后端服务器，后端服务器为缓存时比较有效。 在<code>upstream</code>中加入<code>hash</code>语句，<code>server</code>语句中不能写入<code>weight</code>等其他的参数，<code>hash_method</code>是使用的<code>hash</code>算法</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">upstream</span> backend <span class="token punctuation">{</span>
    hash <span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    hash_method crc32<span class="token punctuation">;</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> localhost<span class="token punctuation">:</span><span class="token number">8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="支持cors跨域"><a href="#支持cors跨域" class="header-anchor">#</a> 支持CORS跨域</h3> <p>nginx配置做跨域处理--添加请求头</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>p<span class="token operator">/</span>asm <span class="token punctuation">{</span>
  <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">32020</span><span class="token punctuation">;</span>
  <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span> always<span class="token punctuation">;</span>
  <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span> always<span class="token punctuation">;</span>
  <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET,POST,PUT,DELETE,PATCH,OPTIONS'</span><span class="token punctuation">;</span>
  <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Headers'</span> <span class="token string">'Content-Type,ssid'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">204</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">proxy_redirect</span>     off<span class="token punctuation">;</span>
  <span class="token keyword">proxy_set_header</span>   Host <span class="token variable">$host</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="高可用keep-alived"><a href="#高可用keep-alived" class="header-anchor">#</a> 高可用keep-alived</h3> <p>正常情况下nginx是可以访问的，但是如果nginx出现宕机或者内存不够等程序错误，就会堵塞请求。为了防止这种情况的发生，配置高可用keep-alived进行预防</p> <p>安装keep-alived</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> keepalived -y
<span class="token function">rpm</span> -q -a keepalived
//keepalived-1.3.5-16.el7.x86_64
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>修改配置文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl start keepalived.service
<span class="token function">vi</span> keepalived.conf 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>把原主机ip地址换为虚拟ip</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>global_defs <span class="token punctuation">{</span>
   notification_email <span class="token punctuation">{</span>
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   <span class="token punctuation">}</span>
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server <span class="token number">192.168</span>.25.147
   smtp_connect_timeout <span class="token number">30</span>
   router_id LVS_DEVEL <span class="token comment"># 访问的主机地址</span>
<span class="token punctuation">}</span>
vrrp_script chk_nginx <span class="token punctuation">{</span>
  script <span class="token string">&quot;/usr/local/src/nginx_check.sh&quot;</span>  <span class="token comment"># 检测文件的地址</span>
  interval <span class="token number">2</span>   <span class="token comment"># 检测脚本执行的间隔</span>
  weight <span class="token number">2</span>   <span class="token comment"># 权重</span>
<span class="token punctuation">}</span>
vrrp_instance VI_1 <span class="token punctuation">{</span>
    state BACKUP    <span class="token comment"># 主机MASTER、备机BACKUP    </span>
    interface ens33   <span class="token comment"># 网卡</span>
    virtual_router_id <span class="token number">51</span> <span class="token comment"># 同一组需一致</span>
    priority <span class="token number">90</span>  <span class="token comment"># 访问优先级，主机值较大，备机较小</span>
    advert_int <span class="token number">1</span>
    authentication <span class="token punctuation">{</span>
        auth_type PASS
        auth_pass <span class="token number">1111</span>
    <span class="token punctuation">}</span>
    virtual_ipaddress <span class="token punctuation">{</span>
        <span class="token number">192.168</span>.25.50  <span class="token comment"># 虚拟ip</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>启动keep-alived</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl start keepalived.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="屏蔽ip-国外ip"><a href="#屏蔽ip-国外ip" class="header-anchor">#</a> 屏蔽ip/国外ip</h3> <p>在<code>nginx</code>的配置文件<code>nginx.conf</code>中加入如下配置，可以放到<code>http</code>, <code>server</code>, <code>location</code>, <code>limit_except</code>语句块，需要注意相对路径，本例当中<code>nginx.conf</code>，<code>blocksip.conf</code>在同一个目录中</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">include</span> blockip<span class="token punctuation">.</span>conf<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>blockip.conf</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">deny</span> IP<span class="token punctuation">;</span>   <span class="token comment"># 屏蔽单个ip访问</span>
<span class="token keyword">allow</span> IP<span class="token punctuation">;</span>  <span class="token comment"># 允许单个ip访问</span>
<span class="token keyword">deny</span> all<span class="token punctuation">;</span>  <span class="token comment"># 屏蔽所有ip访问</span>
<span class="token keyword">allow</span> all<span class="token punctuation">;</span> <span class="token comment"># 允许所有ip访问</span>
<span class="token keyword">deny</span> <span class="token number">123.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">8</span>   <span class="token comment"># 屏蔽整个段即从123.0.0.1到123.255.255.254访问的命令</span>
<span class="token keyword">deny</span> <span class="token number">124.45</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">16</span> <span class="token comment"># 屏蔽IP段即从123.45.0.1到123.45.255.254访问的命令</span>
<span class="token keyword">deny</span> <span class="token number">123.45</span><span class="token number">.6</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span> <span class="token comment"># 屏蔽IP段即从123.45.6.1到123.45.6.254访问的命令</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>国外ip</p> <p>基于 Nginx 的 ngx_http_geoip2 模块来禁止国外 IP 访问网站。</p> <p>安装模块依赖</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> libmaxminddb-devel -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下载模块</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/leev/ngx_http_geoip2_module.git
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>解压到/usr/local目录</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mv</span> ngx_http_geoip2_module/ /usr/local/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>模块安装成功后，还要在 Nginx 里指定数据库，在安装运行库时默认安装了两个，位于 /usr/share/GeoIP/ 目录下，一个只有 IPv4，一个包含 IPv4 和 IPv6。</p> <p>登录 www.maxmind.com 网址，创建账户，下载最新的库文件。（账户创建就不演示了）点击左侧，Download Files：</p> <p>选择 GeoLite2 Country，点击 Download GZIP 下载即可：</p> <p>上传到 /usr/share/GeoIP/ 下并解压：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /usr/share/GeoIP/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在nginx.conf中的http中引入数据库文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>geoip2 /usr/share/GeoIP/GeoLite2-City.mmdb <span class="token punctuation">{</span>
        auto_reload 5m<span class="token punctuation">;</span>
        <span class="token variable">$geoip2_data_country_code</span> country iso_code<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        map <span class="token variable">$geoip2_data_country_code</span> <span class="token variable">$allowed_country</span> <span class="token punctuation">{</span>
default <span class="token function">yes</span><span class="token punctuation">;</span>
        CN no<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在 server 中的 location 下添加条件，如果满足 IP 是国外 IP，就执行下面的 return 动作，</p> <p>可以直接返回 404或者别的页面：</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$allowed_country</span> <span class="token operator">=</span> yes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># return https://www.baidu.com;</span>
    <span class="token comment"># return /home/japan;</span>
    <span class="token keyword">return</span> <span class="token number">404</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="重定向"><a href="#重定向" class="header-anchor">#</a> 重定向</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token operator">/</span><span class="token operator">/</span>重定向网站
<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">server_name</span> old<span class="token operator">-</span>site<span class="token punctuation">.</span>com
    <span class="token keyword">return</span> <span class="token number">301</span> <span class="token variable">$scheme</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>new<span class="token operator">-</span>site<span class="token punctuation">.</span>com<span class="token variable">$request_uri</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">/</span>重定向单页面
<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span>oldpage<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>org<span class="token operator">/</span>newpage<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">/</span>重定向子路径
<span class="token keyword">location</span> <span class="token operator">/</span>old<span class="token operator">-</span>site <span class="token punctuation">{</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span>old<span class="token operator">-</span>site<span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>example<span class="token punctuation">.</span>org<span class="token operator">/</span>new<span class="token operator">-</span>site<span class="token operator">/</span>$<span class="token number">1</span> permanent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="配置图片防盗链"><a href="#配置图片防盗链" class="header-anchor">#</a> 配置图片防盗链</h3> <p>防盗链是指当图片不是自己网站打开时返回403或者指定图片，通过判断请求的来路判断是否是自己的站点来设置</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">*</span> \<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
    <span class="token keyword">valid_referers</span> none blocked <span class="token operator">*</span><span class="token punctuation">.</span>xuexb<span class="token punctuation">.</span>com server_names
      
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	<span class="token keyword">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="https配置"><a href="#https配置" class="header-anchor">#</a> Https配置</h3> <h4 id="let-s-encrypt"><a href="#let-s-encrypt" class="header-anchor">#</a> let's Encrypt</h4> <p>let's Encrypt作为一个公共且免费SSL的项目逐渐被广大用户传播和使用，由Mozilla、Cisco、Akamai、IdenTrust等组织发起，主要的目的也是为了推进网站由http向https过度。</p> <p>let's Encrypt免费SSL证书的出现，也会对传统提供付费SSL证书服务的商家有不少的打击。目前Let‘s Encrypt获得IndenTrust交叉签名，也就是可以应用且支持包括Firefox、Chrome在内的主流浏览器的兼容和支持。</p> <p>使用git安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/letsencrypt/letsencrypt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>生成证书</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> letsencrypt
./lensencrypt-auto certonly --standalone --email quiniton@163.com -d www.zhaoheqiang.me -d zhaoheqiang.me
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>执行命令之后，会在/etc/letsencrypt/live/下找到各个域名的文件夹，每个文件夹里面会有四个密钥证书文件：</p> <p>cert.pem：Apache服务器端证书</p> <p>chain.pem：Apache根证书和中继证书</p> <p>fullchain.pem：Nginx所需要的ssl_certificate文件</p> <p>privkey.pem：安全证书KEY文件</p> <p>如果是Nginx，使用fullchain.pem和privacy.pem文件，在配置文件中加入语句</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">https</span><span class="token punctuation">;</span>
	<span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>etc<span class="token operator">/</span>letsencrypt<span class="token operator">/</span>live<span class="token operator">/</span>www<span class="token punctuation">.</span>zhaoheqiang<span class="token punctuation">.</span>me<span class="token operator">/</span>fullchain<span class="token punctuation">.</span>pem
	<span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>etc<span class="token operator">/</span>letsencrypt<span class="token operator">/</span>live<span class="token operator">/</span>www<span class="token punctuation">.</span>zhaoheqiang<span class="token punctuation">.</span>me<span class="token operator">/</span>privkey<span class="token punctuation">.</span>pem
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>延长有效期</p> <p>let's Encrypt的证书一般有有效期，需要手动更新续期</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./lensencrypt-auto certonly --renew-by-default --email quiniton@163.com -d www.zhaoheqiang.me -d zhaoheqiang.me
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="certbot"><a href="#certbot" class="header-anchor">#</a> certbot</h4> <p>certbot是let's Encrypt官方推荐的获取证书的客户端。可以帮我们获取免费的let's Encrypt证书。certbot支持所有unix内核的操作系统。</p> <p>安装certbot</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> certbot
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>获取证书</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>certbot certonly --standalone -d example.com -d www.example.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>也可以用指定根目录的方式生成证书</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>certbot certonly --webroot -w /var/www/example -d example.com -d www.example.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>证书生成后就可以在/etc/letsencrypt/live目录下看到对应域名的证书</p> <p>let's Encrypt提供的证书一般都有90天有效期，在证书到期之前需要更新证书，certbot提供自动更新</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>certbot renew --dry-run
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装时如果报错</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Problem binding to port <span class="token number">80</span>:Could not <span class="token builtin class-name">bind</span> to IPv4 or IPv6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因为nginx占用80端口，需要先停掉nginx进行操作，执行自动更新时也需要停掉nginx</p> <h4 id="openssl"><a href="#openssl" class="header-anchor">#</a> openssl</h4> <p>先生成一个key</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>openssl genrsa -des3 -out ssl.key <span class="token number">1024</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>根据key生成证书请求文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>openssl req -new -key ssl.key -out ssl.csr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>最后根据这两个文件生成crt证书文件，如果需要pfx可以用第二个命令生成</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>openssl x509 -req -days <span class="token number">3650</span> -in ssl.csr -signkey ssl.key -out ssl.cer
openssl pkcs12 -export -inkey ssl.key -in ssl.crt -out ssl.pfx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在需要使用证书的server中配置</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">ssl</span> on<span class="token punctuation">;</span>
  <span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>home<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token punctuation">.</span>crt<span class="token punctuation">;</span>
  <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>home<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span>
  <span class="token keyword">ssl_session_timeout</span> <span class="token number">5</span>m<span class="token punctuation">;</span>
  <span class="token keyword">ssl_protocols</span> SSLv2 SSLv3 TLSv1<span class="token punctuation">;</span>
  <span class="token keyword">ssl_ciphers</span> ALL<span class="token punctuation">:</span><span class="token operator">!</span>EXPORT56<span class="token punctuation">:</span>RC4<span class="token operator">+</span>RSA<span class="token operator">+</span>HIGH<span class="token punctuation">:</span><span class="token operator">+</span>MEDIUM<span class="token operator">+</span>LOW<span class="token punctuation">:</span><span class="token operator">+</span>SSLv2<span class="token punctuation">:</span><span class="token operator">+</span>EXP<span class="token punctuation">;</span>
  ssl_prefer_server_cipher on<span class="token punctuation">;</span>
  
  <span class="token keyword">listen</span> <span class="token number">443</span><span class="token punctuation">;</span>
  <span class="token keyword">ssl</span> on<span class="token punctuation">;</span>
  <span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>webserver<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>vhost<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span><span class="token keyword">server</span><span class="token punctuation">.</span>crt<span class="token punctuation">;</span>
  <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>webserver<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>vhost<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span><span class="token keyword">server</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>重启nginx就可以，使用https进行访问</p> <h4 id="nginx配置-http重定向到https"><a href="#nginx配置-http重定向到https" class="header-anchor">#</a> nginx配置/http重定向到https</h4> <p>不可以把301和proxy_pass写在同一个server中，会产生重定向次数过多的问题</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">server_name</span> www<span class="token punctuation">.</span>kunzhang<span class="token punctuation">.</span>me kunzhnag<span class="token punctuation">.</span>me<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> www<span class="token punctuation">.</span>kunzhang<span class="token punctuation">.</span>me<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token operator">/</span><span class="token variable">$request_url</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span> <span class="token keyword">http</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>etc<span class="token operator">/</span>letsencrypt<span class="token operator">/</span>live<span class="token operator">/</span>diamondfsd<span class="token punctuation">.</span>com<span class="token operator">/</span>fullchain<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>etc<span class="token operator">/</span>letsencrypt<span class="token operator">/</span>live<span class="token operator">/</span>diamondfsd<span class="token punctuation">.</span>com<span class="token operator">/</span>privkey<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>

    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">3999</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X_FORWARDED_PROTO <span class="token keyword">https</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="缓冲优化"><a href="#缓冲优化" class="header-anchor">#</a> 缓冲优化</h3> <p>Nginx代理之后会有相应的代理缓存区，缓存区默认只有几十K，某些版本的nginx默认设置中没有相关处理，导致部分文件代理是会出现加载不全的现象，其实不仅仅是JS文件。只是因为框架的JS文件略大，所以经常出现类似问题。</p> <p>在nginx.conf中添加</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>http {
	proxy_buffer_size 128k;
	proxy_buffers   32 128k;
	proxy_busy_buffers_size 128k;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="gzip压缩"><a href="#gzip压缩" class="header-anchor">#</a> gzip压缩</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">http</span> <span class="token punctuation">{</span>
  <span class="token comment"># 开启gzip</span>
  <span class="token keyword">gzip</span> on<span class="token punctuation">;</span>

  <span class="token comment"># 启用gzip压缩的最小文件，小于设置值的文件将不会压缩</span>
  <span class="token keyword">gzip_min_length</span> <span class="token number">1</span>k<span class="token punctuation">;</span>

  <span class="token comment"># gzip 压缩级别，1-10，数字越大压缩的越好，也越占用CPU时间</span>
  <span class="token keyword">gzip_comp_level</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token comment"># 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。</span>
  <span class="token keyword">gzip_types</span> text<span class="token operator">/</span>plain application<span class="token operator">/</span>javascript application<span class="token operator">/</span>x<span class="token operator">-</span>javascript text<span class="token operator">/</span>css application<span class="token operator">/</span>xml text<span class="token operator">/</span>javascript application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php image<span class="token operator">/</span>jpeg image<span class="token operator">/</span>gif image<span class="token operator">/</span>png<span class="token punctuation">;</span>

  <span class="token comment"># 是否在http header中添加Vary: Accept-Encoding，建议开启</span>
  <span class="token keyword">gzip_vary</span> on<span class="token punctuation">;</span>

  <span class="token comment"># 禁用IE 6 gzip</span>
  <span class="token keyword">gzip_disable</span> <span class="token string">&quot;MSIE [1-6]\.&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="错误日志"><a href="#错误日志" class="header-anchor">#</a> 错误日志</h3> <p>打开nginx.conf文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/nginx/nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="性能"><a href="#性能" class="header-anchor">#</a> 性能</h3> <p>内容缓存：允许浏览器基本上永久地缓存静态内容。 <code>Nginx</code>将为您设置<code>Expires</code>和<code>Cache-Control</code>头信息。</p> <p>设置nginx的静态文件地址</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
  <span class="token keyword">add_header</span> Cache<span class="token operator">-</span>Control max<span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">360000</span><span class="token punctuation">;</span>
  <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>webrtc<span class="token operator">-</span>sdk<span class="token operator">/</span>dist<span class="token operator">/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>设置nginx做websocket代理</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>websocket <span class="token punctuation">{</span>
  <span class="token keyword">proxy_pass</span>         <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.40</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">31089</span><span class="token punctuation">;</span>
  <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
  <span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
  <span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;Upgrade&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>设置nginx最大打开文件限制</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">user</span> <span class="token keyword">root</span> <span class="token keyword">root</span><span class="token punctuation">;</span>
<span class="token keyword">worker_processes</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">worker_rlimit_nofile</span> <span class="token number">65535</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>设置nginx拦截某个请求，并直接返回状态码</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>p<span class="token operator">/</span>asm <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">204</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>设置nginx给某个路径单独的日志文件</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>p<span class="token operator">/</span>asm <span class="token punctuation">{</span>
  <span class="token keyword">access_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>a<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
  <span class="token keyword">error_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>a<span class="token punctuation">.</span>err<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="警告"><a href="#警告" class="header-anchor">#</a> 警告</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>Starting nginx: nginx: [warn] could not build optimal proxy_headers_hash, you should increase either proxy_headers_hash_max_size: 512 or proxy_headers_hash_bucket_size: 64; ignoring proxy_headers_hash_bucket_size
nginx: [warn] could not build optimal proxy_headers_hash, you should increase either proxy_headers_hash_max_size: 512 or proxy_headers_hash_bucket_size: 64; ignoring proxy_headers_hash_bucket_size
nginx: [warn] could not build optimal proxy_headers_hash, you should increase either proxy_headers_hash_max_size: 512 or proxy_headers_hash_bucket_size: 64;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在代理中设置</p> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>proxy_headers_hash_max_size 51200;
proxy_headers_hash_bucket_size 6400;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="伪静态"><a href="#伪静态" class="header-anchor">#</a> 伪静态</h3> <p>伪静态即是网站本身动态网页，如。php、。asp、。aspx等格式动态网页，加？参数来读取数据库内不同资料，伪静态就是做url重写操作，伪静态最主要的作用是利于seo，</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
  <span class="token keyword">rewrite</span> <span class="token function">c</span><span class="token punctuation">(</span>\d<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">.</span>html <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">user</span><span class="token operator">&amp;</span>id<span class="token operator">=</span>$<span class="token number">1</span><span class="token operator">&amp;</span>title<span class="token operator">=</span>$<span class="token number">2</span> last<span class="token punctuation">;</span>
  <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>sta<span class="token punctuation">;</span>
  <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm <span class="token keyword">index</span><span class="token punctuation">.</span>php
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="资源"><a href="#资源" class="header-anchor">#</a> 资源</h3> <p>Https://xuexb.github.io/learn-nginx</p> <h2 id="apache"><a href="#apache" class="header-anchor">#</a> Apache</h2> <p>apache在linux下的文件是httpd，centos自带apache,文件目录为cd/etc/init.d</p> <p>启动apache服务</p> <div class="language-centos line-numbers-mode"><pre class="language-text"><code>service httpd start
service httpd restart
service httpd stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="部署项目"><a href="#部署项目" class="header-anchor">#</a> 部署项目</h2> <h3 id="react"><a href="#react" class="header-anchor">#</a> react</h3> <p>system limit for number of file watchers reached</p> <p>文件监控数量超过了系统限制，直接修改系统参数</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /proc/sys/fs/inotify/max_user_matches
<span class="token comment">##8192</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/sysctl.conf

<span class="token comment">## 添加语句 fs.inotify.max_user_watches=524288</span>

<span class="token function">sudo</span> sysctl -p 

<span class="token function">cat</span> /proc/sys/fs/inotify/max_user_matches
<span class="token comment">##524288</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="node"><a href="#node" class="header-anchor">#</a> Node</h3> <p>运行命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 14.*</span>
<span class="token function">curl</span> -sL https://rpm.nodesource.com/setup_14.x <span class="token operator">|</span> <span class="token function">bash</span> -
<span class="token comment">## 12.*</span>
<span class="token function">curl</span> -sL https://rpm.nodesource.com/setup_12.x <span class="token operator">|</span> <span class="token function">bash</span> -

yum -y <span class="token function">install</span> nodejs

<span class="token comment">## 安装gcc插件</span>
yum <span class="token function">install</span> gcc-c++ cmake
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="服务器翻墙github太慢问题"><a href="#服务器翻墙github太慢问题" class="header-anchor">#</a> 服务器翻墙GitHub太慢问题</h2> <p>使用代理网址https://github.com.cnpmjs.org/</p> <h2 id="linux端口无法访问问题排查"><a href="#linux端口无法访问问题排查" class="header-anchor">#</a> linux端口无法访问问题排查</h2> <p>1.确认服务器的项目部署成功</p> <p>2.确认访问地址是否存在。访问地址和端口是否正常。</p> <p>3.确定服务器安全规则是否添加了要访问的端口。在控制台检查安全规则。</p> <p>4.连接服务器的用户。一般服务器有root管理员，和其他个人创建用户。</p> <p>5.服务器防火墙问题。服务器一般配置80端口为开放端口，在外网访问服务器80端口</p> <p>使用telnet判断端口是否可以访问</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>telnet <span class="token number">47.49</span>.182.93:7001
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p></p> <h2 id="docker"><a href="#docker" class="header-anchor">#</a> docker</h2> <p>Docker作为容器管理的平台，早已在服务部署等领域有非常广泛的应用。容器是轻量级的虚拟化方案，依托于overlayfs、Linux下的namespace、cgroups等OS级别的虚拟化技术，性能相比于基于VM的虚拟化更加突出。</p> <p>更重要的是，通过Docker安装和配置软件更加方便</p> <p>移除可能有旧的Docker版本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum erase -y docker docker-common docker-engine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装工具包和依赖，设置仓库源</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>yum install -y yum-utils device-mapper-persistent-data lvm2
yum-config-manager \ 
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用yum安装docker-ce</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>##最新稳定版
yum install docker-ce docker-ce-cli containerd.io
##指定版本
yum install docker-ce-18.09.6 docker-ce-cli-18.09.6 containerd.io
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动docker服务</p> <div class="language-centos line-numbers-mode"><pre class="language-text"><code>systemctl start docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>检查docker的信息和版本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker version
docker info
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>验证docker，通过下载镜像和创建容器来看看Docker是否可以运转起来。可以使用下面的命令从Docker的镜像仓库下载名为hello-world的镜像文件。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker pull hello-world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>docker安装容器</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker pull gitlab/gitlab<span class="token punctuation">-</span>ce
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果docker拉取较慢更换docker源，docker默认为docker国内镜像，可以腾讯源、中科大源或者dcloud</p> <p>启动容器</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>docker run 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看容器</p> <h2 id="v2ray"><a href="#v2ray" class="header-anchor">#</a> V2ray</h2> <p>一键安装脚本</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>bash &lt;(curl -s -L https://git.io/v2ray.sh)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行后自动安装，安装过程中：</p> <p>输入1进行安装</p> <p>选择tcp协议（默认）</p> <p>选择端口号：为了不和别的软件冲突，推荐使用10000以上不超过65535的端口号，我选的10086</p> <p>广告拦截：是否开启广告拦截，推荐不要开启，开启广告拦截会消耗服务器资源，且国外环境略由于国内环境</p> <p>配置shadowsocks：选择开启，后面使用游戏加速器会用上</p> <p>选择shadowsocks端口号：随意，不要和上面v2ray一样，我选2333</p> <p>ss连接密码：123456</p> <p>ss加密协议：选择默认</p> <p>然后继续回车，直到安装完毕</p> <p>开启BBR加速：google BBR是一款免费开源的TCP拥塞控制传输协议，可以使linux服务器显著提高吞吐量和减少TCP连接的延迟</p> <p>修改系统变量</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>echo &quot;net.core.default_qdisc=fq&quot; &gt;&gt; /etc/sysctl.conf
echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; &gt;&gt;/etc/sysctl.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>保存生效</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sysctl -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>检查BBR是否开启</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sysctl net.ipv4.tcp_available_congestion_control
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>返回变量==bbr则说明开启成功</p> <p>检查BBR是否启动成功</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>lsmod | grep bbr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果返回tcp_bar 20480说明启动成功</p> <h3 id="客户端使用"><a href="#客户端使用" class="header-anchor">#</a> 客户端使用</h3> <p>windows客户端使用v2rayN</p> <p>​       在服务器端输入v2ray url，复制vmess链接</p> <p>​      下载v2rayN软件，打开软件点击服务器，点击从剪贴板批量导入url</p> <p>​      右键点击刚刚导入的服务器，测试服务器延迟，表示连接成功</p> <p>​      在小图标点击右键，选择pcahttp代理模式，表示只有被墙的网站才会启用代理，全局模式是所有链接都走代理</p> <p>mac端使用v2rayU</p> <p>ios端使用shadowsocks扫描</p> <p>Android端使用v2rayNG</p> <p>在服务器端输入</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>v2ray qr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>打开二维码链接，然后在手机上下载v2rayNG，打开客户端用扫一扫扫描二维码就能添加到节点</p> <p>路由器端</p> <p>在服务器段输入</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>v2ray url
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>复制链接，代开路由器端openwrt，勾选代理开关，点击服务器列表，在通过vmess链接添加节点处粘贴刚刚复制的链接</p> <p>然后点击账号设置，代理模式选择gtwlist模式，服务器选择刚刚添加的服务器，点击提交就完成</p> <p>https://noobyy.com/31.html</p> <h2 id="nextcloud个人网盘服务器"><a href="#nextcloud个人网盘服务器" class="header-anchor">#</a> Nextcloud个人网盘服务器</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/8/2021, 10:45:23 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tech/服务器技术/k8s.html" class="prev">
        k8s
      </a></span> <span class="next"><a href="/tech/服务器技术/rust.html">
        Rust
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.107701cb.js" defer></script><script src="/assets/js/2.619c82a8.js" defer></script><script src="/assets/js/41.f5621bfc.js" defer></script>
  </body>
</html>
